"use client";

import { useEffect, useMemo, useState, useRef, useCallback } from "react";
import { useParams, useRouter } from "next/navigation";
import ReactMarkdown from "react-markdown";
import remarkGfm from "remark-gfm";
import jsPDF from "jspdf";
import html2canvas from "html2canvas";
import RichEditor from "@/components/RichEditor";
import DeleteProfile from "../DeleteProfile";
import { NotesTemplates } from "@/components/NotesTemplates";
import { calculateSALCodes, getCodeShortLabel } from "@/lib/sal-codes";

// –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (200 —Ñ–∞–∫—Ç–æ–≤)
const INTERESTING_FACTS = [
  "üß† –ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ –º–æ–∑–≥ —á–µ–ª–æ–≤–µ–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–∫–æ–ª–æ 70 000 –º—ã—Å–ª–µ–π –≤ –¥–µ–Ω—å?",
  "üí´ –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ª–∏—á–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –¥—Ä–µ–≤–Ω–∏—Ö –∑–Ω–∞–Ω–∏—è—Ö –æ —Ü–∏–∫–ª–∞—Ö –∏ –∞—Ä—Ö–µ—Ç–∏–ø–∞—Ö",
  "üåü –ö–∞–∂–¥—ã–π —á–µ–ª–æ–≤–µ–∫ —É–Ω–∏–∫–∞–ª–µ–Ω, –Ω–æ –≤—Å–µ –º—ã —Å–ª–µ–¥—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º —Ä–∞–∑–≤–∏—Ç–∏—è",
  "üìä –ü—Å–∏—Ö–æ–ª–æ–≥–∏ —É—Ç–≤–µ—Ä–∂–¥–∞—é—Ç, —á—Ç–æ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–µ–±—è ‚Äî –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —É—Å–ø–µ—Ö—É",
  "üéØ –¶–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ –Ω–∞ 42%",
  "ü§ù –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 93% –Ω–∞—à–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –º–∏—Ä–æ–º",
  "üí° –ò–Ω—Ç—É–∏—Ü–∏—è —á–∞—Å—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è",
  "üå± –õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç ‚Äî —ç—Ç–æ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∞ –Ω–µ –∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º",
  "‚öñÔ∏è –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∞—Å–ø–µ–∫—Ç–∞–º–∏ –ª–∏—á–Ω–æ—Å—Ç–∏ ‚Äî –∫–ª—é—á –∫ –≥–∞—Ä–º–æ–Ω–∏–∏",
  "üîÆ –°–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä–∏ –∫ –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º",
  "üåü –£ –∫–∞–∂–¥–æ–≥–æ –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–∞–ª–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç —Å–≤–æ–µ–≥–æ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è",
  "üí™ –°–∏–ª–∞ –≤–æ–ª–∏, –∫–∞–∫ –º—ã—à—Ü–∞, —É–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫—É",
  "üåä –≠–º–æ—Ü–∏–∏ ‚Äî —ç—Ç–æ –≤–æ–ª–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è —É–ø—Ä–∞–≤–ª—è—Ç—å",
  "üé≠ –ú—ã –∏–≥—Ä–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ä–æ–ª–∏, –Ω–æ –≤–∞–∂–Ω–æ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å–æ–±–æ–π",
  "üîç –ì–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–µ–±—è –ø–æ–º–æ–≥–∞–µ—Ç –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞—Ç—å –¥—Ä—É–≥–∏—Ö",
  "üìà –ù–µ–±–æ–ª—å—à–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –±–æ–ª—å—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º",
  "üéØ –Ø—Å–Ω–æ—Å—Ç—å —Ü–µ–ª–µ–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—é –≤ 3 —Ä–∞–∑–∞",
  "ü§î –†–µ—Ñ–ª–µ–∫—Å–∏—è ‚Äî –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ª–∏—á–Ω–æ—Å—Ç–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è",
  "‚ú® –ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è —Ä–æ—Å—Ç–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π",
  "üß¨ –ù–∞—à –º–æ–∑–≥ —Å–ø–æ—Å–æ–±–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–π –∂–∏–∑–Ω–∏",
  "üí≠ 95% –Ω–∞—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ",
  "üåô –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –º–æ–∑–≥—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
  "üé™ –ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏ –Ω–∞ 7-10 –ª–µ—Ç",
  "üîê –ü—Ä–∏–≤—ã—á–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –≤ —Å—Ä–µ–¥–Ω–µ–º –∑–∞ 66 –¥–Ω–µ–π",
  "üìö –ß—Ç–µ–Ω–∏–µ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —ç–º–ø–∞—Ç–∏—é –∏ —É–ª—É—á—à–∞–µ—Ç —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏",
  "üéµ –ú—É–∑—ã–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ—á—Ç–∏ –≤—Å–µ –æ–±–ª–∞—Å—Ç–∏ –º–æ–∑–≥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ",
  "üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç—å —Å–µ—Ä–æ–≥–æ –≤–µ—â–µ—Å—Ç–≤–∞ –≤ –º–æ–∑–≥–µ",
  "üèÉ –§–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Å—Ç–∏–º—É–ª–∏—Ä—É—é—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤ ‚Äî –≥–æ—Ä–º–æ–Ω–æ–≤ —Å—á–∞—Å—Ç—å—è",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ ‚Äî –≥–æ—Ä–º–æ–Ω–∞ —Å—Ç—Ä–µ—Å—Å–∞",
  "ü§ó –û–±—ä—è—Ç–∏—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é 20 —Å–µ–∫—É–Ω–¥ –ø–æ–≤—ã—à–∞—é—Ç —É—Ä–æ–≤–µ–Ω—å –æ–∫—Å–∏—Ç–æ—Ü–∏–Ω–∞",
  "üòä –£–ª—ã–±–∫–∞, –¥–∞–∂–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è, –º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
  "üí¨ –†–∞–∑–≥–æ–≤–æ—Ä —Å —Å–∞–º–∏–º —Å–æ–±–æ–π –ø–æ–º–æ–≥–∞–µ—Ç –ª—É—á—à–µ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º",
  "üéØ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç–µ –∂–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ –ø—É—Ç–∏, —á—Ç–æ –∏ —Ä–µ–∞–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ",
  "üìù –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –ø–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å—á–∞—Å—Ç—å—è –Ω–∞ 25%",
  "üîÑ –ù–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–∑–≥—É –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ —Ç—Ä–∞–≤–º",
  "üéì –û–±—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–º—É –Ω–∞–≤—ã–∫—É —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏",
  "üß© –†–µ—à–µ–Ω–∏–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–æ–∫ –∑–∞–º–µ–¥–ª—è–µ—Ç —Å—Ç–∞—Ä–µ–Ω–∏–µ –º–æ–∑–≥–∞",
  "üåÖ –£—Ç—Ä–µ–Ω–Ω–∏–π —Å–æ–ª–Ω–µ—á–Ω—ã–π —Å–≤–µ—Ç —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç —Ü–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã –∏ —É–ª—É—á—à–∞–µ—Ç —Å–æ–Ω",
  "üíß –û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ –Ω–∞ 2% —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
  "üç´ –¢–µ–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥ —É–ª—É—á—à–∞–µ—Ç –∫—Ä–æ–≤–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ –º–æ–∑–≥–∞",
  "üß† –ú–æ–∑–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 20% –≤—Å–µ–π —ç–Ω–µ—Ä–≥–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞, —Ö–æ—Ç—è –≤–µ—Å–∏—Ç –≤—Å–µ–≥–æ 2%",
  "üé® –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –ª—é–¥–∏ —á–∞—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±–∞ –ø–æ–ª—É—à–∞—Ä–∏—è –º–æ–∑–≥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ",
  "üí§ –ù–µ–¥–æ—Å—ã–ø —Å–Ω–∏–∂–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é –Ω–∞ 40%",
  "üé™ –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ 40%",
  "üì± –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–Ω–∏–∂–∞—é—Ç IQ –Ω–∞ 10 –ø—É–Ω–∫—Ç–æ–≤",
  "üåä –ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ —É–ª—É—á—à–∞–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ 50%",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –≤–∞–∂–Ω–µ–µ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è, —á–µ–º –æ—Ç–∫–∞–∑ –æ—Ç –∫—É—Ä–µ–Ω–∏—è",
  "üí≠ –ú—ã—Å–ª–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–≥—É—Ç —É–ª—É—á—à–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏",
  "üéØ –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ü–µ–ª–µ–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —à–∞–Ω—Å—ã –Ω–∞ —É—Å–ø–µ—Ö –≤ 10 —Ä–∞–∑",
  "üìä 80% —É—Å–ø–µ—Ö–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞, –∞ –Ω–µ IQ",
  "üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ —Å–Ω–∏–∂–∞–µ—Ç —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å –Ω–∞ 60%",
  "üéµ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –≤–Ω–∏–º–∞–Ω–∏—è",
  "üå± –û–ø—Ç–∏–º–∏—Å—Ç—ã –∂–∏–≤—É—Ç –≤ —Å—Ä–µ–¥–Ω–µ–º –Ω–∞ 15% –¥–æ–ª—å—à–µ –ø–µ—Å—Å–∏–º–∏—Å—Ç–æ–≤",
  "üí™ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –æ–±—ä–µ–º –≥–∏–ø–ø–æ–∫–∞–º–ø–∞",
  "üìö –õ—é–¥–∏, —á–∏—Ç–∞—é—â–∏–µ –∫–Ω–∏–≥–∏, –∂–∏–≤—É—Ç –≤ —Å—Ä–µ–¥–Ω–µ–º –Ω–∞ 2 –≥–æ–¥–∞ –¥–æ–ª—å—à–µ",
  "üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –º–æ–∑–≥–∞",
  "ü§ó –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –Ω–∞ 50%",
  "üí° –ú–æ–º–µ–Ω—Ç—ã –æ–∑–∞—Ä–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç, –∫–æ–≥–¥–∞ –º–æ–∑–≥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–∫–æ—è",
  "üåô –õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã ‚Äî —Ä–∞–Ω–Ω–µ–µ —É—Ç—Ä–æ",
  "üéØ –§–æ–∫—É—Å –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–µ, –∞ –Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ, —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å",
  "üß¨ –ì–µ–Ω–µ—Ç–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ 30% –Ω–∞—à–µ–≥–æ —Å—á–∞—Å—Ç—å—è, –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤ –Ω–∞—à–∏—Ö —Ä—É–∫–∞—Ö",
  "üí≠ –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ –ø—É—Ç–∏",
  "üé™ –°–º–µ—Ö —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ –∏ —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç",
  "üåø –ó–µ–ª–µ–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏ —É–ª—É—á—à–∞—é—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –Ω–∞ 15%",
  "üìù –ó–∞–ø–∏—Å—ã–≤–∞–Ω–∏–µ —Ü–µ–ª–µ–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞ 42%",
  "üîÑ –ü—Ä–∏–≤—ã—á–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∑–∞ 18-254 –¥–Ω—è, –≤ —Å—Ä–µ–¥–Ω–µ–º 66 –¥–Ω–µ–π",
  "üéì –û–±—É—á–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –ø–æ–º–æ–≥–∞–µ—Ç –ª—É—á—à–µ –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
  "üß† –ú–æ–∑–≥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ 60 000 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ —Ç–µ–∫—Å—Ç–∞",
  "üí§ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç –ø–∞–º—è—Ç—å –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫ –æ–±—É—á–µ–Ω–∏—é",
  "üéØ –†–∞–∑–±–∏–µ–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ü–µ–ª–µ–π –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—é",
  "ü§ù –≠–º–ø–∞—Ç–∏—è –º–æ–∂–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫—É –∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É",
  "üí° –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –º—ã —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω—ã –∏ –Ω–µ —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø—Ä–æ–±–ª–µ–º–µ",
  "üåä –í–æ–¥–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 75% –º–∞—Å—Å—ã –º–æ–∑–≥–∞",
  "üéµ –ú—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –≤—ã–±—Ä–æ—Å –¥–æ—Ñ–∞–º–∏–Ω–∞, –∫–∞–∫ –Ω–∞—Ä–∫–æ—Ç–∏–∫–∏",
  "üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ–±—ä–µ–º –ø—Ä–µ—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–æ—Ä—ã",
  "üìö –ß—Ç–µ–Ω–∏–µ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —Ç–µ–æ—Ä–∏—é —Ä–∞–∑—É–º–∞",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –¥–æ—Ñ–∞–º–∏–Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è",
  "ü§ó –§–∏–∑–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–∞–∫—Ç —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞",
  "üí≠ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç–µ –∂–µ –Ω–µ–π—Ä–æ–Ω—ã, —á—Ç–æ –∏ —Ä–µ–∞–ª—å–Ω—ã–π —É—Å–ø–µ—Ö",
  "üå± –ü–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –º—ã—à–ª–µ–Ω–∏–µ —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É",
  "üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—Ç –±–æ–ª—å—à–µ, —á–µ–º –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ",
  "üìä –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –º–æ–∂–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–π –∂–∏–∑–Ω–∏",
  "üß† –ú–æ–∑–≥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –¥–æ 25 –ª–µ—Ç",
  "üí§ –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å –∏ –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å –æ–±—É—á–µ–Ω–∏–µ",
  "üé™ –ü–µ—Ä–µ—Ä—ã–≤—ã –≤ —Ä–∞–±–æ—Ç–µ –ø–æ–≤—ã—à–∞—é—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ 20%",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –∏ —Å–Ω–∏–∂–∞–µ—Ç —É–º—Å—Ç–≤–µ–Ω–Ω—É—é —É—Å—Ç–∞–ª–æ—Å—Ç—å",
  "üíß –û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ —É—Ö—É–¥—à–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏",
  "üç´ –ê–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç—ã –≤ —Ç–µ–º–Ω–æ–º —à–æ–∫–æ–ª–∞–¥–µ —É–ª—É—á—à–∞—é—Ç –∫—Ä–æ–≤–æ—Ç–æ–∫ –≤ –º–æ–∑–≥–µ",
  "üß¨ –ù–µ–π—Ä–æ–≥–µ–Ω–µ–∑ ‚Äî –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –Ω–µ–π—Ä–æ–Ω–æ–≤ ‚Äî –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—Å—é –∂–∏–∑–Ω—å",
  "üé® –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –ª—é–¥–∏ –ª—É—á—à–µ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å—é",
  "üí≠ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–∑–≥–∞ –≤—Å–µ–≥–æ –∑–∞ 8 –Ω–µ–¥–µ–ª—å",
  "üèÉ –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç —Ä–æ—Å—Ç –Ω–æ–≤—ã—Ö –Ω–µ–π—Ä–æ–Ω–æ–≤",
  "üìö –û–±—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–º—É —è–∑—ã–∫—É –∑–∞–º–µ–¥–ª—è–µ—Ç —Å—Ç–∞—Ä–µ–Ω–∏–µ –º–æ–∑–≥–∞",
  "üéµ –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –∏ —Ç—Ä–µ–≤–æ–≥–µ",
  "üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ –ø—É—Ç–∏",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Ç–∞–∫ –∂–µ –≤—Ä–µ–¥–Ω–∞, –∫–∞–∫ –∫—É—Ä–µ–Ω–∏–µ 15 —Å–∏–≥–∞—Ä–µ—Ç –≤ –¥–µ–Ω—å",
  "üí° –ú–æ–º–µ–Ω—Ç—ã –∏–Ω—Å–∞–π—Ç–∞ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—Ç—Å—è –≤—ã–±—Ä–æ—Å–æ–º –¥–æ—Ñ–∞–º–∏–Ω–∞",
  "üåô –¶–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
  "üéØ –°–∏—Å—Ç–µ–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –º–æ–∑–≥–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π",
  "üìä –≠–º–æ—Ü–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –±–æ–ª—å—à–µ, —á–µ–º –ª–æ–≥–∏–∫–∞",
  "üß† –ú–æ–∑–≥ —ç–∫–æ–Ω–æ–º–∏—Ç —ç–Ω–µ—Ä–≥–∏—é, —Å–æ–∑–¥–∞–≤–∞—è —à–∞–±–ª–æ–Ω—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º—ã",
  "üí§ –ù–µ–¥–æ—Å—ã–ø –Ω–∞—Ä—É—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–µ—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–æ—Ä—ã",
  "üé™ –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—â–∞–µ—Ç –∑–∞–ø–∞—Å—ã –≥–ª—é–∫–æ–∑—ã –≤ –º–æ–∑–≥–µ",
  "üåø –ü—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ —Å–Ω–∏–∂–∞—é—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–ª–∞—Å—Ç–∏ –º–æ–∑–≥–∞, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –¥–µ–ø—Ä–µ—Å—Å–∏–µ–π",
  "üíß –í–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
  "üç´ –§–ª–∞–≤–æ–Ω–æ–∏–¥—ã –≤ –∫–∞–∫–∞–æ —É–ª—É—á—à–∞—é—Ç –ø–∞–º—è—Ç—å –∏ –≤–Ω–∏–º–∞–Ω–∏–µ",
  "üß¨ –ü–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º –∏ —Ç—Ä–µ–≤–æ–≥–æ–π",
  "üí≠ –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–∏–Ω–¥–∞–ª–µ–≤–∏–¥–Ω–æ–≥–æ —Ç–µ–ª–∞",
  "üèÉ –ö–∞—Ä–¥–∏–æ-—É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –æ–±—ä–µ–º –≥–∏–ø–ø–æ–∫–∞–º–ø–∞ –Ω–∞ 2%",
  "üìö –û–±—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –º–æ–∑–≥–∞",
  "üéµ –ú—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–æ–∑–≥–æ–≤—ã–µ –≤–æ–ª–Ω—ã",
  "üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø–ª–æ—Ç–Ω–æ—Å—Ç—å —Å–µ—Ä–æ–≥–æ –≤–µ—â–µ—Å—Ç–≤–∞",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è",
  "üí° –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é —Å–µ—Ç–∏ –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞",
  "üåô –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–Ω –æ—á–∏—â–∞–µ—Ç –º–æ–∑–≥ –æ—Ç —Ç–æ–∫—Å–∏–Ω–æ–≤",
  "üéØ –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–µ–π –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–µ—Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–æ—Ä—É",
  "üìä –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å —É—Å–ø–µ—Ö–æ–º –≤ –∫–∞—Ä—å–µ—Ä–µ",
  "üß† –ú–æ–∑–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏, —á–µ–º –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –æ—Ä–≥–∞–Ω",
  "üí§ –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è",
  "üé™ –§–æ–∫—É—Å –Ω–∞ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã",
  "üíß –í–æ–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–µ—Ä–≤–Ω—ã—Ö –∏–º–ø—É–ª—å—Å–æ–≤",
  "üç´ –ö–∞–∫–∞–æ —É–ª—É—á—à–∞–µ—Ç –ø—Ä–∏—Ç–æ–∫ –∫—Ä–æ–≤–∏ –∫ –º–æ–∑–≥—É",
  "üß¨ –ù–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–∑–≥—É –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –º–æ–∑–≥–∞",
  "üí≠ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω—è–µ—Ç —ç–∫—Å–ø—Ä–µ—Å—Å–∏—é –≥–µ–Ω–æ–≤",
  "üèÉ –§–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ–≤—ã—à–∞—é—Ç —É—Ä–æ–≤–µ–Ω—å BDNF",
  "üìö –ß—Ç–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —ç–º–ø–∞—Ç–∏—é",
  "üéµ –ú—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞",
  "üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ —É–ª—É—á—à–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π",
  "üí° –ò–Ω—Å–∞–π—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è",
  "üåô –†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç",
  "üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã",
  "üìä –≠–º–æ—Ü–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ",
  "üß† –ú–æ–∑–≥ —Å–æ–∑–¥–∞–µ—Ç –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –º—ã –∏—Ö –≤—Å–ø–æ–º–∏–Ω–∞–µ–º",
  "üí§ –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–º—è—Ç—å",
  "üé™ –ü–µ—Ä–µ—Ä—ã–≤—ã —É–ª—É—á—à–∞—é—Ç –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
  "üåø –ó–µ–ª–µ–Ω—å –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏ —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å",
  "üíß –í–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏",
  "üç´ –¢–µ–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–æ–±—Ä–æ–º–∏–Ω, —É–ª—É—á—à–∞—é—â–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
  "üß¨ –ù–æ–≤—ã–µ –Ω–µ–π—Ä–æ–Ω—ã –æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ –≥–∏–ø–ø–æ–∫–∞–º–ø–µ",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã—Ä–∞–∂–∞—Ç—å —ç–º–æ—Ü–∏–∏",
  "üí≠ –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–∞–µ—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —Å—Ç—Ä–µ—Å—Å",
  "üèÉ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ–≤—ã—à–∞—é—Ç —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω–∞",
  "üìö –û–±—É—á–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏",
  "üéµ –ú—É–∑—ã–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ü–µ–Ω—Ç—Ä—ã —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è",
  "üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ–±—ä–µ–º —Å–µ—Ä–æ–≥–æ –≤–µ—â–µ—Å—Ç–≤–∞",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –≤–∞–∂–Ω—ã –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è",
  "üí° –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å—é –æ–ø—ã—Ç—É",
  "üåô –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
  "üéØ –¶–µ–ª–∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—Ç —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è",
  "üìä –≠–º–æ—Ü–∏–∏ –ø–æ–º–æ–≥–∞—é—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è",
  "üß† –ú–æ–∑–≥ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Å—Ä–µ–¥—ã",
  "üí§ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç –ø–∞–º—è—Ç—å",
  "üé™ –§–æ–∫—É—Å –ø–æ–≤—ã—à–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞",
  "üíß –í–æ–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–æ–∑–≥–∞",
  "üç´ –ö–∞–∫–∞–æ —É–ª—É—á—à–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏",
  "üß¨ –ü–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—á–∏—Ç—å—Å—è",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è",
  "üí≠ –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É–ª—É—á—à–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Ä–µ–≥—É–ª—è—Ü–∏—é",
  "üèÉ –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–ª—É—á—à–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
  "üìö –ß—Ç–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å",
  "üéµ –ú—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –º—É—Ä–∞—à–∫–∏",
  "üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ —Å–Ω–∏–∂–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ",
  "üí° –ò–Ω—Å–∞–π—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ –º–æ–º–µ–Ω—Ç—ã –ø–æ–∫–æ—è",
  "üåô –†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é",
  "üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–µ–ª–∏ –ª–µ–≥—á–µ –¥–æ—Å—Ç–∏–≥–∞—Ç—å",
  "üìä –≠–º–æ—Ü–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –≤—Ä–µ–º–µ–Ω–∏",
  "üß† –ú–æ–∑–≥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ",
  "üí§ –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å –Ω–∞–≤—ã–∫–∏",
  "üé™ –û—Ç–¥—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ",
  "üíß –í–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å",
  "üç´ –®–æ–∫–æ–ª–∞–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–µ–Ω–∏–ª—ç—Ç–∏–ª–∞–º–∏–Ω ‚Äî –º–æ–ª–µ–∫—É–ª—É –ª—é–±–≤–∏",
  "üß¨ –ù–µ–π—Ä–æ–≥–µ–Ω–µ–∑ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å —ç–º–æ—Ü–∏—è–º–∏",
  "üí≠ –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å —É–ª—É—á—à–∞–µ—Ç —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å",
  "üèÉ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ–≤—ã—à–∞—é—Ç —É—Ä–æ–≤–µ–Ω—å —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤",
  "üìö –û–±—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –¥–æ—Ñ–∞–º–∏–Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É",
  "üéµ –ú—É–∑—ã–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Ä–¥–µ—á–Ω—ã–π —Ä–∏—Ç–º",
  "üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–∑–≥–∞",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ —Å–Ω–∏–∂–∞—é—Ç —Ä–∏—Å–∫ –¥–µ–º–µ–Ω—Ü–∏–∏",
  "üí° –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É —Ñ–æ–∫—É—Å–æ–º –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ–º",
  "üåô –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç–º–æ—Ü–∏–∏",
  "üéØ –¶–µ–ª–∏ –¥–∞—é—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–º—ã—Å–ª",
  "üìä –≠–º–æ—Ü–∏–∏ –ø–æ–º–æ–≥–∞—é—Ç –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å —Å–æ–±—ã—Ç–∏—è",
  "üß† –ú–æ–∑–≥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ",
  "üí§ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏—é",
  "üé™ –ü–µ—Ä–µ—Ä—ã–≤—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –≤—ã–≥–æ—Ä–∞–Ω–∏–µ",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ",
  "üíß –í–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º",
  "üç´ –ö–∞–∫–∞–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞–≥–Ω–∏–π, —É–ª—É—á—à–∞—é—â–∏–π —Å–æ–Ω",
  "üß¨ –ü–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –º—ã—à–ª–µ–Ω–∏—è",
  "üí≠ –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–∏",
  "üèÉ –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–∫—Ä–µ–ø–ª—è–µ—Ç –∫–æ—Å—Ç–∏",
  "üìö –ß—Ç–µ–Ω–∏–µ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ",
  "üéµ –ú—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç —Å–Ω–∏–∂–∞—Ç—å –±–æ–ª—å",
  "üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ —É–ª—É—á—à–∞–µ—Ç —Å–æ–Ω",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∞–∂–Ω–∞ –¥–ª—è –≤—ã–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–∏—è",
  "üí° –ò–Ω—Å–∞–π—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
  "üåô –†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º",
  "üéØ –¶–µ–ª–∏ –ø–æ–º–æ–≥–∞—é—Ç —Ä–∞—Å—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã",
  "üìä –≠–º–æ—Ü–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –∏–º–º—É–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É",
  "üß† –ú–æ–∑–≥ —Å–æ–∑–¥–∞–µ—Ç –º–æ–¥–µ–ª–∏ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏",
  "üí§ –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ç–µ–ª–æ",
  "üé™ –û—Ç–¥—ã—Ö —É–ª—É—á—à–∞–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ —Å–Ω–∏–∂–∞–µ—Ç –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ",
  "üíß –í–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ",
  "üç´ –®–æ–∫–æ–ª–∞–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç—ã",
  "üß¨ –ù–µ–π—Ä–æ–≥–µ–Ω–µ–∑ —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç—Å—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
  "üí≠ –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å —É–ª—É—á—à–∞–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è",
  "üèÉ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ–≤—ã—à–∞—é—Ç –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å",
  "üìö –û–±—É—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –∫—Ä—É–≥–æ–∑–æ—Ä",
  "üéµ –ú—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç —É–ª—É—á—à–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é",
  "üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è —Å–Ω–∏–∂–∞–µ—Ç –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –¥–∞—é—Ç —á—É–≤—Å—Ç–≤–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏",
  "üí° –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –æ–ø—ã—Ç–∞",
  "üåô –°–æ–Ω –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞—Å—Ç–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è",
  "üéØ –¶–µ–ª–∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—Ç –∫ –¥–µ–π—Å—Ç–≤–∏—é",
  "üìä –≠–º–æ—Ü–∏–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –º–∏—Ä–µ",
  "üß† –ú–æ–∑–≥ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
  "üí§ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç",
  "üé™ –ü–µ—Ä–µ—Ä—ã–≤—ã –ø–æ–≤—ã—à–∞—é—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—é",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
  "üíß –í–æ–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è –∂–∏–∑–Ω–∏",
  "üç´ –ö–∞–∫–∞–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∂–µ–ª–µ–∑–æ",
  "üß¨ –ü–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞ ‚Äî –æ—Å–Ω–æ–≤–∞ –æ–±—É—á–µ–Ω–∏—è",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ",
  "üí≠ –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É–ª—É—á—à–∞–µ—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É",
  "üèÉ –§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–∫—Ä–µ–ø–ª—è–µ—Ç —Å–µ—Ä–¥—Ü–µ",
  "üìö –ß—Ç–µ–Ω–∏–µ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç —ç–º–ø–∞—Ç–∏—é",
  "üéµ –ú—É–∑—ã–∫–∞ –º–æ–∂–µ—Ç —É–ª—É—á—à–∞—Ç—å –ø–∞–º—è—Ç—å",
  "üßò –ü—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏ —Å–Ω–∏–∂–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∞–µ—Ç —Å–∏–ª—ã",
  "üí° –ò–Ω—Å–∞–π—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –ø—Ä–∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–∏",
  "üåô –†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω —É–ª—É—á—à–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ",
  "üéØ –¶–µ–ª–∏ –ø–æ–º–æ–≥–∞—é—Ç –∏–∑–º–µ—Ä—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å",
  "üìä –≠–º–æ—Ü–∏–∏ –¥–µ–ª–∞—é—Ç –∂–∏–∑–Ω—å —è—Ä—á–µ",
  "üß† –ú–æ–∑–≥ ‚Äî —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π –æ—Ä–≥–∞–Ω",
  "üí§ –°–æ–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è",
  "üé™ –û—Ç–¥—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é",
  "üåø –ü—Ä–∏—Ä–æ–¥–∞ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç —É–º",
  "üíß –í–æ–¥–∞ —É–ª—É—á—à–∞–µ—Ç –∫–æ–∂—É",
  "üç´ –®–æ–∫–æ–ª–∞–¥ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
  "üß¨ –ù–µ–π—Ä–æ–≥–µ–Ω–µ–∑ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—Å—é –∂–∏–∑–Ω—å",
  "üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å",
  "üí≠ –û—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å —É–ª—É—á—à–∞–µ—Ç —Ñ–æ–∫—É—Å",
  "üèÉ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —É–∫—Ä–µ–ø–ª—è—é—Ç –º—ã—à—Ü—ã",
  "üìö –û–±—É—á–µ–Ω–∏–µ –æ–±–æ–≥–∞—â–∞–µ—Ç –∂–∏–∑–Ω—å",
  "üéµ –ú—É–∑—ã–∫–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ª—é–¥–µ–π",
  "üßò –ú–µ–¥–∏—Ç–∞—Ü–∏—è —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç —É–º",
  "ü§ù –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –¥–µ–ª–∞—é—Ç –Ω–∞—Å —Å—á–∞—Å—Ç–ª–∏–≤–µ–µ"
];

function LoadingMessage() {
  const [factIndex, setFactIndex] = useState(0);
  const [showFact, setShowFact] = useState(false);
  const [key, setKey] = useState(0); // –î–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ñ–∞–∫—Ç–∞

  useEffect(() => {
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–∫—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ä–µ–Ω–¥–µ—Ä–µ
    setFactIndex(Math.floor(Math.random() * INTERESTING_FACTS.length));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∑–∞—Ç–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞—á–∏–Ω–∞–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–∞–∫—Ç—ã
    const factTimer = setTimeout(() => setShowFact(true), 2000);
    
    // –ú–µ–Ω—è–µ–º —Ñ–∞–∫—Ç—ã –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–π
    const interval = setInterval(() => {
      setFactIndex(() => {
        const randomIndex = Math.floor(Math.random() * INTERESTING_FACTS.length);
        setKey(prev => prev + 1); // –ú–µ–Ω—è–µ–º key –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        return randomIndex;
      });
    }, 15000);

    return () => {
      clearTimeout(factTimer);
      clearInterval(interval);
    };
  }, []);

  return (
    <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border-2 border-blue-200 p-6 shadow-sm">
      <div className="flex items-start gap-4">
        <div className="flex-shrink-0">
          <svg className="w-6 h-6 animate-spin text-blue-600" viewBox="0 0 24 24">
            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
        </div>
        <div className="flex-grow">
          <div className="font-semibold text-gray-900 mb-2">
            –£–∂–µ –¥–µ–ª–∞—é —Ä–∞—Å—á—ë—Ç, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...
          </div>
          {showFact && (
            <div className="mt-3 p-3 bg-white rounded-xl border border-blue-100" key={key}>
              <div className="text-sm text-gray-700 animate-fade-in">
                {INTERESTING_FACTS[factIndex]}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

type Profile = {
  id: number;
  html?: string | null;
  raw_json?: any;
  created_at?: string;
  client_id?: number | null;
  ui_state?: any;
  notes?: string | null;
  chat_history?: Array<{ role: "user" | "assistant"; content: string }>;
  images?: any; // –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ —Å—Ç—Ä–æ–∫–æ–π
  digits?: any;
};

export default function ProfileDetail() {
  const params = useParams();
  const id = params?.id as string;
  const [profile, setProfile] = useState<Profile | null>(null);
  const [clientName, setClientName] = useState<string>("");
  const [clientBirthDate, setClientBirthDate] = useState<string | null>(null);
  const [question, setQuestion] = useState("");
  const [answer, setAnswer] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);
  const [polling, setPolling] = useState(true);
  const pollingRef = useRef(true);
  const [navigationExpanded, setNavigationExpanded] = useState(true);
  const [expandAll, setExpandAll] = useState(false);
  const localUiStateRef = useRef<Record<string, boolean>>({});
  const [checkedMap, setCheckedMap] = useState<Record<string, boolean>>({});
  const savingCheckboxRef = useRef(false);
  const [notesOpen, setNotesOpen] = useState(false);
  const [notesDraft, setNotesDraft] = useState<string>("");
  const [savingNotes, setSavingNotes] = useState(false);
  const notesTouchedRef = useRef(false);
  const notesOpenRef = useRef(false);
  useEffect(() => { notesOpenRef.current = notesOpen; }, [notesOpen]);
  const [chat, setChat] = useState<Array<{ role: "user" | "assistant"; content: string }>>([]);
  const chatRef = useRef<Array<{ role: "user" | "assistant"; content: string }>>([]);
  useEffect(() => { chatRef.current = chat; }, [chat]);
  const chatBoxRef = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    // –∞–≤—Ç–æ-–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    try {
      chatBoxRef.current?.scrollTo({ top: chatBoxRef.current.scrollHeight, behavior: "smooth" });
    } catch { }
  }, [chat]);

  // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –±–∞–∑–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ –≤ PDF (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞)
  async function exportBasicPDF() {
      let strengths: string[] = [];
      let weaknesses: string[] = [];
      let resourceSignals: string[] = [];
      let deficitSignals: string[] = [];
      
      // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞
      let clientNameForPdf = "";
      try {
        if (profile?.client_id) {
          const clientRes = await fetch(`/api/clients/${profile.client_id}`);
          if (clientRes.ok) {
            const clientData = await clientRes.json().catch(() => ({}));
            clientNameForPdf = clientData?.data?.name || "";
          }
        }
      } catch (e) {
        if (process.env.NODE_ENV === 'development') {
          console.warn("Failed to fetch client name for PDF:", e);
        }
      }
      
      try {
        // –í—ã–±–∏—Ä–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (base_profile_json) –∏–ª–∏ —Å—Ç–∞—Ä—ã–π (raw_json)
        let payload: any = (profile as any)?.base_profile_json || profile?.raw_json;
        if (!payload) {
          alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
          return;
        }
        if (typeof payload === 'string') payload = JSON.parse(payload);
        const item = Array.isArray(payload) ? payload[0] : payload;
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
        if (item?.strengths) {
          if (Array.isArray(item.strengths)) {
            strengths = item.strengths.map((s: any) => {
              if (typeof s === 'string') return s;
              if (typeof s === 'object' && s !== null) {
                return s.text || s.value || s.content || JSON.stringify(s).replace(/[{}"]/g, '');
              }
              return String(s);
            }).filter(Boolean);
          } else if (typeof item.strengths === 'string') {
            strengths = item.strengths.split(/\n+/).filter(Boolean);
          } else if (item.strengths_text) {
            strengths = String(item.strengths_text).split(/\n+/).filter(Boolean);
          }
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
        if (item?.weaknesses) {
          if (Array.isArray(item.weaknesses)) {
            weaknesses = item.weaknesses.map((w: any) => {
              if (typeof w === 'string') return w;
              if (typeof w === 'object' && w !== null) {
                return w.text || w.value || w.content || JSON.stringify(w).replace(/[{}"]/g, '');
              }
              return String(w);
            }).filter(Boolean);
          } else if (typeof item.weaknesses === 'string') {
            weaknesses = item.weaknesses.split(/\n+/).filter(Boolean);
          } else if (item.weaknesses_text) {
            weaknesses = String(item.weaknesses_text).split(/\n+/).filter(Boolean);
          }
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–ª—é—Å–∞
        if (item?.resourceSignals) {
          if (Array.isArray(item.resourceSignals)) {
            resourceSignals = item.resourceSignals.map((r: any) => {
              if (typeof r === 'string') return r;
              if (typeof r === 'object' && r !== null) {
                return r.text || r.value || r.content || JSON.stringify(r).replace(/[{}"]/g, '');
              }
              return String(r);
            }).filter(Boolean);
          } else if (typeof item.resourceSignals === 'string') {
            resourceSignals = item.resourceSignals.split(/\n+/).filter(Boolean);
          } else if (item.resourceSignals_text) {
            resourceSignals = String(item.resourceSignals_text).split(/\n+/).filter(Boolean);
          }
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –º–∏–Ω—É—Å–∞
        if (item?.deficitSignals) {
          if (Array.isArray(item.deficitSignals)) {
            deficitSignals = item.deficitSignals.map((d: any) => {
              if (typeof d === 'string') return d;
              if (typeof d === 'object' && d !== null) {
                return d.text || d.value || d.content || JSON.stringify(d).replace(/[{}"]/g, '');
              }
              return String(d);
            }).filter(Boolean);
          } else if (typeof item.deficitSignals === 'string') {
            deficitSignals = item.deficitSignals.split(/\n+/).filter(Boolean);
          } else if (item.deficitSignals_text) {
            deficitSignals = String(item.deficitSignals_text).split(/\n+/).filter(Boolean);
          }
        }
      } catch (error) {
        if (process.env.NODE_ENV === 'development') {
          console.error('Error processing data for PDF:', error);
        }
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è PDF');
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
      if (strengths.length === 0 && weaknesses.length === 0 && resourceSignals.length === 0 && deficitSignals.length === 0) {
        alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω.');
        if (process.env.NODE_ENV === 'development') {
          console.error('PDF Export: No data found');
        }
        return;
        }
        
      if (process.env.NODE_ENV === 'development') {
        console.log('PDF Export: Data found', {
          strengths: strengths.length,
          weaknesses: weaknesses.length,
          resourceSignals: resourceSignals.length,
          deficitSignals: deficitSignals.length
        });
      }
      
      const dateStr = profile?.created_at ? new Date(profile.created_at).toLocaleDateString('ru-RU') : '';
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞
      const cleanText = (text: string): string => {
        if (!text) return '';
        let cleaned = String(text);
        cleaned = cleaned.replace(/\{[^}]*\}/g, '');
        cleaned = cleaned.replace(/\s+/g, ' ').trim();
        return cleaned;
      };
      
      const escapeHtml = (s: string): string =>
        String(s)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      
      // –°–æ–∑–¥–∞–µ–º HTML —Å –∫—Ä–∞—Å–∏–≤—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è
      const html = `
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
    @page {
      size: A4;
      margin: 12mm;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: #1A1A1A;
      background: #FAF9F7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: geometricPrecision;
      font-kerning: normal;
    }
    .page {
      /* Defaults (–±—É–¥–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–º–µ–Ω—å—à–∞—Ç—å, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –≤–ª–∞–∑–∏—Ç) */
      --pdf-title-fs: 18px;
      --pdf-subtitle-fs: 11px;
      --pdf-section-fs: 20px;
      --pdf-li-fs: 12.8px;
      --pdf-li-lh: 1.5;
      --pdf-li-gap: 10px;
      --pdf-li-pad-y: 12px;
      --pdf-li-pad-x: 14px;
      --accent: #4A6FA5;
      --accent-soft: rgba(74, 111, 165, 0.08);
      --accent-light: rgba(74, 111, 165, 0.12);

      page-break-after: always;
      page-break-inside: avoid;
      width: 210mm;
      height: 297mm;
      padding: 12mm 12mm 10mm 12mm;
      display: flex;
      flex-direction: column;
      background:
        radial-gradient(2000px circle at 20% 30%, rgba(74, 111, 165, 0.03), transparent 50%),
        radial-gradient(1800px circle at 80% 70%, rgba(91, 127, 184, 0.02), transparent 50%),
        linear-gradient(180deg, #FAF9F7 0%, #F5F4F2 50%, #FAF9F7 100%);
      overflow: hidden;
      box-sizing: border-box;
      position: relative;
    }
    .page::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), rgba(74, 111, 165, 0.4));
      opacity: 0.6;
    }
    .page:last-child {
      page-break-after: auto;
    }
    /* –í—Å–µ —Å–µ–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω —Å–ø–æ–∫–æ–π–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç */
    .page.strengths { --accent: #4A6FA5; --accent-soft: rgba(74, 111, 165, 0.08); --accent-light: rgba(74, 111, 165, 0.12); }
    .page.weaknesses { --accent: #4A6FA5; --accent-soft: rgba(74, 111, 165, 0.08); --accent-light: rgba(74, 111, 165, 0.12); }
    .page.plus { --accent: #4A6FA5; --accent-soft: rgba(74, 111, 165, 0.08); --accent-light: rgba(74, 111, 165, 0.12); }
    .page.minus { --accent: #4A6FA5; --accent-soft: rgba(74, 111, 165, 0.08); --accent-light: rgba(74, 111, 165, 0.12); }

    .header {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.5);
      flex-shrink: 0;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 12px;
    }
    .brand {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    .brand-mark {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
      flex-shrink: 0;
    }
    .brand-name {
      font-size: 9px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-weight: 600;
      color: #6B6B6B;
    }
    .header-left { min-width: 0; }
    .title {
      font-size: var(--pdf-title-fs);
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 4px;
      color: #1A1A1A;
    }
    .subtitle {
      font-size: var(--pdf-subtitle-fs);
      color: #6B6B6B;
      font-weight: 400;
    }
    .section-title {
      font-size: var(--pdf-section-fs);
      font-weight: 600;
      color: #1A1A1A;
      margin: 12px 0 14px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.4);
      letter-spacing: -0.02em;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .section-title::before {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
      flex-shrink: 0;
    }
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      overflow: hidden;
      min-height: 0;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
      flex: 1;
      overflow: hidden;
      /* –î–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–µ–∂–∏–º–∞ –≤ 2 –∫–æ–ª–æ–Ω–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º columns */
      column-count: 1;
      column-gap: 12px;
    }
    li {
      break-inside: avoid;
      margin: 0 0 var(--pdf-li-gap) 0;
      padding: var(--pdf-li-pad-y) var(--pdf-li-pad-x) var(--pdf-li-pad-y) calc(var(--pdf-li-pad-x) + 20px);
      position: relative;
      line-height: var(--pdf-li-lh);
      font-size: var(--pdf-li-fs);
      color: #1A1A1A;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-left: 2px solid var(--accent);
      box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.04), 0 0 0 1px rgba(255, 255, 255, 0.6);
    }
    li::before {
      content: "";
      position: absolute;
      left: 12px;
      top: 14px;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 2px var(--accent-soft);
    }
    .footer {
      margin-top: auto;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.5);
      font-size: 10px;
      color: #8B8B8B;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      font-weight: 400;
    }
    /* –ï—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–µ –≤–ª–∞–∑–∏—Ç ‚Äî –≤–∫–ª—é—á–∏–º 2 –∫–æ–ª–æ–Ω–∫–∏ */
    .page.compact-2col ul { column-count: 2; }
  </style>
</head>
<body>
  ${strengths.length > 0 ? `
  <div class="page strengths">
    <div class="header">
      <div class="header-left">
      <div class="title">${escapeHtml(clientNameForPdf || '–†–∞—Å—á—ë—Ç –ø—Ä–æ—Ñ–∏–ª—è')}</div>
      ${dateStr ? `<div class="subtitle">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${escapeHtml(dateStr)}</div>` : ''}
      </div>
      <div class="brand">
        <span class="brand-mark"></span>
        <span class="brand-name">–°–ê–õ –ü–†–û–§–ò</span>
      </div>
      </div>
    <div class="content">
      <h2 class="section-title">–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</h2>
      <ul>
        ${strengths.map((s: string) => {
          const cleaned = cleanText(s);
          return cleaned ? `<li>${escapeHtml(cleaned)}</li>` : '';
        }).filter(Boolean).join('')}
      </ul>
    </div>
    <div class="footer">
      <span>–°–ê–õ –ü–†–û–§–ò</span>
      <span>–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç</span>
    </div>
  </div>
  ` : ''}
  
  ${weaknesses.length > 0 ? `
  <div class="page weaknesses">
    <div class="header">
      <div class="header-left">
      <div class="title">${escapeHtml(clientNameForPdf || '–†–∞—Å—á—ë—Ç –ø—Ä–æ—Ñ–∏–ª—è')}</div>
      ${dateStr ? `<div class="subtitle">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${escapeHtml(dateStr)}</div>` : ''}
      </div>
      <div class="brand">
        <span class="brand-mark"></span>
        <span class="brand-name">–°–ê–õ –ü–†–û–§–ò</span>
      </div>
    </div>
    <div class="content">
      <h2 class="section-title">–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</h2>
      <ul>
        ${weaknesses.map((w: string) => {
          const cleaned = cleanText(w);
          return cleaned ? `<li>${escapeHtml(cleaned)}</li>` : '';
        }).filter(Boolean).join('')}
      </ul>
    </div>
    <div class="footer">
      <span>–°–ê–õ –ü–†–û–§–ò</span>
      <span>–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç</span>
    </div>
  </div>
  ` : ''}
  
  ${resourceSignals.length > 0 ? `
  <div class="page plus">
    <div class="header">
      <div class="header-left">
      <div class="title">${escapeHtml(clientNameForPdf || '–†–∞—Å—á—ë—Ç –ø—Ä–æ—Ñ–∏–ª—è')}</div>
      ${dateStr ? `<div class="subtitle">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${escapeHtml(dateStr)}</div>` : ''}
      </div>
      <div class="brand">
        <span class="brand-mark"></span>
        <span class="brand-name">–°–ê–õ –ü–†–û–§–ò</span>
      </div>
    </div>
    <div class="content">
      <h2 class="section-title">–ü—Ä–∏–∑–Ω–∞–∫–∏ –ø–ª—é—Å–∞</h2>
        <ul>
        ${resourceSignals.map((r: string) => {
            const cleaned = cleanText(r);
          return cleaned ? `<li>${escapeHtml(cleaned)}</li>` : '';
          }).filter(Boolean).join('')}
        </ul>
    </div>
    <div class="footer">
      <span>–°–ê–õ –ü–†–û–§–ò</span>
      <span>–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç</span>
    </div>
      </div>
      ` : ''}
  
      ${deficitSignals.length > 0 ? `
  <div class="page minus">
    <div class="header">
      <div class="header-left">
      <div class="title">${escapeHtml(clientNameForPdf || '–†–∞—Å—á—ë—Ç –ø—Ä–æ—Ñ–∏–ª—è')}</div>
      ${dateStr ? `<div class="subtitle">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: ${escapeHtml(dateStr)}</div>` : ''}
      </div>
      <div class="brand">
        <span class="brand-mark"></span>
        <span class="brand-name">–°–ê–õ –ü–†–û–§–ò</span>
      </div>
    </div>
    <div class="content">
      <h2 class="section-title">–ü—Ä–∏–∑–Ω–∞–∫–∏ –º–∏–Ω—É—Å–∞</h2>
        <ul>
        ${deficitSignals.map((d: string) => {
            const cleaned = cleanText(d);
          return cleaned ? `<li>${escapeHtml(cleaned)}</li>` : '';
          }).filter(Boolean).join('')}
        </ul>
    </div>
    <div class="footer">
      <span>–°–ê–õ –ü–†–û–§–ò</span>
      <span>–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç</span>
    </div>
  </div>
  ` : ''}
</body>
</html>`;
      
      // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–∂–¥—É—é .page –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ html2canvas –∏ —Å–æ–±–∏—Ä–∞–µ–º –≤ jsPDF
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      const parserError = doc.querySelector('parsererror');
      if (parserError) {
        if (process.env.NODE_ENV === 'development') {
          console.error('HTML parsing error:', parserError.textContent);
        }
        alert('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML: ' + parserError.textContent);
        return;
      }
      
      const bodyContent = doc.body;
      const styleElement = doc.querySelector('style');
      if (!bodyContent || bodyContent.children.length === 0) {
        alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è PDF');
        return;
      }
      
      const element = document.createElement('div');
      element.id = 'pdf-export-container';
      element.style.position = 'fixed';
      element.style.left = '0';
      element.style.top = '-10000px';
      element.style.width = '210mm';
      element.style.backgroundColor = '#FAF9F7';
      element.style.opacity = '1';
      element.style.visibility = 'visible';
      element.style.pointerEvents = 'none';
      element.style.zIndex = '999999';
      
      // –í–ê–ñ–ù–û: —Å—Ç–∏–ª–∏ –∫–ª–∞–¥—ë–º –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—Ç–∞–∫ html2canvas –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏—Ö –≤–∏–¥–∏—Ç)
      if (styleElement) {
        const style = document.createElement('style');
        style.textContent = styleElement.textContent || '';
        element.appendChild(style);
      }
      
      const bodyClone = bodyContent.cloneNode(true) as HTMLElement;
      while (bodyClone.firstChild) {
        element.appendChild(bodyClone.firstChild);
      }
      
      document.body.appendChild(element);
      
      try {
        // @ts-ignore
        if (document.fonts?.ready) {
          // @ts-ignore
          await document.fonts.ready;
        }
        await new Promise(resolve => requestAnimationFrame(() => resolve(null)));

        const pages = Array.from(element.querySelectorAll<HTMLElement>('.page'));
        if (pages.length === 0) {
          alert('–û—à–∏–±–∫–∞: —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è PDF –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
        return;
      }
      
        // –ü–æ–¥–≥–æ–Ω—è–µ–º —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫—É, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –æ–±—Ä–µ–∑–∞–ª–æ—Å—å
        const fitPage = async (pageEl: HTMLElement) => {
          let titleFs = 18;
          let sectionFs = 20;
          let liFs = 12.8;
          let liGap = 10;
          let liPadY = 12;

          const apply = () => {
            pageEl.style.setProperty('--pdf-title-fs', `${titleFs}px`);
            pageEl.style.setProperty('--pdf-section-fs', `${sectionFs}px`);
            pageEl.style.setProperty('--pdf-li-fs', `${liFs}px`);
            pageEl.style.setProperty('--pdf-li-gap', `${liGap}px`);
            pageEl.style.setProperty('--pdf-li-pad-y', `${liPadY}px`);
          };

          apply();
          // –Ω–µ–±–æ–ª—å—à–æ–π —Ü–∏–∫–ª —É–º–µ–Ω—å—à–µ–Ω–∏—è –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –≤–ª–µ–∑–µ—Ç –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É A4
          for (let step = 0; step < 14; step++) {
            await new Promise(resolve => requestAnimationFrame(() => resolve(null)));
            if (pageEl.scrollHeight <= pageEl.clientHeight) return;
            liFs = Math.max(11.2, liFs - 0.4);
            liGap = Math.max(8, liGap - 0.5);
            liPadY = Math.max(10, liPadY - 0.5);
            sectionFs = Math.max(16, sectionFs - 0.5);
            titleFs = Math.max(16, titleFs - 0.3);
            apply();
          }

          // –§–æ–ª–ª–±–µ–∫: 2 –∫–æ–ª–æ–Ω–∫–∏ (–µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –¥–ª–∏–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã)
          await new Promise(resolve => requestAnimationFrame(() => resolve(null)));
          if (pageEl.scrollHeight > pageEl.clientHeight) {
            pageEl.classList.add('compact-2col');
            await new Promise(resolve => requestAnimationFrame(() => resolve(null)));
          }

          // –ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å ‚Äî –µ—â—ë —á—É—Ç—å —É–º–µ–Ω—å—à–∏—Ç—å –ø–æ—Å–ª–µ 2 –∫–æ–ª–æ–Ω–æ–∫
          for (let step = 0; step < 6; step++) {
            if (pageEl.scrollHeight <= pageEl.clientHeight) return;
            liFs = Math.max(10.8, liFs - 0.3);
            liGap = Math.max(8, liGap - 0.4);
            liPadY = Math.max(10, liPadY - 0.4);
            apply();
            await new Promise(resolve => requestAnimationFrame(() => resolve(null)));
          }
        };

        for (const pageEl of pages) {
          // eslint-disable-next-line no-await-in-loop
          await fitPage(pageEl);
        }

        const filename = `–ë–∞–∑–æ–≤—ã–π_—Ä–∞—Å—á–µ—Ç_${(clientNameForPdf || '–ø—Ä–æ—Ñ–∏–ª—å').replace(/\\s+/g, '_')}_${dateStr || new Date().toLocaleDateString('ru-RU')}.pdf`;

        const pdf = new jsPDF({
          unit: 'mm',
          format: 'a4',
          orientation: 'portrait',
          compress: true,
        });

        for (let i = 0; i < pages.length; i++) {
          const pageEl = pages[i];
          const canvas = await html2canvas(pageEl, {
          scale: 2, 
          useCORS: true,
          backgroundColor: '#FAF9F7',
            logging: false,
          });
          const imgData = canvas.toDataURL('image/jpeg', 0.95);
          if (i > 0) pdf.addPage('a4', 'portrait');
          pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
        }

        pdf.save(filename);
      } catch (error) {
        if (process.env.NODE_ENV === 'development') {
          console.error('[PDF Export] Error generating PDF:', error);
        }
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF: ' + (error instanceof Error ? error.message : String(error)));
      } finally {
        if (element.parentNode) document.body.removeChild(element);
        }
  }

  function AccordionSection({ title, children, id }: { title: string; children: React.ReactNode; id?: string }) {
    // –í—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç–æ, –±–µ–∑ –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–æ—Å—å —Å–∞–º–æ
    return (
      <div id={id} className="rounded-2xl border-2 border-blue-200 bg-white overflow-hidden shadow-sm">
        <div className="w-full flex items-center justify-between px-6 py-4 text-left bg-white">
          <span className="font-semibold text-gray-900">{title}</span>
        </div>
        <div className="p-6">{children}</div>
      </div>
    );
  }

  // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–ª–ª–∏–Ω–≥ –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è html/–¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    let mounted = true;
    let tries = 0;
    const maxTries = 90; // –¥–æ ~3 –º–∏–Ω—É—Ç

    async function fetchOnce() {
      let data: any = null;
      let responseStatus: number | null = null;
      try {
        const res = await fetch(`/api/profiles/${id}?_=${Date.now()}`, {
          cache: "no-store",
          credentials: "include",
          headers: { Accept: "application/json" },
          mode: "same-origin",
        } as RequestInit);
        responseStatus = res.status;
        if (!res.ok) {
          // 401/403/5xx ‚Äî –º—è–≥–∫–æ –∑–∞–≤–µ—Ä—à–∞–µ–º –ø–æ–ø—ã—Ç–∫—É
          try { data = await res.json(); } catch { data = null; }
        } else {
          data = await res.json();
        }
      } catch {
        // network/CORS ‚Äî –Ω–µ —Ä–æ–Ω—è–µ–º, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ–∑–∂–µ
        data = null;
      }
      if (!mounted) return;
      const p = data?.data || null;
      
      // Debug logging removed to reduce console noise
      
      // –µ—Å–ª–∏ –∏–¥—ë—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–æ–≤ ‚Äî –Ω–µ –ø–µ—Ä–µ—Ç–∏—Ä–∞—Ç—å ui_state
      setProfile(prev => {
        if (!prev) return p;
        if (savingCheckboxRef.current && prev?.ui_state?.checked) {
          return { ...p, ui_state: prev.ui_state };
        }
        return p;
      });
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤ –∏–∑ ui_state + —Å–ª–∏—è–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
      const serverChecked: Record<string, boolean> = (p?.ui_state?.checked as any) || {};
      const merged = { ...serverChecked, ...localUiStateRef.current };
      setCheckedMap(merged);
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–º–µ—Ç–æ–∫: –Ω–µ –ø–µ—Ä–µ—Ç–∏—Ä–∞–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–µ–π—á–∞—Å
      if (!notesTouchedRef.current && !notesOpenRef.current) {
        setNotesDraft(p?.notes || "");
      }
      if (Array.isArray(p?.chat_history) && chatRef.current.length === 0) {
        setChat(p.chat_history);
      }
      // –ü–æ–¥—Ç—è–Ω–µ–º –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è
      if (p?.client_id) {
        try {
          const rc = await fetch(`/api/clients/${p.client_id}`, { cache: "no-store" });
          const cj = await rc.json().catch(() => ({}));
          const client = cj?.data;
          if (client?.name) setClientName(client.name);
          if (client?.birth_date) setClientBirthDate(client.birth_date);
        } catch { }
      }
      const htmlCandidate = p?.html || p?.raw_html || p?.content || p?.html_content;
      const hasRenderableHtml = Boolean(htmlCandidate && String(htmlCandidate).trim().length > 0);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º raw_json –±–æ–ª–µ–µ —Ç—â–∞—Ç–µ–ª—å–Ω–æ
      let hasRaw = false;
      if (p?.raw_json) {
        try {
          // raw_json –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–º
          let rawStr: string;
          if (typeof p.raw_json === 'string') {
            rawStr = p.raw_json.trim();
            // –ï—Å–ª–∏ —ç—Ç–æ JSON-—Å—Ç—Ä–æ–∫–∞, –ø–æ–ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            try {
              const parsed = JSON.parse(rawStr);
              // –ï—Å–ª–∏ —Ä–∞—Å–ø–∞—Ä—Å–∏–ª–æ—Å—å, –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –Ω–µ –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç/–º–∞—Å—Å–∏–≤
              if (typeof parsed === 'object' && parsed !== null) {
                hasRaw = Object.keys(parsed).length > 0 || Array.isArray(parsed) && parsed.length > 0;
              } else {
                hasRaw = rawStr.length > 2 && rawStr !== 'null' && rawStr !== 'undefined';
              }
            } catch {
              // –ù–µ JSON, –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∞ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
              hasRaw = rawStr.length > 2;
            }
          } else {
            // –≠—Ç–æ —É–∂–µ –æ–±—ä–µ–∫—Ç
            rawStr = JSON.stringify(p.raw_json);
            hasRaw = rawStr.length > 2 && rawStr !== '{}' && rawStr !== '[]' && rawStr !== 'null';
          }
        } catch {
          hasRaw = false;
        }
      }
      
      // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ digits (–º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–∞–∂–µ –±–µ–∑ html)
      const hasDigits = Boolean(p?.digits && (
        (Array.isArray(p.digits) && p.digits.length > 0) ||
        (typeof p.digits === 'string' && p.digits.trim().length > 0)
      ));
      
      tries += 1;
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ base_profile_json
          const hasBaseProfileJson = !!((p as any)?.base_profile_json && (
            (typeof (p as any).base_profile_json === 'string' && (p as any).base_profile_json.trim().length > 50) ||
            (typeof (p as any).base_profile_json === 'object' && Object.keys((p as any).base_profile_json).length > 0)
          ));
          
          // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–ª–∏–Ω–≥ –µ—Å–ª–∏:
          // 1. –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (raw_json –∏–ª–∏ base_profile_json)
          // 2. –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫
          // 3. –ü–æ–ª—É—á–∏–ª–∏ 401 –∏ refresh –Ω–µ –ø–æ–º–æ–≥ (–Ω—É–∂–µ–Ω –ø–µ—Ä–µ–ª–æ–≥–∏–Ω)
          const isUnauthorized = responseStatus === 401 && !p;
          // –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ digits: –∫–æ–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å, –Ω–æ —Å–∞–º —Ä–∞—Å—á–µ—Ç –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤.
          // –ü—É—Å—Ç—å –ø–æ–ª–ª–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è html/raw_json/base_profile_json (–∏–ª–∏ –ø–æ maxTries).
          const shouldStop = hasRenderableHtml || hasRaw || hasBaseProfileJson || tries >= maxTries || isUnauthorized;
      
      if (shouldStop) {
        if (pollingRef.current) {
        setPolling(false);
        pollingRef.current = false;
          // Debug logging removed to reduce console noise
        }
      } else {
        // –õ–æ–≥–∏ –ø–æ–ª–ª–∏–Ω–≥–∞ —É–±—Ä–∞–Ω—ã, —á—Ç–æ–±—ã –Ω–µ —à—É–º–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –ø—Ä–æ–¥–µ)
      }
    }

    // –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å
    fetchOnce();
    // –¥–∞–ª–µ–µ –ø–æ–ª–ª–∏–Ω–≥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—â–µ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
    const interval = setInterval(() => {
      if (pollingRef.current) {
        fetchOnce();
      } else {
        clearInterval(interval);
      }
    }, 1800);

    return () => {
      mounted = false;
      clearInterval(interval);
    };
  }, [id]);

  async function ask(e: React.FormEvent) {
    e.preventDefault();
    const q = question.trim();
    if (!q) return;
    setLoading(true);
    setAnswer("");
    // –¥–æ–±–∞–≤–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∏—Å—Ç–æ—Ä–∏—é
    const history: Array<{ role: "user" | "assistant"; content: string }> = [...chatRef.current, { role: "user" as const, content: q }];
    setChat(history);
    setQuestion("");
    try {
      const res = await fetch(`/api/qa?stream=1`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Accept: "text/event-stream", "Cache-Control": "no-cache" },
        body: JSON.stringify({
          profileId: Number(id),
          question: q,
          history: chatRef.current.slice(-8),
          stream: true,
        }),
      } as RequestInit);

      // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–¥–∞–ª –ø–æ—Ç–æ–∫ ‚Äî fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π json
      if (!res.body || (res.headers.get("content-type") || "").indexOf("text/event-stream") === -1) {
        let a = "–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞";
        let errorMessage = "";
        try {
          const data = await res.json();
          a = data?.answer || data?.message || a;
          errorMessage = data?.error || "";
          
          // –ï—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          if (!res.ok) {
            if (res.status === 401) {
              a = "–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á OpenAI. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞.";
            } else if (res.status === 429) {
              a = "–û—à–∏–±–∫–∞: –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAI API. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
            } else if (data?.message) {
              a = `–û—à–∏–±–∫–∞: ${data.message}`;
            } else {
              a = `–û—à–∏–±–∫–∞: ${res.status} ${res.statusText}`;
            }
          }
        } catch {
          a = `–û—à–∏–±–∫–∞: ${res.status} ${res.statusText || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}`;
        }
        const newHistory: Array<{ role: "user" | "assistant"; content: string }> = [...history, { role: "assistant" as const, content: a }];
        setAnswer(a);
        setChat(newHistory);
        await saveChatHistory(newHistory);
        setLoading(false);
        return;
      }

      const reader = res.body.getReader();
      const decoder = new TextDecoder();
      let acc = "";
      // –¥–æ–±–∞–≤–∏–º –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞, –±—É–¥–µ–º –¥–æ–ø–∏—Å—ã–≤–∞—Ç—å
      setChat((prev) => [...prev, { role: "assistant", content: "" }]);
      
      try {
      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
          
        const chunk = decoder.decode(value, { stream: true });
          // SSE —Ñ–æ—Ä–º–∞—Ç: –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ "data: —Ç–µ–∫—Å—Ç\n\n"
          const lines = chunk.split("\n");
          
          for (const line of lines) {
            if (!line.trim()) continue;
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ-SSE —Å—Ç—Ä–æ–∫–∏
            if (!line.startsWith("data:")) continue;
            
            const payload = line.slice(5).trim(); // –£–±–∏—Ä–∞–µ–º "data:"
            
            if (payload === "[DONE]") {
              break;
            }
            
            // Payload –º–æ–∂–µ—Ç –±—ã—Ç—å JSON —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
            // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
            let textChunk = payload;
            try {
              const parsed = JSON.parse(payload);
              if (typeof parsed === 'string') {
                textChunk = parsed;
              }
            } catch {
              // –ï—Å–ª–∏ –Ω–µ JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
              textChunk = payload;
            }
            acc += textChunk;
          setAnswer(acc);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
            setChat((prev) => {
              const next = [...prev];
            for (let i = next.length - 1; i >= 0; i--) {
                if (next[i].role === "assistant") {
                  next[i] = { role: "assistant", content: acc };
                  break;
                }
            }
            return next;
          });
            
            // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —á–∞—Ç–∞
            if (chatBoxRef.current) {
              chatBoxRef.current.scrollTop = chatBoxRef.current.scrollHeight;
        }
      }
        }
      } catch (streamError) {
        if (process.env.NODE_ENV === 'development') {
          console.error("Stream reading error:", streamError);
        }
        if (acc) {
          // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ
      const finalHistory: Array<{ role: "user" | "assistant"; content: string }> = [...history, { role: "assistant" as const, content: acc }];
          setChat(finalHistory);
      await saveChatHistory(finalHistory);
        }
      }
      const finalHistory: Array<{ role: "user" | "assistant"; content: string }> = [...history, { role: "assistant" as const, content: acc }];
      await saveChatHistory(finalHistory);
    } catch (err: any) {
      if (process.env.NODE_ENV === 'development') {
        console.error("Chat error:", err);
      }
      const errorMsg = err?.message || "–û—à–∏–±–∫–∞ —á–∞—Ç–∞";
      const errorHistory: Array<{ role: "user" | "assistant"; content: string }> = [...history, { role: "assistant" as const, content: `–û—à–∏–±–∫–∞: ${errorMsg}` }];
      setAnswer(`–û—à–∏–±–∫–∞: ${errorMsg}`);
      setChat(errorHistory);
      await saveChatHistory(errorHistory);
    } finally {
      setLoading(false);
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤ –≤ Directus (profiles.ui_state JSON)
  const saveChecked = useCallback(async (nextMap: Record<string, boolean>) => {
    // –û—á–µ—Ä–µ–¥—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π, —á—Ç–æ–±—ã –∫–ª–∏–∫ –Ω–µ —Ç–µ—Ä—è–ª—Å—è –ø—Ä–∏ –ø–æ–ª–ª–∏–Ω–≥–µ
    (saveChecked as any)._queue = (saveChecked as any)._queue || [];
    (saveChecked as any)._queue.push(nextMap);
    if ((saveChecked as any)._running) return;
    (saveChecked as any)._running = true;
    try {
      savingCheckboxRef.current = true;
      while ((saveChecked as any)._queue.length) {
        const payload = (saveChecked as any)._queue.pop();
        localUiStateRef.current = payload;
        const res = await fetch(`/api/profiles/${id}`, {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          cache: "no-store",
          body: JSON.stringify({ ui_state: { checked: payload } }),
        });
        if (res.ok) setProfile((p) => (p ? { ...p, ui_state: { checked: payload } } : p));
      }
    } finally {
      savingCheckboxRef.current = false;
      (saveChecked as any)._running = false;
    }
  }, [id]);
  // Persist chat history in Directus
  const saveChatHistory = useCallback(async (history: Array<{ role: "user" | "assistant"; content: string }>) => {
    try {
      await fetch(`/api/profiles/${id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_history: history }),
      });
    } catch { }
  }, [id]);

  // –ö–ª—é—á–∏ —á–µ–∫–±–æ–∫—Å–æ–≤: –Ω–æ–≤—ã–π (–ø–æ —Ö—ç—à—É —Ç–µ–∫—Å—Ç–∞) + –ª–µ–≥–∞—Å–∏ (–ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ —É—Å–µ—á—ë–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É)
  function normalizeTextForHash(text: string): string {
    return (text || "").toString().replace(/\s+/g, " ").trim();
  }
  function hashString(input: string): string {
    // –ø—Ä–æ—Å—Ç–∞—è FNV-1a 32-bit
    let h = 0x811c9dc5;
    for (let i = 0; i < input.length; i++) {
      h ^= input.charCodeAt(i);
      h += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);
    }
    return (h >>> 0).toString(16);
  }

  // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
  const consultationType = useMemo(() => {
    // –í—ã–±–∏—Ä–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (base_profile_json) –∏–ª–∏ —Å—Ç–∞—Ä—ã–π (raw_json)
    const dataSource = (profile as any)?.base_profile_json || profile?.raw_json;
    if (!dataSource) return null;
    let payload: any = dataSource;
    try {
      if (typeof payload === "string") payload = JSON.parse(payload);
    } catch {
      return null;
    }
    const items = Array.isArray(payload) ? payload : (payload && typeof payload === 'object' ? [payload] : []);
    if (items.length === 0) return null;
    const item = items[0];
    
    // –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è - –µ—Å—Ç—å compatibility –∏–ª–∏ firstParticipant/secondParticipant
    if (item.compatibility || item.firstParticipantCodes || item.secondParticipantCodes || 
        item.partnerCodes || 
        (item.currentDiagnostics && (item.currentDiagnostics.firstParticipant || item.currentDiagnostics.secondParticipant))) {
      return "partner";
    }
    
    // –¶–µ–ª–µ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è - –µ—Å—Ç—å goalDecomposition, warnings, plan123 –∏ —Ç.–¥., –Ω–æ –Ω–µ—Ç opener/personalitySummary
    if ((item.goalDecomposition || item.warnings || item.plan123 || item.request) && 
        !item.opener && !item.personalitySummary) {
      return "target";
    }
    
    // –î–µ—Ç—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç - –µ—Å—Ç—å childPotential, upbringingRecommendations, developmentFeatures –∏ —Ç.–¥.
    if (item.childPotential || item.upbringingRecommendations || item.developmentFeatures || 
        item.educationalApproach || item.communicationStyle || item.challengesAndSolutions ||
        item.activitiesAndHobbies || item.parentChildInteraction || item.futureProspects) {
      return "child";
    }
    
    // –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç - –µ—Å—Ç—å opener, personalitySummary, strengths, weaknesses –∏ —Ç.–¥.
    if (item.opener || item.personalitySummary || item.strengths || item.weaknesses) {
      return "base";
    }
    
    return null;
  }, [profile]);

  const renderedFromJson = useMemo(() => {
    // –í—ã–±–∏—Ä–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (base_profile_json) –∏–ª–∏ —Å—Ç–∞—Ä—ã–π (raw_json)
    const dataSource = (profile as any)?.base_profile_json || profile?.raw_json;
    if (!dataSource) {
      // Debug logging removed to reduce console noise
      return null;
    }
    let payload: any = dataSource;
    try {
      if (typeof payload === "string") payload = JSON.parse(payload);
    } catch (parseError) {
      if (process.env.NODE_ENV === 'development') {
        console.warn("[DEBUG] renderedFromJson: failed to parse JSON", parseError);
      }
      return null;
    }
    // –ï—Å–ª–∏ payload - —ç—Ç–æ –æ–±—ä–µ–∫—Ç (–Ω–µ –º–∞—Å—Å–∏–≤), –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ –º–∞—Å—Å–∏–≤
    // –ù–æ –µ—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ —Ü–µ–ª–µ–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é, —Ç–æ–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
    let items: any[];
    if (Array.isArray(payload)) {
      items = payload;
    } else if (payload && typeof payload === 'object') {
      // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º - —ç—Ç–æ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –∏–ª–∏ –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ —Ü–µ–ª–µ–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
      // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–ª—è —Ü–µ–ª–µ–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç
      items = [payload];
    } else {
      items = [];
    }
    
    // Debug logging removed to reduce console noise

    const makeHashKey = (section: string, text: string): string => `${section}:h:${hashString(normalizeTextForHash(text))}`;
    const makeLegacyKey = (section: string, text: string, index: number): string => {
      const norm = (text || "").toString().slice(0, 80);
      return `${section}:${index}:${norm}`;
    };

    const CheckList = ({ list, section }: { list: string[]; section: string }) => (
      <ul className="space-y-2">
        {list.map((text, i) => {
          const legacyKey = makeLegacyKey(section, text, i);
          const hashKey = makeHashKey(section, text);
          const checked = Boolean(checkedMap[hashKey] ?? checkedMap[legacyKey]);
          const inputId = `${hashKey}-${i}`;
          return (
            <li key={hashKey} className="flex items-start gap-3">
              <input
                id={inputId}
                type="checkbox"
                checked={checked}
                onChange={(e) => {
                  const next = { ...checkedMap, [hashKey]: e.target.checked, [legacyKey]: e.target.checked };
                  setCheckedMap(next);
                  localUiStateRef.current = next;
                  saveChecked(next);
                }}
                className="mt-0.5 h-[18px] w-[18px] shrink-0 rounded border-2 border-indigo-300 bg-indigo-100 text-indigo-600 focus:ring-0"
              />
              <label htmlFor={inputId} className="leading-relaxed text-gray-800 cursor-pointer flex-1 pl-1">
                {text}
              </label>
            </li>
          );
        })}
      </ul>
    );

    const Entry = ({ title, children, color = "teal" as "teal" | "amber" }: { title?: string; children?: React.ReactNode; color?: "teal" | "amber" }) => (
      <div className="relative rounded-xl border-2 border-blue-100 p-4 pl-8">
        <span className={`absolute left-3 top-3 bottom-3 w-[6px] rounded-[3px] ${color === "teal" ? "bg-teal-500" : "bg-amber-500"}`} />
        {title && <h3 className="m-0 text-[18px] font-semibold">{title}</h3>}
        <div className="mt-2 space-y-2 text-gray-700">{children}</div>
      </div>
    );

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –∫–∞–∫–∏–µ-—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const hasAnyData = items.some((item: any) => {
      if (!item || typeof item !== 'object') return false;
      return !!(
        item.opener || 
        item.personalitySummary || 
        item.strengths || 
        item.strengths_text || 
        item.weaknesses || 
        item.weaknesses_text || 
        item.happinessFormula || 
        item.codesExplanation || 
        item.resourceSignals || 
        item.resourceSignals_text || 
        item.deficitSignals || 
        item.deficitSignals_text || 
        item.conflicts || 
        item.practices ||
        // –î–ª—è —Ü–µ–ª–µ–≤—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –º–æ–≥—É—Ç –±—ã—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
        item.request ||
        item.answer ||
        item.recommendations ||
        item.analysis ||
        (Array.isArray(item.warnings) && item.warnings.length > 0) ||
        (Array.isArray(item.goalDecomposition) && item.goalDecomposition.length > 0) ||
        (Array.isArray(item.resourcesForStages) && item.resourcesForStages.length > 0) ||
        item.currentDiagnostics ||
        (Array.isArray(item.plan123) && item.plan123.length > 0) ||
        item.progressMetrics ||
        item.whatIf ||
        (Array.isArray(item.objectionHandling) && item.objectionHandling.length > 0) ||
        (Array.isArray(item.finalStrategy) && item.finalStrategy.length > 0) ||
        // –ü–æ–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
        item.compatibility ||
        item.firstParticipantCodes ||
        item.secondParticipantCodes ||
        item.partnerCodes ||
        (item.currentDiagnostics && (item.currentDiagnostics.firstParticipant || item.currentDiagnostics.secondParticipant || item.currentDiagnostics.conflictZones)) ||
        // –ü–æ–ª—è –¥–µ—Ç—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
        item.childPotential ||
        item.upbringingRecommendations ||
        item.developmentFeatures ||
        item.educationalApproach ||
        item.communicationStyle ||
        item.challengesAndSolutions ||
        item.activitiesAndHobbies ||
        item.parentChildInteraction ||
        item.futureProspects
      );
    });
    
    // Debug logging removed to reduce console noise
    
    if (!hasAnyData) {
      if (process.env.NODE_ENV === 'development') {
        console.warn("[DEBUG] renderedFromJson: no recognizable data fields in items", {
          items,
          firstItemKeys: items[0] ? Object.keys(items[0]) : []
        });
      }
      return null;
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
    const item = items[0];
    const isPartner = !!(item?.compatibility || item?.firstParticipantCodes || item?.secondParticipantCodes || 
      item?.partnerCodes || 
      (item?.currentDiagnostics && (item.currentDiagnostics.firstParticipant || item.currentDiagnostics.secondParticipant)));
    const isTarget = !!(item?.goalDecomposition || item?.warnings || item?.plan123 || item?.request) && 
      !item?.opener && !item?.personalitySummary && !item?.childPotential;
    const isChild = !!(item?.childPotential || item?.upbringingRecommendations || item?.developmentFeatures || 
      item?.educationalApproach || item?.communicationStyle || item?.challengesAndSolutions ||
      item?.activitiesAndHobbies || item?.parentChildInteraction || item?.futureProspects);
    const isBase = !!(item?.opener || item?.personalitySummary || item?.strengths || item?.weaknesses) && !isChild;

    // –í—ã–±–∏—Ä–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
    if (isPartner) {
      return renderPartnerConsultation(items, CheckList, Entry, checkedMap, setCheckedMap, localUiStateRef, saveChecked);
    } else if (isTarget) {
      return renderTargetConsultation(items, CheckList, Entry, checkedMap, setCheckedMap, localUiStateRef, saveChecked);
    } else if (isChild) {
      return renderChildConsultation(items, CheckList, Entry, checkedMap, setCheckedMap, localUiStateRef, saveChecked);
    } else if (isBase) {
      return renderBaseConsultation(items, CheckList, Entry, checkedMap, setCheckedMap, localUiStateRef, saveChecked);
    }

    return null;
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [profile?.raw_json, (profile as any)?.base_profile_json, checkedMap, saveChecked]);

  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  function renderBaseConsultation(
    items: any[],
    CheckList: any,
    Entry: any,
    checkedMap: Record<string, boolean>,
    setCheckedMap: (map: Record<string, boolean>) => void,
    localUiStateRef: React.MutableRefObject<Record<string, boolean>>,
    saveChecked: (map: Record<string, boolean>) => void
  ) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
    const hasExportData = items.some((item) => 
      (item.strengths || item.strengths_text || item.weaknesses || item.weaknesses_text || 
       item.resourceSignals || item.resourceSignals_text || item.deficitSignals || item.deficitSignals_text)
    );

    return (
      <div className="space-y-6">
        {/* –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF */}
        {hasExportData && (
          <div className="flex justify-end mb-4">
            <button
              onClick={exportBasicPDF}
              className="flex items-center gap-2.5 px-5 py-3 rounded-2xl bg-gradient-to-r from-brand-600 to-brand-700 text-white font-bold text-sm hover:from-brand-700 hover:to-brand-800 shadow-lg shadow-brand-500/20 hover:shadow-xl hover:shadow-brand-500/30 transition-all duration-300 hover:scale-105 active:scale-[0.98]"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
            </button>
          </div>
        )}
        {items.map((item, idx) => (
          <div key={idx} className="space-y-6">
            {/* –°–∫–∞–∂–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É */}
                {item.opener && (
              <section id="opener" className="rounded-2xl border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow relative group">
                <div className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button
                    onClick={() => {
                      navigator.clipboard.writeText(item.opener);
                      alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                    }}
                    className="p-2 rounded-lg bg-white/80 hover:bg-white shadow-sm border border-gray-200 transition-colors"
                    title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç"
                  >
                    <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                  </button>
                </div>
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-4">
                  <span className="text-2xl">‚ùó</span>
                      –°–∫–∞–∂–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É
                    </h2>
                    {(() => {
                      // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –∞–±–∑–∞—Ü—ã –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º (2-3 –∞–±–∑–∞—Ü–∞)
                      const text = item.opener || '';
                      const sentences = text.split(/([.!?]+\s+)/).filter((s: string) => s.trim());
                      const paragraphs: string[] = [];
                      let currentParagraph = '';
                      
                      sentences.forEach((sentence: string, idx: number) => {
                        currentParagraph += sentence;
                        // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –∞–±–∑–∞—Ü—ã: –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∂–¥—ã–µ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –µ—Å–ª–∏ –∞–±–∑–∞—Ü —É–∂–µ –¥–ª–∏–Ω–Ω—ã–π
                        if (currentParagraph.length > 200 || (idx > 0 && (idx + 1) % 3 === 0 && sentences.length > 3)) {
                          paragraphs.push(currentParagraph.trim());
                          currentParagraph = '';
                        }
                      });
                      if (currentParagraph.trim()) {
                        paragraphs.push(currentParagraph.trim());
                      }
                      
                      // –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–±–∑–∞—Ü, —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ–ø–æ–ª–∞–º
                      if (paragraphs.length === 1 && paragraphs[0].length > 300) {
                        const mid = Math.floor(paragraphs[0].length / 2);
                        const splitPoint = paragraphs[0].lastIndexOf('.', mid);
                        if (splitPoint > 0) {
                          paragraphs[0] = paragraphs[0].substring(0, splitPoint + 1);
                          paragraphs.push(paragraphs[0].substring(splitPoint + 1).trim());
                        }
                      }
                      
                      // –ú–∏–Ω–∏–º—É–º 2 –∞–±–∑–∞—Ü–∞, –º–∞–∫—Å–∏–º—É–º 3
                      if (paragraphs.length === 1) {
                        const mid = Math.floor(paragraphs[0].length / 2);
                        const splitPoint = paragraphs[0].lastIndexOf('.', mid);
                        if (splitPoint > 0) {
                          paragraphs.push(paragraphs[0].substring(splitPoint + 1).trim());
                          paragraphs[0] = paragraphs[0].substring(0, splitPoint + 1);
                        }
                      }
                      
                      return (
                        <div className="space-y-4">
                          {paragraphs.slice(0, 3).map((para, i) => (
                            <p key={i} className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg font-medium">{para}</p>
                          ))}
                        </div>
                      );
                    })()}
              </section>
                )}

            {/* –ö–ª—é—á–µ–≤–∞—è –∑–∞–¥–∞—á–∞ –ª–∏—á–Ω–æ—Å—Ç–∏ */}
            {item.coreTask && (
              <section id="coreTask" className="rounded-2xl border-2 border-indigo-200 bg-gradient-to-br from-indigo-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üéØ</span>
                  –ö–ª—é—á–µ–≤–∞—è –∑–∞–¥–∞—á–∞ –ª–∏—á–Ω–æ—Å—Ç–∏
                </h2>
                {(() => {
                  // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –∞–±–∑–∞—Ü—ã –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º (2-3 –∞–±–∑–∞—Ü–∞)
                  const text = item.coreTask || '';
                  const sentences = text.split(/([.!?]+\s+)/).filter((s: string) => s.trim());
                  const paragraphs: string[] = [];
                  let currentParagraph = '';
                  
                  sentences.forEach((sentence: string, idx: number) => {
                    currentParagraph += sentence;
                    // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –∞–±–∑–∞—Ü—ã: –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∂–¥—ã–µ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –µ—Å–ª–∏ –∞–±–∑–∞—Ü —É–∂–µ –¥–ª–∏–Ω–Ω—ã–π
                    if (currentParagraph.length > 200 || (idx > 0 && (idx + 1) % 3 === 0 && sentences.length > 3)) {
                      paragraphs.push(currentParagraph.trim());
                      currentParagraph = '';
                    }
                  });
                  if (currentParagraph.trim()) {
                    paragraphs.push(currentParagraph.trim());
                  }
                  
                  // –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–±–∑–∞—Ü, —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ–ø–æ–ª–∞–º
                  if (paragraphs.length === 1 && paragraphs[0].length > 300) {
                    const mid = Math.floor(paragraphs[0].length / 2);
                    const splitPoint = paragraphs[0].lastIndexOf('.', mid);
                    if (splitPoint > 0) {
                      paragraphs[0] = paragraphs[0].substring(0, splitPoint + 1);
                      paragraphs.push(paragraphs[0].substring(splitPoint + 1).trim());
                    }
                  }
                  
                  // –ú–∏–Ω–∏–º—É–º 2 –∞–±–∑–∞—Ü–∞, –º–∞–∫—Å–∏–º—É–º 3
                  if (paragraphs.length === 1) {
                    const mid = Math.floor(paragraphs[0].length / 2);
                    const splitPoint = paragraphs[0].lastIndexOf('.', mid);
                    if (splitPoint > 0) {
                      paragraphs.push(paragraphs[0].substring(splitPoint + 1).trim());
                      paragraphs[0] = paragraphs[0].substring(0, splitPoint + 1);
                    }
                  }
                  
                  return (
                    <div className="space-y-4">
                      {paragraphs.slice(0, 3).map((para, i) => (
                        <p key={i} className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg font-semibold">{para}</p>
                      ))}
                    </div>
                  );
                })()}
              </section>
            )}

            {/* –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç "–û–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏" */}
            {!item.coreTask && item.personalitySummary && (
              <section id="personality" className="rounded-2xl border-2 border-indigo-200 bg-gradient-to-br from-indigo-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üë§</span>
                  –û–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏
                </h2>
                {Array.isArray(item.personalitySummary) ? (
                  <div className="space-y-5">
                    {item.personalitySummary.map((t: string, idx: number) => (
                      <p key={idx} className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg first:font-semibold">{t}</p>
                    ))}
                  </div>
                ) : (
                  <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg">{item.personalitySummary}</p>
                )}
              </section>
            )}

            {/* –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç "–ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–æ–≤" */}
            {Array.isArray(item.codesExplanation) && item.codesExplanation.length > 0 && (
              <section id="codes" className="rounded-2xl border-2 border-purple-200 bg-gradient-to-br from-purple-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üî¢</span>
                  –ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–æ–≤
                </h2>
                <div className="space-y-5">
                  {item.codesExplanation.map((t: string, i: number) => {
                    const isLast = i === item.codesExplanation.length - 1;
                    return (
                      <p 
                        key={i} 
                        className={`whitespace-pre-wrap text-gray-800 text-base md:text-lg leading-relaxed ${
                          isLast ? 'font-semibold text-gray-900 bg-purple-100 rounded-lg p-4 border-l-4 border-purple-400' : ''
                        }`}
                      >
                        {t}
                      </p>
                    );
                  })}
                </div>
              </section>
            )}

            {/* –°–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã - –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ */}
            {((item.strengths || item.strengths_text) || (item.weaknesses || item.weaknesses_text)) && (
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã */}
                {(item.strengths || item.strengths_text) && (
                  <section id="strengths" className="rounded-2xl border-2 border-green-300 bg-gradient-to-br from-green-50 to-emerald-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                    <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                      <span className="text-2xl">üí™</span>
                      –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
                    </h2>
                  <div className="mt-3">
                    {Array.isArray(item.strengths) ? (
                      <CheckList list={item.strengths} section="strengths" />
                    ) : (
                      item.strengths_text && (
                        <pre className="whitespace-pre-wrap text-sm leading-relaxed text-gray-900">{item.strengths_text}</pre>
                      )
                    )}
                  </div>
                  </section>
                )}

                {/* –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã */}
                {(item.weaknesses || item.weaknesses_text) && (
                  <section id="weaknesses" className="rounded-2xl border-2 border-orange-300 bg-gradient-to-br from-orange-50 to-amber-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                    <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                      <span className="text-2xl">‚ö°</span>
                      –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
                    </h2>
                  <div className="mt-3">
                    {Array.isArray(item.weaknesses) ? (
                      <CheckList list={item.weaknesses} section="weaknesses" />
                    ) : (
                      item.weaknesses_text && (
                        <pre className="whitespace-pre-wrap text-sm leading-relaxed text-gray-900">{item.weaknesses_text}</pre>
                      )
                    )}
                </div>
              </section>
                )}
              </div>
            )}

            {/* –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç "–§–æ—Ä–º—É–ª–∞ —Å—á–∞—Å—Ç—å—è" */}
            {item.happinessFormula && (
              <section id="happiness" className="rounded-2xl border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-yellow-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">‚ò∫Ô∏è</span>
                  –§–æ—Ä–º—É–ª–∞ —Å—á–∞—Å—Ç—å—è
                </h2>
                {Array.isArray(item.happinessFormula) ? (
                  <div className="space-y-5">
                    {item.happinessFormula.map((t: string, i: number) => (
                      <p key={i} className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg">{t}</p>
                    ))}
                  </div>
                ) : (
                  <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg">{item.happinessFormula}</p>
                )}
              </section>
            )}

            {/* –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø–ª—é—Å–∞ –∏ –º–∏–Ω—É—Å–∞ - –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ */}
            {((item.resourceSignals || item.resourceSignals_text) || (item.deficitSignals || item.deficitSignals_text)) && (
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø–ª—é—Å–∞ */}
                {(item.resourceSignals || item.resourceSignals_text) && (
                  <section id="resource-signals" className="rounded-2xl border-2 border-green-300 bg-gradient-to-br from-green-50 to-emerald-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                    <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                      <span className="text-2xl">‚úÖ</span>
                      –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø–ª—é—Å–∞
                    </h2>
                    <div className="mt-3">
                      {Array.isArray(item.resourceSignals) ? (
                        <CheckList list={item.resourceSignals} section="resourceSignals" />
                      ) : (
                        item.resourceSignals_text && (
                          <pre className="whitespace-pre-wrap text-sm leading-relaxed text-gray-900">{item.resourceSignals_text}</pre>
                        )
                      )}
                    </div>
                  </section>
                )}

                {/* –ü—Ä–∏–∑–Ω–∞–∫–∏ –º–∏–Ω—É—Å–∞ */}
                {(item.deficitSignals || item.deficitSignals_text) && (
                  <section id="deficit-signals" className="rounded-2xl border-2 border-red-300 bg-gradient-to-br from-red-50 to-rose-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                    <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                      <span className="text-2xl">‚ö†Ô∏è</span>
                      –ü—Ä–∏–∑–Ω–∞–∫–∏ –º–∏–Ω—É—Å–∞
                    </h2>
                    <div className="mt-3">
                      {Array.isArray(item.deficitSignals) ? (
                        <CheckList list={item.deficitSignals} section="deficitSignals" />
                      ) : (
                        item.deficitSignals_text && (
                          <pre className="whitespace-pre-wrap text-sm leading-relaxed text-gray-900">{item.deficitSignals_text}</pre>
                        )
                      )}
                </div>
                </section>
                )}
              </div>
            )}

            {/* –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã - –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç */}
            {Array.isArray(item.keyConflicts) && item.keyConflicts.length > 0 && (
              <section id="keyConflicts" className="space-y-6">
                <h2 className="text-xl md:text-2xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                  <span className="text-3xl">‚ö°</span>
                  –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
                </h2>
                <div className="space-y-6">
                  {item.keyConflicts.map((c: any, i: number) => (
                    <div key={i} className="rounded-2xl border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-orange-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                      <h3 className="text-lg md:text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <span className="text-2xl">
                          {c.type === "–û–°–ù–û–í–ù–û–ô –ö–û–ù–§–õ–ò–ö–¢" ? "‚ùó" : "‚ö†"}
                        </span>
                        {c.type === "–û–°–ù–û–í–ù–û–ô –ö–û–ù–§–õ–ò–ö–¢" ? "–û–°–ù–û–í–ù–û–ô –ö–û–ù–§–õ–ò–ö–¢" : "–í–¢–û–†–ò–ß–ù–´–ô –ö–û–ù–§–õ–ò–ö–¢"}
                      </h3>
                      {c.description && (
                        <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg mb-5">{c.description}</p>
                      )}
                      {Array.isArray(c.manifestations) && c.manifestations.length > 0 && (
                        <div className="mb-5">
                          <div className="mb-3 text-sm font-semibold text-amber-900 uppercase tracking-wide">–ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:</div>
                          <ul className="space-y-2 pl-0 list-none">
                            {c.manifestations.map((m: string, j: number) => (
                              <li key={j} className="flex items-start gap-3 text-gray-800 text-base">
                                <span className="flex-shrink-0 w-2 h-2 rounded-full bg-amber-500 mt-2"></span>
                                <span className="leading-relaxed">{m}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {c.whyStuck && (
                        <div className="mt-5 pt-5 border-t-2 border-amber-200">
                          <div className="mb-3 text-sm font-semibold text-amber-900 uppercase tracking-wide">–ü–æ—á–µ–º—É —á–µ–ª–æ–≤–µ–∫ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç:</div>
                          <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg">{c.whyStuck}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </section>
            )}

            {/* –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç "–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã" */}
            {!item.keyConflicts && Array.isArray(item.conflicts) && item.conflicts.length > 0 && (
              <AccordionSection title="‚ö†Ô∏è –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã" id="conflicts">
                <div className="space-y-6">
                  {item.conflicts.map((c: any, i: number) => (
                    <div key={i} className="rounded-2xl border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-orange-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                      <h3 className="text-lg md:text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <span className="text-2xl">‚ö°</span>
                        {c.title}
                      </h3>
                      {c.description && (
                        <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg mb-5">{c.description}</p>
                      )}
                      {Array.isArray(c.manifestations) && c.manifestations.length > 0 && (
                        <div className="mb-5">
                          <div className="mb-3 text-sm font-semibold text-amber-900 uppercase tracking-wide">–ö–∞–∫ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è:</div>
                          <ul className="space-y-2 pl-0 list-none">
                            {c.manifestations.map((m: string, j: number) => (
                              <li key={j} className="flex items-start gap-3 text-gray-800 text-base">
                                <span className="flex-shrink-0 w-2 h-2 rounded-full bg-amber-500 mt-2"></span>
                                <span className="leading-relaxed">{m}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {c.advice && (
                        <div className="mt-5 pt-5 border-t-2 border-amber-200">
                          <div className="mb-3 text-sm font-semibold text-green-800 uppercase tracking-wide">üí° –ß—Ç–æ –¥–µ–ª–∞—Ç—å:</div>
                          <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg bg-white rounded-lg p-4 border-l-4 border-green-500">{c.advice}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –†—ã—á–∞–≥–∏ –≤–ª–∏—è–Ω–∏—è - –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç */}
            {Array.isArray(item.levers) && item.levers.length > 0 && (
              <section id="levers" className="rounded-2xl border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">‚öôÔ∏è</span>
                  –†—ã—á–∞–≥–∏ –≤–ª–∏—è–Ω–∏—è
                </h2>
                <div className="space-y-4">
                  {item.levers.map((lever: string, i: number) => (
                    <div key={i} className="flex items-start gap-3 p-4 bg-white rounded-lg border-l-4 border-blue-500">
                      <span className="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-700 font-bold text-sm flex items-center justify-center mt-0.5">
                        {i + 1}
                      </span>
                      <p className="text-base md:text-lg leading-relaxed text-gray-800 flex-1">{lever}</p>
                    </div>
                  ))}
                </div>
              </section>
            )}

            {/* –§–æ–∫—É—Å –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –ø–µ—Ä–∏–æ–¥ */}
            {item.focusNow && (
              <section id="focusNow" className="rounded-2xl border-2 border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üéØ</span>
                  –§–æ–∫—É—Å –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –ø–µ—Ä–∏–æ–¥
                </h2>
                <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg font-medium">{item.focusNow}</p>
              </section>
            )}

            {/* –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞ */}
            {Array.isArray(item.consultantQuestions) && item.consultantQuestions.length > 0 && (
              <section id="consultantQuestions" className="rounded-2xl border-2 border-purple-200 bg-gradient-to-br from-purple-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">‚ùì</span>
                  –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
                </h2>
                <div className="space-y-4">
                  {item.consultantQuestions.map((question: string, i: number) => (
                    <div key={i} className="flex items-start gap-3 p-4 bg-white rounded-lg border-l-4 border-purple-500">
                      <span className="flex-shrink-0 w-6 h-6 rounded-full bg-purple-100 text-purple-700 font-bold text-sm flex items-center justify-center mt-0.5">
                        {i + 1}
                      </span>
                      <p className="text-base md:text-lg leading-relaxed text-gray-800 flex-1">{question}</p>
                    </div>
                  ))}
                </div>
              </section>
            )}

            {/* –ü—Ä–∞–∫—Ç–∏–∫–∏ - –Ω–æ–≤—ã–π –∏ —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç */}
            {item.practices && (
              <AccordionSection title="üí° –ü—Ä–∞–∫—Ç–∏–∫–∏" id="practices">
                <div className="space-y-8">
                  {Object.entries(item.practices).map(([blockKey, list]: any, i: number) => (
                    <article key={i} className="rounded-2xl border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                      <div className="mb-6 text-xl font-bold text-gray-900 border-b-2 border-blue-400 pb-3 flex items-center gap-2">
                        <span className="text-2xl">üéØ</span>
                        {mapPracticeKey(blockKey)}
                      </div>
                      {Array.isArray(list) ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                          {list.map((pr: any, j: number) => (
                            <div key={j} className="rounded-xl border-2 border-blue-100 bg-white p-5 shadow-sm hover:shadow-md transition-shadow">
                              <h4 className="text-base font-bold text-gray-900 mb-3 flex items-center gap-2">
                                <span className="text-lg">‚ú®</span>
                                {pr.title}
                              </h4>
                              <div className="space-y-3">
                                {pr.p1 && (
                                  <div className="flex gap-2">
                                    <span className="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-700 font-bold text-xs flex items-center justify-center">1</span>
                                    <p className="text-sm leading-relaxed text-gray-700 flex-1">
                                      {pr.p1}
                                    </p>
                                  </div>
                                )}
                                {pr.p2 && (
                                  <div className="flex gap-2">
                                    <span className="flex-shrink-0 w-6 h-6 rounded-full bg-blue-100 text-blue-700 font-bold text-xs flex items-center justify-center">2</span>
                                    <p className="text-sm leading-relaxed text-gray-700 flex-1">
                                      {pr.p2}
                                    </p>
                                  </div>
                                )}
                                {pr.description && (
                                  <p className="text-xs leading-relaxed text-gray-600 italic mt-3 pt-3 border-t border-gray-200">
                                    {pr.description}
                                  </p>
                                )}
                              </div>
                            </div>
                          ))}
                        </div>
                      ) : (
                        <div className="text-sm text-gray-500">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                      )}
                    </article>
                  ))}
                </div>
              </AccordionSection>
            )}
          </div>
        ))}
      </div>
    );
  }

  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ü–µ–ª–µ–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–µ—Ç—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  function renderChildConsultation(
    items: any[],
    CheckList: any,
    Entry: any,
    checkedMap: Record<string, boolean>,
    setCheckedMap: (map: Record<string, boolean>) => void,
    localUiStateRef: React.MutableRefObject<Record<string, boolean>>,
    saveChecked: (map: Record<string, boolean>) => void
  ) {
    return (
      <div className="space-y-6">
        {items.map((item, idx) => (
          <div key={idx} className="space-y-6">
            {/* –°–∫–∞–∂–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è–º */}
            {item.opener && (
              <section id="opener" className="rounded-2xl border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow relative group">
                <div className="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button
                    onClick={() => {
                      navigator.clipboard.writeText(item.opener);
                      alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                    }}
                    className="p-2 rounded-lg bg-white/80 hover:bg-white shadow-sm border border-gray-200 transition-colors"
                    title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç"
                  >
                    <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                    </svg>
                  </button>
                </div>
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-4">
                  <span className="text-2xl">üë∂</span>
                  –°–∫–∞–∂–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è–º
                </h2>
                <p className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg font-medium">{item.opener}</p>
              </section>
            )}

            {/* –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–µ–±–µ–Ω–∫–∞ */}
            {Array.isArray(item.childPotential) && item.childPotential.length > 0 && (
              <section id="childPotential" className="rounded-2xl border-2 border-indigo-200 bg-gradient-to-br from-indigo-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">‚≠ê</span>
                  –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–µ–±–µ–Ω–∫–∞
                </h2>
                <div className="space-y-5">
                  {item.childPotential.map((t: string, i: number) => (
                    <p key={i} className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg">{t}</p>
                  ))}
                </div>
              </section>
            )}

            {/* –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è */}
            {Array.isArray(item.developmentFeatures) && item.developmentFeatures.length > 0 && (
              <section id="developmentFeatures" className="rounded-2xl border-2 border-purple-200 bg-gradient-to-br from-purple-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üå±</span>
                  –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è
                </h2>
                <div className="mt-3">
                  <CheckList list={item.developmentFeatures} section="developmentFeatures" />
                </div>
              </section>
            )}

            {/* –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—é */}
            {Array.isArray(item.upbringingRecommendations) && item.upbringingRecommendations.length > 0 && (
              <section id="upbringingRecommendations" className="rounded-2xl border-2 border-green-200 bg-gradient-to-br from-green-50 to-emerald-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üíö</span>
                  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—é
                </h2>
                <div className="mt-3">
                  <CheckList list={item.upbringingRecommendations} section="upbringingRecommendations" />
                </div>
              </section>
            )}

            {/* –ü–æ–¥—Ö–æ–¥ –∫ –æ–±—É—á–µ–Ω–∏—é */}
            {Array.isArray(item.educationalApproach) && item.educationalApproach.length > 0 && (
              <section id="educationalApproach" className="rounded-2xl border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-white p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üìö</span>
                  –ü–æ–¥—Ö–æ–¥ –∫ –æ–±—É—á–µ–Ω–∏—é
                </h2>
                <div className="mt-3">
                  <CheckList list={item.educationalApproach} section="educationalApproach" />
                </div>
              </section>
            )}

            {/* –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è */}
            {Array.isArray(item.communicationStyle) && item.communicationStyle.length > 0 && (
              <section id="communicationStyle" className="rounded-2xl border-2 border-amber-200 bg-gradient-to-br from-amber-50 to-yellow-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üí¨</span>
                  –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
                </h2>
                <div className="mt-3">
                  <CheckList list={item.communicationStyle} section="communicationStyle" />
                </div>
              </section>
            )}

            {/* –í—ã–∑–æ–≤—ã –∏ —Ä–µ—à–µ–Ω–∏—è */}
            {Array.isArray(item.challengesAndSolutions) && item.challengesAndSolutions.length > 0 && (
              <section id="challengesAndSolutions" className="rounded-2xl border-2 border-orange-200 bg-gradient-to-br from-orange-50 to-amber-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">‚ö°</span>
                  –í—ã–∑–æ–≤—ã –∏ —Ä–µ—à–µ–Ω–∏—è
                </h2>
                <div className="mt-3">
                  <CheckList list={item.challengesAndSolutions} section="challengesAndSolutions" />
                </div>
              </section>
            )}

            {/* –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ö–æ–±–±–∏ */}
            {Array.isArray(item.activitiesAndHobbies) && item.activitiesAndHobbies.length > 0 && (
              <section id="activitiesAndHobbies" className="rounded-2xl border-2 border-pink-200 bg-gradient-to-br from-pink-50 to-rose-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üé®</span>
                  –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ö–æ–±–±–∏
                </h2>
                <div className="mt-3">
                  <CheckList list={item.activitiesAndHobbies} section="activitiesAndHobbies" />
                </div>
              </section>
            )}

            {/* –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å-—Ä–µ–±–µ–Ω–æ–∫ */}
            {Array.isArray(item.parentChildInteraction) && item.parentChildInteraction.length > 0 && (
              <section id="parentChildInteraction" className="rounded-2xl border-2 border-teal-200 bg-gradient-to-br from-teal-50 to-cyan-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üë®‚Äçüë©‚Äçüëß</span>
                  –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å-—Ä–µ–±–µ–Ω–æ–∫
                </h2>
                <div className="space-y-5">
                  {item.parentChildInteraction.map((t: string, i: number) => (
                    <p key={i} className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg">{t}</p>
                  ))}
                </div>
              </section>
            )}

            {/* –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –±—É–¥—É—â–µ–≥–æ */}
            {Array.isArray(item.futureProspects) && item.futureProspects.length > 0 && (
              <section id="futureProspects" className="rounded-2xl border-2 border-violet-200 bg-gradient-to-br from-violet-50 to-purple-50 p-6 md:p-8 shadow-sm hover:shadow-md transition-shadow">
                <h2 className="m-0 flex items-center gap-3 text-lg md:text-xl font-bold text-gray-900 mb-5">
                  <span className="text-2xl">üîÆ</span>
                  –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –±—É–¥—É—â–µ–≥–æ
                </h2>
                <div className="space-y-5">
                  {item.futureProspects.map((t: string, i: number) => (
                    <p key={i} className="whitespace-pre-wrap leading-relaxed text-gray-800 text-base md:text-lg">{t}</p>
                  ))}
                </div>
              </section>
            )}
          </div>
        ))}
      </div>
    );
  }

  function renderTargetConsultation(
    items: any[],
    CheckList: any,
    Entry: any,
    checkedMap: Record<string, boolean>,
    setCheckedMap: (map: Record<string, boolean>) => void,
    localUiStateRef: React.MutableRefObject<Record<string, boolean>>,
    saveChecked: (map: Record<string, boolean>) => void
  ) {
  return (
      <div className="space-y-6">
        {items.map((item, idx) => (
          <div key={idx} className="space-y-6">
            {/* –¶–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞ */}
            {item.request && (
              <section id="goal" className="rounded-2xl border-2 border-blue-200 bg-blue-50 p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-gray-800 mb-3">üéØ –¶–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞</h2>
                <p className="mt-3 whitespace-pre-wrap leading-relaxed text-gray-800">{item.request}</p>
              </section>
            )}

            {/* –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ü–µ–ª–∏ */}
            {Array.isArray(item.goalDecomposition) && item.goalDecomposition.length > 0 && (
              <section id="goal-decomposition" className="rounded-2xl border-2 border-blue-200 bg-white p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-gray-800 mb-3">üìã –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ü–µ–ª–∏</h2>
                <ol className="space-y-3 list-none pl-0">
                  {item.goalDecomposition.map((goal: string, i: number) => (
                    <li key={i} className="text-gray-700 leading-relaxed flex gap-3">
                      <span className="font-semibold text-blue-600 flex-shrink-0">{i + 1}.</span>
                      <span>{goal}</span>
                    </li>
                  ))}
                </ol>
              </section>
            )}

            {/* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è */}
            {Array.isArray(item.warnings) && item.warnings.length > 0 && (
              <section id="warnings" className="rounded-2xl border-2 border-amber-200 bg-amber-50 p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-amber-900 mb-3">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</h2>
                <ul className="space-y-2">
                  {item.warnings.map((w: string, i: number) => (
                    <li key={i} className="text-amber-800 leading-relaxed">‚Ä¢ {w}</li>
                  ))}
                </ul>
              </section>
            )}

            {/* –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è */}
            {Array.isArray(item.currentDiagnostics?.questions) && item.currentDiagnostics.questions.length > 0 && (
              <section id="questions" className="rounded-2xl border-2 border-blue-200 bg-white p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-gray-800 mb-3">‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è</h2>
                <div className="space-y-3">
                  {item.currentDiagnostics.questions.map((q: any, i: number) => (
                    <div key={i} className="bg-blue-50 rounded-lg p-4 border border-blue-100">
                      <p className="text-gray-800 mb-1">{q.question}</p>
                      {q.salResource && (
                        <span className="text-xs text-gray-500">–†–µ—Å—É—Ä—Å: {q.salResource}</span>
                      )}
                    </div>
                  ))}
                </div>
              </section>
            )}

            {/* –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ */}
            {item.currentDiagnostics && (
              <AccordionSection title="üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞" id="diagnostics">
                <div className="space-y-6">
                  {Array.isArray(item.currentDiagnostics.resourceStates) && item.currentDiagnostics.resourceStates.length > 0 && (
        <div>
                      <h3 className="text-base font-semibold mb-3">–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤</h3>
                      <div className="space-y-3">
                        {item.currentDiagnostics.resourceStates.map((state: any, i: number) => (
                          <div key={i} className={`rounded-lg p-4 border-2 ${state.state === 'plus' ? 'border-green-200 bg-green-50' :
                            state.state === 'minus' ? 'border-red-200 bg-red-50' :
                            'border-gray-200 bg-gray-50'
                          }`}>
                            <div className="font-semibold mb-2">{state.resource}</div>
                            {Array.isArray(state.evidence) && state.evidence.length > 0 && (
                              <div className="mb-2">
                                <div className="text-xs font-semibold text-gray-600 mb-1">–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.evidence.map((e: string, j: number) => (
                                    <li key={j}>{e}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                            {Array.isArray(state.correction) && state.correction.length > 0 && (
                              <div>
                                <div className="text-xs font-semibold text-gray-600 mb-1">–ö–æ—Ä—Ä–µ–∫—Ü–∏—è:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.correction.map((c: string, j: number) => (
                                    <li key={j}>{c}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                  {item.currentDiagnostics.readiness && (
                    <div className="rounded-lg border border-blue-100 p-4">
                      <h3 className="text-base font-semibold mb-2">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</h3>
                      <div className="mb-2">
                        <span className="text-sm text-gray-600">–ñ–µ–ª–∞–Ω–∏–µ: </span>
                        <span className="font-semibold">{item.currentDiagnostics.readiness.willingness}/10</span>
                      </div>
                      {Array.isArray(item.currentDiagnostics.readiness.blockers) && item.currentDiagnostics.readiness.blockers.length > 0 && (
                        <div className="mb-2">
                          <div className="text-xs font-semibold text-gray-600 mb-1">–ë–ª–æ–∫–µ—Ä—ã:</div>
                          <ul className="list-disc list-inside text-sm text-gray-700">
                            {item.currentDiagnostics.readiness.blockers.map((b: string, i: number) => (
                              <li key={i}>{b}</li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {item.currentDiagnostics.readiness.comment && (
                        <p className="text-sm text-gray-700 mt-2">{item.currentDiagnostics.readiness.comment}</p>
                      )}
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –†–µ—Å—É—Ä—Å—ã –ø–æ —ç—Ç–∞–ø–∞–º */}
            {Array.isArray(item.resourcesForStages) && item.resourcesForStages.length > 0 && (
              <AccordionSection title="üìä –†–µ—Å—É—Ä—Å—ã –ø–æ —ç—Ç–∞–ø–∞–º" id="resources-stages">
                <div className="space-y-6">
                  {item.resourcesForStages.map((stage: any, stageIdx: number) => (
                    <div key={stageIdx} className="rounded-xl border border-blue-100 p-5">
                      <h3 className="text-lg font-semibold mb-4">–≠—Ç–∞–ø {stage.stage}</h3>
                      <div className="space-y-4">
                        {Array.isArray(stage.resources) && stage.resources.map((res: any, resIdx: number) => (
                          <div key={resIdx} className="bg-gray-50 rounded-lg p-4">
                            <div className="font-semibold text-gray-800 mb-2">{res.resource} {res.code && `(${res.code})`}</div>
                            {res.why && <p className="text-sm text-gray-600 mb-2">{res.why}</p>}
                            {Array.isArray(res.successSignals) && res.successSignals.length > 0 && (
                              <div className="mt-2">
                                <div className="text-xs font-semibold text-gray-500 uppercase mb-1">–ü—Ä–∏–∑–Ω–∞–∫–∏ —É—Å–ø–µ—Ö–∞:</div>
                                <ul className="list-disc list-inside space-y-1 text-sm text-gray-700">
                                  {res.successSignals.map((signal: string, sigIdx: number) => (
                                    <li key={sigIdx}>{signal}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π */}
            {Array.isArray(item.plan123) && item.plan123.length > 0 && (
              <AccordionSection title="üìù –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π" id="plan">
                <div className="space-y-6">
                  {item.plan123.map((plan: any, i: number) => (
                    <div key={i} className="rounded-xl border-2 border-indigo-200 bg-indigo-50 p-5">
                      <h3 className="text-lg font-semibold mb-4">{plan.stageTitle}</h3>
                      {Array.isArray(plan.actions) && plan.actions.length > 0 && (
                        <div className="mb-4">
                          <div className="text-sm font-semibold text-gray-700 mb-2">–î–µ–π—Å—Ç–≤–∏—è:</div>
                          <ul className="list-disc list-inside space-y-1 text-gray-700">
                            {plan.actions.map((action: string, j: number) => (
                              <li key={j}>{action}</li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {Array.isArray(plan.resources) && plan.resources.length > 0 && (
                        <div className="mb-4">
                          <div className="text-sm font-semibold text-gray-700 mb-2">–†–µ—Å—É—Ä—Å—ã:</div>
                          <div className="flex flex-wrap gap-2">
                            {plan.resources.map((res: any, j: number) => {
                              // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏ —Ü–∏—Ñ—Ä: –µ—Å–ª–∏ resource —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –≤ —Å–∫–æ–±–∫–∞—Ö, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ —Å–Ω–æ–≤–∞
                              const resourceText = res.resource || '';
                              const hasCodeInText = /\(\d+\)/.test(resourceText);
                              const codeText = res.code && !hasCodeInText ? `(${res.code})` : '';
                              return (
                                <span key={j} className="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm">
                                  {resourceText} {codeText}
                                </span>
                              );
                            })}
                          </div>
                        </div>
                      )}
                      {plan.successCriteria && (
                        <div className="mb-4 p-3 bg-green-50 rounded-lg border border-green-200">
                          <div className="text-sm font-semibold text-green-800 mb-1">–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:</div>
                          <p className="text-sm text-green-700">{plan.successCriteria}</p>
                        </div>
                      )}
                      {plan.riskNotes && (
                        <div className="p-3 bg-amber-50 rounded-lg border border-amber-200">
                          <div className="text-sm font-semibold text-amber-800 mb-1">‚ö†Ô∏è –†–∏—Å–∫–∏:</div>
                          <p className="text-sm text-amber-700">{plan.riskNotes}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */}
            {item.progressMetrics && (
              <AccordionSection title="üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞" id="metrics">
                <div className="space-y-4">
                  {Array.isArray(item.progressMetrics.earlySignals) && item.progressMetrics.earlySignals.length > 0 && (
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-2">–†–∞–Ω–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-gray-600">
                        {item.progressMetrics.earlySignals.map((s: string, i: number) => (
                          <li key={i}>{s}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.progressMetrics.midSignals) && item.progressMetrics.midSignals.length > 0 && (
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-2">–°—Ä–µ–¥–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-gray-600">
                        {item.progressMetrics.midSignals.map((s: string, i: number) => (
                          <li key={i}>{s}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.progressMetrics.resultSignals) && item.progressMetrics.resultSignals.length > 0 && (
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-2">–ò—Ç–æ–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-gray-600">
                        {item.progressMetrics.resultSignals.map((s: string, i: number) => (
                          <li key={i}>{s}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö */}
            {item.whatIf && (
              <AccordionSection title="üîÑ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö" id="what-if">
                <div className="space-y-4">
                  {Array.isArray(item.whatIf.fatigue) && item.whatIf.fatigue.length > 0 && (
                    <div className="rounded-lg border border-orange-200 bg-orange-50 p-4">
                      <h3 className="text-sm font-semibold text-orange-900 mb-2">–£—Å—Ç–∞–ª–æ—Å—Ç—å</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-orange-800">
                        {item.whatIf.fatigue.map((f: string, i: number) => (
                          <li key={i}>{f}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.whatIf.overwhelm) && item.whatIf.overwhelm.length > 0 && (
                    <div className="rounded-lg border border-red-200 bg-red-50 p-4">
                      <h3 className="text-sm font-semibold text-red-900 mb-2">–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-red-800">
                        {item.whatIf.overwhelm.map((o: string, i: number) => (
                          <li key={i}>{o}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.whatIf.relapse) && item.whatIf.relapse.length > 0 && (
                    <div className="rounded-lg border border-purple-200 bg-purple-50 p-4">
                      <h3 className="text-sm font-semibold text-purple-900 mb-2">–†–µ—Ü–∏–¥–∏–≤</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-purple-800">
                        {item.whatIf.relapse.map((r: string, i: number) => (
                          <li key={i}>{r}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.whatIf.pitfalls) && item.whatIf.pitfalls.length > 0 && (
                    <div className="rounded-lg border border-amber-200 bg-amber-50 p-4">
                      <h3 className="text-sm font-semibold text-amber-900 mb-2">–õ–æ–≤—É—à–∫–∏</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-amber-800">
                        {item.whatIf.pitfalls.map((p: string, i: number) => (
                          <li key={i}>{p}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π */}
            {Array.isArray(item.objectionHandling) && item.objectionHandling.length > 0 && (
              <AccordionSection title="üí¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π" id="objections">
                <div className="space-y-4">
                  {item.objectionHandling.map((obj: any, i: number) => (
                    <div key={i} className="rounded-lg border border-blue-100 bg-blue-50 p-4">
                      <div className="font-semibold text-gray-800 mb-2">&ldquo;{obj.objection}&rdquo;</div>
                      <p className="text-sm text-gray-700">{obj.reply}</p>
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è */}
            {Array.isArray(item.finalStrategy) && item.finalStrategy.length > 0 && (
              <section id="strategy" className="rounded-2xl border-2 border-green-200 bg-green-50 p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-green-900 mb-3">‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</h2>
                <div className="space-y-3">
                  {item.finalStrategy.map((strategy: string, i: number) => (
                    <p key={i} className="text-green-800 leading-relaxed">{strategy}</p>
                  ))}
                </div>
              </section>
            )}
          </div>
        ))}
      </div>
    );
  }

  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
  function renderPartnerConsultation(
    items: any[],
    CheckList: any,
    Entry: any,
    checkedMap: Record<string, boolean>,
    setCheckedMap: (map: Record<string, boolean>) => void,
    localUiStateRef: React.MutableRefObject<Record<string, boolean>>,
    saveChecked: (map: Record<string, boolean>) => void
  ) {
    return (
      <div className="space-y-6">
        {items.map((item, idx) => (
          <div key={idx} className="space-y-6">
            {/* –¶–µ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ */}
            {item.goal && (
              <section id="goal" className="rounded-2xl border-2 border-blue-200 bg-blue-50 p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-gray-800 mb-3">üéØ –¶–µ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</h2>
                <p className="mt-3 whitespace-pre-wrap leading-relaxed text-gray-800">{item.goal}</p>
              </section>
            )}

            {/* –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è */}
            {Array.isArray(item.warnings) && item.warnings.length > 0 && (
              <section id="warnings" className="rounded-2xl border-2 border-amber-200 bg-amber-50 p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-amber-900 mb-3">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</h2>
                <ul className="space-y-2">
                  {item.warnings.map((w: string, i: number) => (
                    <li key={i} className="text-amber-800 leading-relaxed">‚Ä¢ {w}</li>
                  ))}
                </ul>
              </section>
            )}

            {/* –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ü–µ–ª–∏ –ø–∞—Ä—ã */}
            {Array.isArray(item.goalDecomposition) && item.goalDecomposition.length > 0 && (
              <section id="goal-decomposition" className="rounded-2xl border-2 border-blue-200 bg-white p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-gray-800 mb-3">üìã –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ü–µ–ª–∏ –ø–∞—Ä—ã</h2>
                <ol className="space-y-3 list-none pl-0">
                  {item.goalDecomposition.map((goal: string, i: number) => (
                    <li key={i} className="text-gray-700 leading-relaxed flex gap-3">
                      <span className="font-semibold text-blue-600 flex-shrink-0">{i + 1}.</span>
                      <span>{goal}</span>
                    </li>
                  ))}
                </ol>
              </section>
            )}

            {/* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤ */}
            {item.compatibility && (
              <AccordionSection title="ü§ù –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤" id="compatibility">
                <div className="space-y-6">
                  {Array.isArray(item.compatibility.complementary) && item.compatibility.complementary.length > 0 && (
                    <div>
                      <h3 className="text-base font-semibold text-green-800 mb-3">‚úÖ –î–æ–ø–æ–ª–Ω—è—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã</h3>
                      <div className="space-y-3">
                        {item.compatibility.complementary.map((comp: any, i: number) => (
                          <div key={i} className="rounded-lg border border-green-200 bg-green-50 p-4">
                            <div className="font-semibold text-gray-800 mb-2">
                              {comp.firstResource} ‚Üî {comp.secondResource}
                            </div>
                            <p className="text-sm text-gray-700">{comp.why}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                  
                  {Array.isArray(item.compatibility.conflicts) && item.compatibility.conflicts.length > 0 && (
                    <div>
                      <h3 className="text-base font-semibold text-red-800 mb-3">‚ö†Ô∏è –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã</h3>
                      <div className="space-y-3">
                        {item.compatibility.conflicts.map((conf: any, i: number) => (
                          <div key={i} className="rounded-lg border border-red-200 bg-red-50 p-4">
                            <div className="font-semibold text-gray-800 mb-2">
                              {conf.firstResource} ‚Üî {conf.secondResource}
                            </div>
                            <p className="text-sm text-gray-700 mb-2">{conf.why}</p>
                            {conf.solution && (
                              <div className="mt-2 pt-2 border-t border-red-300">
                                <div className="text-xs font-semibold text-red-800 mb-1">–†–µ—à–µ–Ω–∏–µ:</div>
                                <p className="text-sm text-red-700">{conf.solution}</p>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –ó–æ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ */}
            {Array.isArray(item.currentDiagnostics?.conflictZones) && item.currentDiagnostics.conflictZones.length > 0 && (
              <AccordionSection title="‚öîÔ∏è –ó–æ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤" id="conflict-zones">
                <div className="space-y-4">
                  {item.currentDiagnostics.conflictZones.map((zone: any, i: number) => (
                    <div key={i} className="rounded-lg border-2 border-amber-200 bg-amber-50 p-4">
                      <h3 className="text-base font-semibold text-amber-900 mb-3">{zone.zone}</h3>
                      <p className="text-sm text-gray-700 mb-3">{zone.description}</p>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <div className="bg-white rounded p-3 border border-amber-200">
                          <div className="text-xs font-semibold text-gray-600 mb-1">–ü–µ—Ä–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫:</div>
                          <p className="text-sm text-gray-800">{zone.firstParticipantRole}</p>
                        </div>
                        <div className="bg-white rounded p-3 border border-amber-200">
                          <div className="text-xs font-semibold text-gray-600 mb-1">–í—Ç–æ—Ä–æ–π —É—á–∞—Å—Ç–Ω–∏–∫:</div>
                          <p className="text-sm text-gray-800">{zone.secondParticipantRole}</p>
                        </div>
                      </div>
                      {zone.solution && (
                        <div className="mt-3 pt-3 border-t border-amber-300">
                          <div className="text-xs font-semibold text-amber-800 mb-1">–†–µ—à–µ–Ω–∏–µ:</div>
                          <p className="text-sm text-amber-700">{zone.solution}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ */}
            {item.currentDiagnostics && !item.currentDiagnostics.firstParticipant && !item.currentDiagnostics.secondParticipant && (
              <AccordionSection title="üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞" id="diagnostics">
                <div className="space-y-6">
                  {Array.isArray(item.currentDiagnostics.resourceStates) && item.currentDiagnostics.resourceStates.length > 0 && (
                    <div>
                      <h3 className="text-base font-semibold mb-3">–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤</h3>
                      <div className="space-y-3">
                        {item.currentDiagnostics.resourceStates.map((state: any, i: number) => (
                          <div key={i} className={`rounded-lg p-4 border-2 ${state.state === 'plus' ? 'border-green-200 bg-green-50' :
                            state.state === 'minus' ? 'border-red-200 bg-red-50' :
                            'border-gray-200 bg-gray-50'
                          }`}>
                            <div className="font-semibold mb-2">{state.resource}</div>
                            {Array.isArray(state.evidence) && state.evidence.length > 0 && (
                              <div className="mb-2">
                                <div className="text-xs font-semibold text-gray-600 mb-1">–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.evidence.map((e: string, j: number) => (
                                    <li key={j}>{e}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                            {Array.isArray(state.correction) && state.correction.length > 0 && (
                              <div>
                                <div className="text-xs font-semibold text-gray-600 mb-1">–ö–æ—Ä—Ä–µ–∫—Ü–∏—è:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.correction.map((c: string, j: number) => (
                                    <li key={j}>{c}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                  {item.currentDiagnostics.readiness && (
                    <div className="rounded-lg border border-blue-100 p-4">
                      <h3 className="text-base font-semibold mb-2">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</h3>
                      <div className="mb-2">
                        <span className="text-sm text-gray-600">–ñ–µ–ª–∞–Ω–∏–µ: </span>
                        <span className="font-semibold">{item.currentDiagnostics.readiness.willingness}/10</span>
                      </div>
                      {Array.isArray(item.currentDiagnostics.readiness.blockers) && item.currentDiagnostics.readiness.blockers.length > 0 && (
                        <div className="mb-2">
                          <div className="text-xs font-semibold text-gray-600 mb-1">–ë–ª–æ–∫–µ—Ä—ã:</div>
                          <ul className="list-disc list-inside text-sm text-gray-700">
                            {item.currentDiagnostics.readiness.blockers.map((b: string, i: number) => (
                              <li key={i}>{b}</li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {item.currentDiagnostics.readiness.comment && (
                        <p className="text-sm text-gray-700 mt-2">{item.currentDiagnostics.readiness.comment}</p>
                      )}
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */}
            {(item.currentDiagnostics?.firstParticipant || item.currentDiagnostics?.secondParticipant) && (
              <AccordionSection title="üë• –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤" id="participants-diagnostics">
                <div className="space-y-6">
                  {/* –ü–µ—Ä–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ */}
                  {item.currentDiagnostics.firstParticipant && Array.isArray(item.currentDiagnostics.firstParticipant.resourceStates) && (
                    <div>
                      <h3 className="text-base font-semibold text-gray-800 mb-3">–ü–µ—Ä–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫</h3>
                      <div className="space-y-3">
                        {item.currentDiagnostics.firstParticipant.resourceStates.map((state: any, i: number) => (
                          <div key={i} className={`rounded-lg p-4 border-2 ${state.state === 'plus' ? 'border-green-200 bg-green-50' :
                            state.state === 'minus' ? 'border-red-200 bg-red-50' :
                            'border-gray-200 bg-gray-50'
                          }`}>
                            <div className="font-semibold mb-2">{state.resource}</div>
                            {Array.isArray(state.evidence) && state.evidence.length > 0 && (
                              <div className="mb-2">
                                <div className="text-xs font-semibold text-gray-600 mb-1">–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.evidence.map((e: string, j: number) => (
                                    <li key={j}>{e}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                            {Array.isArray(state.correction) && state.correction.length > 0 && (
                              <div>
                                <div className="text-xs font-semibold text-gray-600 mb-1">–ö–æ—Ä—Ä–µ–∫—Ü–∏—è:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.correction.map((c: string, j: number) => (
                                    <li key={j}>{c}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                  
                  {/* –í—Ç–æ—Ä–æ–π —É—á–∞—Å—Ç–Ω–∏–∫ */}
                  {item.currentDiagnostics.secondParticipant && Array.isArray(item.currentDiagnostics.secondParticipant.resourceStates) && (
                    <div>
                      <h3 className="text-base font-semibold text-gray-800 mb-3">–í—Ç–æ—Ä–æ–π —É—á–∞—Å—Ç–Ω–∏–∫</h3>
                      <div className="space-y-3">
                        {item.currentDiagnostics.secondParticipant.resourceStates.map((state: any, i: number) => (
                          <div key={i} className={`rounded-lg p-4 border-2 ${state.state === 'plus' ? 'border-green-200 bg-green-50' :
                            state.state === 'minus' ? 'border-red-200 bg-red-50' :
                            'border-gray-200 bg-gray-50'
                          }`}>
                            <div className="font-semibold mb-2">{state.resource}</div>
                            {Array.isArray(state.evidence) && state.evidence.length > 0 && (
                              <div className="mb-2">
                                <div className="text-xs font-semibold text-gray-600 mb-1">–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.evidence.map((e: string, j: number) => (
                                    <li key={j}>{e}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                            {Array.isArray(state.correction) && state.correction.length > 0 && (
                              <div>
                                <div className="text-xs font-semibold text-gray-600 mb-1">–ö–æ—Ä—Ä–µ–∫—Ü–∏—è:</div>
                                <ul className="list-disc list-inside text-sm text-gray-700">
                                  {state.correction.map((c: string, j: number) => (
                                    <li key={j}>{c}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è */}
            {Array.isArray(item.currentDiagnostics?.questions) && item.currentDiagnostics.questions.length > 0 && (
              <section id="questions" className="rounded-2xl border-2 border-blue-200 bg-white p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-gray-800 mb-3">‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è</h2>
                <div className="space-y-3">
                  {item.currentDiagnostics.questions.map((q: any, i: number) => (
                    <div key={i} className="bg-blue-50 rounded-lg p-4 border border-blue-100">
                      <p className="text-gray-800 mb-1">{q.question}</p>
                      <div className="flex items-center gap-2 mt-2">
                        {q.salResource && (
                          <span className="text-xs text-gray-500">–†–µ—Å—É—Ä—Å: {q.salResource}</span>
                        )}
                        {q.participant && (
                          <span className="text-xs text-gray-500">
                            {q.participant === 'first' ? '–ü–µ—Ä–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫' : 
                             q.participant === 'second' ? '–í—Ç–æ—Ä–æ–π —É—á–∞—Å—Ç–Ω–∏–∫' : 
                             '–û–±–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞'}
                          </span>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </section>
            )}

            {/* –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π */}
            {Array.isArray(item.plan123) && item.plan123.length > 0 && (
              <AccordionSection title="üìù –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π" id="plan">
                <div className="space-y-6">
                  {item.plan123.map((plan: any, i: number) => (
                    <div key={i} className="rounded-xl border-2 border-indigo-200 bg-indigo-50 p-5">
                      <h3 className="text-lg font-semibold mb-4">{plan.stageTitle}</h3>
                      {Array.isArray(plan.actions) && plan.actions.length > 0 && (
                        <div className="mb-4">
                          <div className="text-sm font-semibold text-gray-700 mb-2">–î–µ–π—Å—Ç–≤–∏—è:</div>
                          <ul className="list-disc list-inside space-y-1 text-gray-700">
                            {plan.actions.map((action: string, j: number) => (
                              <li key={j}>{action}</li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {Array.isArray(plan.resources) && plan.resources.length > 0 && (
                        <div className="mb-4">
                          <div className="text-sm font-semibold text-gray-700 mb-2">–†–µ—Å—É—Ä—Å—ã:</div>
                          <div className="flex flex-wrap gap-2">
                            {plan.resources.map((res: any, j: number) => {
                              // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏ —Ü–∏—Ñ—Ä: –µ—Å–ª–∏ resource —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–¥ –≤ —Å–∫–æ–±–∫–∞—Ö, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ —Å–Ω–æ–≤–∞
                              const resourceText = res.resource || '';
                              const hasCodeInText = /\(\d+\)/.test(resourceText);
                              const codeText = res.code && !hasCodeInText ? `(${res.code})` : '';
                              return (
                                <span key={j} className="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm">
                                  {resourceText} {codeText}
                                </span>
                              );
                            })}
                          </div>
                        </div>
                      )}
                      {plan.successCriteria && (
                        <div className="mb-4 p-3 bg-green-50 rounded-lg border border-green-200">
                          <div className="text-sm font-semibold text-green-800 mb-1">–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:</div>
                          <p className="text-sm text-green-700">{plan.successCriteria}</p>
                        </div>
                      )}
                      {plan.riskNotes && (
                        <div className="p-3 bg-amber-50 rounded-lg border border-amber-200">
                          <div className="text-sm font-semibold text-amber-800 mb-1">‚ö†Ô∏è –†–∏—Å–∫–∏:</div>
                          <p className="text-sm text-amber-700">{plan.riskNotes}</p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –†–µ—Å—É—Ä—Å—ã –ø–æ —ç—Ç–∞–ø–∞–º */}
            {Array.isArray(item.resourcesForStages) && item.resourcesForStages.length > 0 && (
              <AccordionSection title="üìä –†–µ—Å—É—Ä—Å—ã –ø–æ —ç—Ç–∞–ø–∞–º" id="resources-stages">
                <div className="space-y-6">
                  {item.resourcesForStages.map((stage: any, stageIdx: number) => (
                    <div key={stageIdx} className="rounded-xl border border-blue-100 p-5">
                      <h3 className="text-lg font-semibold mb-4">–≠—Ç–∞–ø {stage.stage}</h3>
                      <div className="space-y-4">
                        {Array.isArray(stage.resources) && stage.resources.map((res: any, resIdx: number) => (
                          <div key={resIdx} className="bg-gray-50 rounded-lg p-4">
                            <div className="font-semibold text-gray-800 mb-2">
                              {res.resource} {res.code && `(${res.code})`}
                              {res.participant && (
                                <span className="text-sm font-normal text-gray-600 ml-2">
                                  ({res.participant === 'first' ? '–ü–µ—Ä–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫' : '–í—Ç–æ—Ä–æ–π —É—á–∞—Å—Ç–Ω–∏–∫'})
                                </span>
                              )}
                            </div>
                            {res.why && <p className="text-sm text-gray-600 mb-2">{res.why}</p>}
                            {Array.isArray(res.successSignals) && res.successSignals.length > 0 && (
                              <div className="mt-2">
                                <div className="text-xs font-semibold text-gray-500 uppercase mb-1">–ü—Ä–∏–∑–Ω–∞–∫–∏ —É—Å–ø–µ—Ö–∞:</div>
                                <ul className="list-disc list-inside space-y-1 text-sm text-gray-700">
                                  {res.successSignals.map((signal: string, sigIdx: number) => (
                                    <li key={sigIdx}>{signal}</li>
                                  ))}
                                </ul>
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */}
            {item.progressMetrics && (
              <AccordionSection title="üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞" id="metrics">
                <div className="space-y-4">
                  {Array.isArray(item.progressMetrics.earlySignals) && item.progressMetrics.earlySignals.length > 0 && (
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-2">–†–∞–Ω–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-gray-600">
                        {item.progressMetrics.earlySignals.map((s: string, i: number) => (
                          <li key={i}>{s}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.progressMetrics.midSignals) && item.progressMetrics.midSignals.length > 0 && (
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-2">–°—Ä–µ–¥–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-gray-600">
                        {item.progressMetrics.midSignals.map((s: string, i: number) => (
                          <li key={i}>{s}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.progressMetrics.resultSignals) && item.progressMetrics.resultSignals.length > 0 && (
                    <div>
                      <h3 className="text-sm font-semibold text-gray-700 mb-2">–ò—Ç–æ–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-gray-600">
                        {item.progressMetrics.resultSignals.map((s: string, i: number) => (
                          <li key={i}>{s}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö */}
            {item.whatIf && (
              <AccordionSection title="üîÑ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö" id="what-if">
                <div className="space-y-4">
                  {Array.isArray(item.whatIf.fatigue) && item.whatIf.fatigue.length > 0 && (
                    <div className="rounded-lg border border-orange-200 bg-orange-50 p-4">
                      <h3 className="text-sm font-semibold text-orange-900 mb-2">–£—Å—Ç–∞–ª–æ—Å—Ç—å</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-orange-800">
                        {item.whatIf.fatigue.map((f: string, i: number) => (
                          <li key={i}>{f}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.whatIf.overwhelm) && item.whatIf.overwhelm.length > 0 && (
                    <div className="rounded-lg border border-red-200 bg-red-50 p-4">
                      <h3 className="text-sm font-semibold text-red-900 mb-2">–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-red-800">
                        {item.whatIf.overwhelm.map((o: string, i: number) => (
                          <li key={i}>{o}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.whatIf.conflicts) && item.whatIf.conflicts.length > 0 && (
                    <div className="rounded-lg border border-purple-200 bg-purple-50 p-4">
                      <h3 className="text-sm font-semibold text-purple-900 mb-2">–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-purple-800">
                        {item.whatIf.conflicts.map((c: string, i: number) => (
                          <li key={i}>{c}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.whatIf.relapse) && item.whatIf.relapse.length > 0 && (
                    <div className="rounded-lg border border-purple-200 bg-purple-50 p-4">
                      <h3 className="text-sm font-semibold text-purple-900 mb-2">–†–µ—Ü–∏–¥–∏–≤</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-purple-800">
                        {item.whatIf.relapse.map((r: string, i: number) => (
                          <li key={i}>{r}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {Array.isArray(item.whatIf.pitfalls) && item.whatIf.pitfalls.length > 0 && (
                    <div className="rounded-lg border border-amber-200 bg-amber-50 p-4">
                      <h3 className="text-sm font-semibold text-amber-900 mb-2">–õ–æ–≤—É—à–∫–∏</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm text-amber-800">
                        {item.whatIf.pitfalls.map((p: string, i: number) => (
                          <li key={i}>{p}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                </div>
              </AccordionSection>
            )}

            {/* –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π */}
            {Array.isArray(item.objectionHandling) && item.objectionHandling.length > 0 && (
              <AccordionSection title="üí¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π" id="objections">
                <div className="space-y-4">
                  {item.objectionHandling.map((obj: any, i: number) => (
                    <div key={i} className="rounded-lg border border-blue-100 bg-blue-50 p-4">
                      <div className="font-semibold text-gray-800 mb-2">&ldquo;{obj.objection}&rdquo;</div>
                      <p className="text-sm text-gray-700">{obj.reply}</p>
                    </div>
                  ))}
                </div>
              </AccordionSection>
            )}

            {/* –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è */}
            {Array.isArray(item.finalStrategy) && item.finalStrategy.length > 0 && (
              <section id="strategy" className="rounded-2xl border-2 border-green-200 bg-green-50 p-6 shadow-sm">
                <h2 className="m-0 text-base font-bold text-green-900 mb-3">‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è</h2>
                <div className="space-y-3">
                  {item.finalStrategy.map((strategy: string, i: number) => (
                    <p key={i} className="text-green-800 leading-relaxed">{strategy}</p>
                  ))}
                </div>
              </section>
            )}
          </div>
        ))}
      </div>
    );
  }

  // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
  const consultationTypeLabel = consultationType === "base" ? "–ë–∞–∑–æ–≤—ã–π" : 
                                  consultationType === "target" ? "–¶–µ–ª–µ–≤–æ–π" : 
                                  consultationType === "partner" ? "–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π" : 
                                  "–†–∞—Å—á–µ—Ç";

  return (
    <div className="space-y-7 sm:space-y-8 max-w-4xl mx-auto">
      {/* –û–±—â–∞—è —à–∞–ø–∫–∞ */}
      <div className="bg-white rounded-2xl border border-gray-200 p-4 md:p-6 shadow-sm">
        <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
          <div className="flex-1 min-w-0">
            <div className="text-xl md:text-2xl font-semibold text-gray-900 break-words">{clientName || "–ü—Ä–æ—Ñ–∏–ª—å"}</div>
            <div className="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 mt-2">
          {profile?.created_at && (
                <div className="text-sm text-gray-500">
                  <span className="font-medium">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</span> {new Date(profile.created_at).toLocaleString("ru-RU")}
                </div>
              )}
              {consultationType && (
                <div className="text-sm">
                  <span className="text-gray-500 font-medium">–¢–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:</span>{" "}
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {consultationTypeLabel}
                  </span>
                </div>
              )}
            </div>
        </div>
          <div className="flex flex-col sm:flex-row gap-3 items-start sm:items-center print:hidden">
            {!polling && profile && <DeleteProfile id={id} />}
          </div>
        </div>
      </div>

      {/* –≠–∫—Å–ø—Ä–µ—Å—Å-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ / –ø—Ä–æ–¥–∞–∂–∞ –ø–æ –°–ê–õ - –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ feature/consultations */}

      {/* –ü—è—Ç—å –∫—É–±–∏–∫–æ–≤ - –≤—ã–≤–æ–¥ –∫–æ–¥–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ä–∞—Å—á–µ—Ç–æ–≤ */}
      {(() => {
        // –î–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥—ã –æ–±–æ–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        if (consultationType === "partner" && profile?.raw_json) {
          try {
            let payload: any = profile.raw_json;
            if (typeof payload === "string") payload = JSON.parse(payload);
            const item = Array.isArray(payload) ? payload[0] : payload;
            
            let firstCodes: any[] = [];
            let secondCodes: any[] = [];
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥—ã –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
            if (item?.firstParticipantCodes) {
              firstCodes = Array.isArray(item.firstParticipantCodes) 
                ? item.firstParticipantCodes 
                : String(item.firstParticipantCodes).split(/[,\s]+/).filter(Boolean);
            } else {
              // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ digits
              const d = (profile as any)?.digits;
              if (Array.isArray(d)) firstCodes = d;
              else if (typeof d === 'string') {
                try {
                  const parsed = JSON.parse(d);
                  if (Array.isArray(parsed)) firstCodes = parsed;
                  else firstCodes = String(d).split(/[,\s]+/).filter(Boolean);
                } catch {
                  firstCodes = String(d).split(/[,\s]+/).filter(Boolean);
                }
              }
              // –ï—Å–ª–∏ –Ω–µ—Ç –≤ digits, –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
              if (firstCodes.length === 0 && clientBirthDate) {
                const calculatedCodes = calculateSALCodes(clientBirthDate);
                if (calculatedCodes) {
                  firstCodes = [
                    calculatedCodes.personality,
                    calculatedCodes.connector,
                    calculatedCodes.realization,
                    calculatedCodes.generator,
                    calculatedCodes.mission,
                  ];
                }
              }
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥—ã –≤—Ç–æ—Ä–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
            if (item?.secondParticipantCodes) {
              secondCodes = Array.isArray(item.secondParticipantCodes) 
                ? item.secondParticipantCodes 
                : String(item.secondParticipantCodes).split(/[,\s]+/).filter(Boolean);
            } else if (item?.partnerCodes) {
              secondCodes = Array.isArray(item.partnerCodes) 
                ? item.partnerCodes 
                : String(item.partnerCodes).split(/[,\s]+/).filter(Boolean);
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–æ–¥—ã –æ–±–æ–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–∞
            if (firstCodes.length > 0 && secondCodes.length > 0) {
              const codeLabels = ["–ö–æ–¥ –õ–∏—á–Ω–æ—Å—Ç–∏", "–ö–æ–¥ –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞", "–ö–æ–¥ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏", "–ö–æ–¥ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞", "–ö–æ–¥ –ú–∏—Å—Å–∏–∏"];
              
              return (
                <div className="space-y-6">
                  {/* –ö–æ–¥—ã –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ */}
                  <div className="space-y-3">
                    <div className="text-center">
                      <h2 className="text-lg md:text-xl font-semibold text-gray-900">–ö–æ–¥—ã –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6 py-4">
                      {firstCodes.slice(0, 5).map((val: any, i: number) => (
                        <div key={i} className="flex flex-col items-center gap-2">
                          <div className="w-14 h-14 md:w-[74px] md:h-[74px] rounded-xl shadow-sm bg-[#1f92aa] text-white font-bold text-xl md:text-[28px] grid place-items-center">
                            {val ?? ""}
                          </div>
                          <div className="text-xs md:text-sm text-gray-600 text-center font-medium">
                            {codeLabels[i] || `–ö–æ–¥ ${i + 1}`}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                  
                  {/* –ö–æ–¥—ã –≤—Ç–æ—Ä–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ */}
                  <div className="space-y-3">
                    <div className="text-center">
                      <h2 className="text-lg md:text-xl font-semibold text-gray-900">–ö–æ–¥—ã –≤—Ç–æ—Ä–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6 py-4">
                      {secondCodes.slice(0, 5).map((val: any, i: number) => (
                        <div key={i} className="flex flex-col items-center gap-2">
                          <div className="w-14 h-14 md:w-[74px] md:h-[74px] rounded-xl shadow-sm bg-[#e91e63] text-white font-bold text-xl md:text-[28px] grid place-items-center">
                            {val ?? ""}
                          </div>
                          <div className="text-xs md:text-sm text-gray-600 text-center font-medium">
                            {codeLabels[i] || `–ö–æ–¥ ${i + 1}`}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              );
            }
          } catch { }
        }
        
        // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–∞—Å—á–µ—Ç–æ–≤ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞
        let arr: any[] = [];
        const d = (profile as any)?.digits;
        if (Array.isArray(d)) arr = d;
        else if (typeof d === 'string') {
          try {
            const parsed = JSON.parse(d);
            if (Array.isArray(parsed)) arr = parsed;
            else arr = String(d).split(/[,\s]+/).filter(Boolean);
          } catch {
            arr = String(d).split(/[,\s]+/).filter(Boolean);
          }
        }

        // –ù–∞–∑–≤–∞–Ω–∏—è –∫–æ–¥–æ–≤ –°–ê–õ
        const codeLabels = ["–ö–æ–¥ –õ–∏—á–Ω–æ—Å—Ç–∏", "–ö–æ–¥ –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞", "–ö–æ–¥ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏", "–ö–æ–¥ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞", "–ö–æ–¥ –ú–∏—Å—Å–∏–∏"];

        // –ï—Å–ª–∏ –∫–æ–¥–æ–≤ –Ω–µ—Ç –≤ digits, –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
        if (arr.length === 0 && clientBirthDate) {
          const calculatedCodes = calculateSALCodes(clientBirthDate);
          if (calculatedCodes) {
            arr = [
              calculatedCodes.personality,
              calculatedCodes.connector,
              calculatedCodes.realization,
              calculatedCodes.generator,
              calculatedCodes.mission,
            ];
          }
        }

        if (arr.length === 0) return null;

        return (
          <div className="space-y-3">
            <div className="text-center">
              <h2 className="text-lg md:text-xl font-semibold text-gray-900">–ö–æ–¥—ã –ø—Ä–æ—Ñ–∏–ª—è</h2>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6 py-4">
              {arr.slice(0, 5).map((val: any, i: number) => (
                <div key={i} className="flex flex-col items-center gap-2">
                  <div className="w-14 h-14 md:w-[74px] md:h-[74px] rounded-xl shadow-sm bg-[#1f92aa] text-white font-bold text-xl md:text-[28px] grid place-items-center">
                {val ?? ""}
                  </div>
                  <div className="text-xs md:text-sm text-gray-600 text-center font-medium">
                    {codeLabels[i] || `–ö–æ–¥ ${i + 1}`}
                  </div>
              </div>
            ))}
            </div>
          </div>
        );
      })()}

      {/* –ü—è—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞) */}
      {consultationType === "base" && (() => {
        const images = (profile as any)?.images;
        let imageArray: any[] = [];
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: –º–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤, –æ–¥–∏–Ω —Ñ–∞–π–ª, —Å—Ç—Ä–æ–∫–∞ JSON, –∏–ª–∏ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
        if (Array.isArray(images)) {
          imageArray = images;
        } else if (images) {
          if (typeof images === 'string') {
            try {
              const parsed = JSON.parse(images);
              imageArray = Array.isArray(parsed) ? parsed : [parsed];
            } catch {
              imageArray = [images];
            }
          } else {
            imageArray = [images];
          }
        }
        
        // –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
        const displayImages = imageArray.length > 0 ? imageArray : Array.from({ length: 5 }).map(() => null);
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const getImageUrl = (img: any): string | null => {
          if (!img) return null;
          
          // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä—è–º–æ–π URL –∏–∑ S3 (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
          if (typeof img === 'object' && img.url) {
            return img.url;
          }
          
          // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ï—Å–ª–∏ —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ images (—Å –ø–æ–ª—è–º–∏ id –∏ code)
          if (typeof img === 'object' && img.id) {
            // –ï—Å–ª–∏ id - —ç—Ç–æ —á–∏—Å–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è S3 URL
            const imageId = img.id;
            if (/^\d+$/.test(String(imageId))) {
              // –ü—Ä–æ–±—É–µ–º —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å S3 URL –Ω–∞–ø—Ä—è–º—É—é
              const s3Endpoint = process.env.NEXT_PUBLIC_S3_ENDPOINT || "https://s3.ru1.storage.beget.cloud";
              const s3Bucket = process.env.NEXT_PUBLIC_S3_BUCKET || "da0eaeb06b35-sal-app";
              const s3Path = process.env.NEXT_PUBLIC_S3_IMAGES_PATH || "sall_app/photo";
              const cleanPath = s3Path.replace(/^\/+|\/+$/g, '');
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º path-style —Ñ–æ—Ä–º–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
              const s3Url = `${s3Endpoint}/${s3Bucket}/${cleanPath}/${imageId}.jpeg`;
              return s3Url;
            }
          }
          
          // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ï—Å–ª–∏ —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ images (—Å –ø–æ–ª—è–º–∏ id –∏ code)
          if (typeof img === 'object' && img.code) {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º code –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            // –ï—Å–ª–∏ code - —ç—Ç–æ ID —Ñ–∞–π–ª–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º S3 URL –Ω–∞–ø—Ä—è–º—É—é
            if (/^\d+$/.test(String(img.code))) {
              const s3Endpoint = process.env.NEXT_PUBLIC_S3_ENDPOINT || "https://s3.ru1.storage.beget.cloud";
              const s3Bucket = process.env.NEXT_PUBLIC_S3_BUCKET || "da0eaeb06b35-sal-app";
              const s3Path = process.env.NEXT_PUBLIC_S3_IMAGES_PATH || "sall_app/photo";
              const cleanPath = s3Path.replace(/^\/+|\/+$/g, '');
              const s3Url = `${s3Endpoint}/${s3Bucket}/${cleanPath}/${img.code}.jpeg`;
              return s3Url;
            }
            // –ò–Ω–∞—á–µ code –º–æ–∂–µ—Ç –±—ã—Ç—å URL –∏–ª–∏ –¥—Ä—É–≥–∏–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º
            return img.code;
          }
          
          // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Ñ–∞–π–ª–∞ Directus —Å –ø–æ–ª–Ω—ã–º URL
          if (typeof img === 'object') {
            if (img.id) {
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
              return `/api/files/${img.id}`;
            }
            if (img.filename_download) {
              return img.id ? `/api/files/${img.id}` : null;
            }
          }
          
          // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5: –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
          if (typeof img === 'string') {
            // –ï—Å–ª–∏ —É–∂–µ –ø–æ–ª–Ω—ã–π URL
            if (img.startsWith('http')) return img;
            // –ï—Å–ª–∏ —ç—Ç–æ ID —Ñ–∞–π–ª–∞
            if (/^\d+$/.test(img)) {
              // –§–æ—Ä–º–∏—Ä—É–µ–º S3 URL –Ω–∞–ø—Ä—è–º—É—é
              const s3Endpoint = process.env.NEXT_PUBLIC_S3_ENDPOINT || "https://s3.ru1.storage.beget.cloud";
              const s3Bucket = process.env.NEXT_PUBLIC_S3_BUCKET || "da0eaeb06b35-sal-app";
              const s3Path = process.env.NEXT_PUBLIC_S3_IMAGES_PATH || "sall_app/photo";
              const cleanPath = s3Path.replace(/^\/+|\/+$/g, '');
              const s3Url = `${s3Endpoint}/${s3Bucket}/${cleanPath}/${img}.jpeg`;
              return s3Url;
            }
            // –ò–Ω–∞—á–µ —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ URL
            return img;
          }
          
          return null;
        };
        
        return (
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
            {displayImages.slice(0, 5).map((img: any, i: number) => {
              const imageUrl = getImageUrl(img);
              
              return (
                <div key={i} className="rounded-2xl overflow-hidden border bg-gray-50 relative max-w-[200px] mx-auto sm:max-w-none sm:mx-0" style={{ aspectRatio: '2/3' }}>
                  {imageUrl ? (
                    <>
                      {/* eslint-disable-next-line @next/next/no-img-element */}
                      <img 
                        src={imageUrl} 
                        alt={`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${i + 1}`}
                        className="w-full h-full object-contain"
                        onError={(e) => {
                          const target = e.target as HTMLImageElement;
                          if (process.env.NODE_ENV === 'development') {
                            console.error(`[ERROR] Failed to load image ${i + 1}:`, {
                              url: imageUrl,
                              imageData: img,
                              error: '403 Forbidden - –≤–æ–∑–º–æ–∂–Ω–æ —Ñ–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ S3 –∏–ª–∏ bucket –Ω–µ –ø—É–±–ª–∏—á–Ω—ã–π',
                              suggestion: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: 1) –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –≤ S3 –ø–æ –ø—É—Ç–∏ sall_app/photo/{ID}.jpeg, 2) Bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã–π'
                            });
                          }
                          target.style.display = 'none';
                          const placeholder = target.nextElementSibling as HTMLElement;
                          if (placeholder) {
                            placeholder.classList.remove('hidden');
                            placeholder.innerHTML = `<div class="text-red-400 text-xs text-center p-2">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏<br/>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª—É</div>`;
                          }
                        }}
                        onLoad={() => {}}
                      />
                      <div className="hidden absolute inset-0 flex items-center justify-center text-gray-400 bg-gray-50">
            –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ {i + 1}
          </div>
                    </>
                  ) : (
                    <div className="absolute inset-0 flex items-center justify-center text-gray-400">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ {i + 1}</div>
                  )}
      </div>
              );
            })}
      </div>
        );
      })()}

      {(polling || !profile) && <LoadingMessage />}

      {/* –ú–µ–Ω—é-–Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –±–ª–æ–∫–∞–º */}
      {!polling && renderedFromJson && consultationType && (() => {
        const menuItems: Array<{ id: string; label: string; icon?: string }> = [];
        
        if (consultationType === "base") {
          menuItems.push(
            { id: "opener", label: "–°–∫–∞–∂–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—É", icon: "‚ùó" },
            { id: "coreTask", label: "–ö–ª—é—á–µ–≤–∞—è –∑–∞–¥–∞—á–∞", icon: "üéØ" },
            { id: "personality", label: "–û–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏", icon: "üë§" },
            { id: "codes", label: "–ü–æ—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–æ–≤", icon: "üî¢" },
            { id: "strengths", label: "–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã", icon: "‚öñÔ∏è" },
            { id: "weaknesses", label: "–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã", icon: "‚öñÔ∏è" },
            { id: "happiness", label: "–§–æ—Ä–º—É–ª–∞ —Å—á–∞—Å—Ç—å—è", icon: "‚ò∫Ô∏è" },
            { id: "resource-signals", label: "–ü—Ä–∏–∑–Ω–∞–∫–∏ –ø–ª—é—Å–∞", icon: "‚úÖ" },
            { id: "deficit-signals", label: "–ü—Ä–∏–∑–Ω–∞–∫–∏ –º–∏–Ω—É—Å–∞", icon: "‚ùå" },
            { id: "keyConflicts", label: "–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã", icon: "‚ö†Ô∏è" },
            { id: "conflicts", label: "–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã", icon: "‚ö†Ô∏è" },
            { id: "levers", label: "–†—ã—á–∞–≥–∏ –≤–ª–∏—è–Ω–∏—è", icon: "üîß" },
            { id: "focusNow", label: "–§–æ–∫—É—Å –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–π –ø–µ—Ä–∏–æ–¥", icon: "üéØ" },
            { id: "consultantQuestions", label: "–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞", icon: "‚ùì" },
            { id: "practices", label: "–ü—Ä–∞–∫—Ç–∏–∫–∏", icon: "üí°" }
          );
        } else if (consultationType === "target") {
          menuItems.push(
            { id: "goal", label: "–¶–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞", icon: "üéØ" },
            { id: "goal-decomposition", label: "–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ü–µ–ª–∏", icon: "üìã" },
            { id: "warnings", label: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è", icon: "‚ö†Ô∏è" },
            { id: "questions", label: "–í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è", icon: "‚ùì" },
            { id: "diagnostics", label: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", icon: "üîç" },
            { id: "resources-stages", label: "–†–µ—Å—É—Ä—Å—ã –ø–æ —ç—Ç–∞–ø–∞–º", icon: "üìä" },
            { id: "plan", label: "–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π", icon: "üìù" },
            { id: "metrics", label: "–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞", icon: "üìà" },
            { id: "what-if", label: "–ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö", icon: "üîÑ" },
            { id: "objections", label: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π", icon: "üí¨" },
            { id: "strategy", label: "–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è", icon: "‚úÖ" }
          );
        } else if (consultationType === "partner") {
          menuItems.push(
            { id: "goal", label: "–¶–µ–ª—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏", icon: "üéØ" },
            { id: "goal-decomposition", label: "–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ü–µ–ª–∏ –ø–∞—Ä—ã", icon: "üìã" },
            { id: "warnings", label: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è", icon: "‚ö†Ô∏è" },
            { id: "compatibility", label: "–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤", icon: "ü§ù" },
            { id: "conflict-zones", label: "–ó–æ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤", icon: "‚öîÔ∏è" },
            { id: "diagnostics", label: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞", icon: "üîç" },
            { id: "participants-diagnostics", label: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤", icon: "üë•" },
            { id: "questions", label: "–í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è", icon: "‚ùì" },
            { id: "plan", label: "–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π", icon: "üìù" },
            { id: "resources-stages", label: "–†–µ—Å—É—Ä—Å—ã –ø–æ —ç—Ç–∞–ø–∞–º", icon: "üìä" },
            { id: "metrics", label: "–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞", icon: "üìà" },
            { id: "what-if", label: "–ß—Ç–æ –¥–µ–ª–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö", icon: "üîÑ" },
            { id: "objections", label: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–π", icon: "üí¨" },
            { id: "strategy", label: "–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è", icon: "‚úÖ" }
          );
        } else if (consultationType === "child") {
          menuItems.push(
            { id: "opener", label: "–°–∫–∞–∂–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—è–º", icon: "üë∂" },
            { id: "childPotential", label: "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —Ä–µ–±–µ–Ω–∫–∞", icon: "üåü" },
            { id: "developmentFeatures", label: "–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è", icon: "üå±" },
            { id: "upbringingRecommendations", label: "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—é", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
            { id: "educationalApproach", label: "–ü–æ–¥—Ö–æ–¥ –∫ –æ–±—É—á–µ–Ω–∏—é", icon: "üìö" },
            { id: "communicationStyle", label: "–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è", icon: "üó£Ô∏è" },
            { id: "challengesAndSolutions", label: "–í—ã–∑–æ–≤—ã –∏ —Ä–µ—à–µ–Ω–∏—è", icon: "üöß" },
            { id: "activitiesAndHobbies", label: "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ö–æ–±–±–∏", icon: "üé®" },
            { id: "parentChildInteraction", label: "–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å-—Ä–µ–±–µ–Ω–æ–∫", icon: "ü§ù" },
            { id: "futureProspects", label: "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –±—É–¥—É—â–µ–≥–æ", icon: "üîÆ" }
          );
        }

        if (menuItems.length === 0) return null;

        return (
          <div className="bg-white rounded-2xl border border-gray-200 shadow-sm sticky top-20 md:top-4 z-10 md:mt-0 mt-16 print:hidden">
            <button
              onClick={(e) => {
                e.preventDefault();
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
                const currentScroll = window.pageYOffset;
                setNavigationExpanded(!navigationExpanded);
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM
                requestAnimationFrame(() => {
                  window.scrollTo({
                    top: currentScroll,
                    behavior: 'auto' // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ, –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
                  });
                });
              }}
              className="w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors rounded-t-2xl"
            >
              <div className="text-sm font-semibold text-gray-700">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –±–ª–æ–∫–∞–º</div>
              <svg 
                className={`w-5 h-5 text-gray-500 transition-transform duration-300 ${navigationExpanded ? 'rotate-180' : ''}`}
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div 
              className="overflow-hidden transition-all duration-300 ease-in-out"
              style={{
                maxHeight: navigationExpanded ? '1000px' : '0px',
                opacity: navigationExpanded ? 1 : 0
              }}
            >
              <div className="p-4 pt-0 flex flex-wrap gap-2">
                {menuItems.map((item) => (
                  <button
                    key={item.id}
                    type="button"
                    onClick={(e) => {
                      e.preventDefault();
                      const element = document.getElementById(item.id);
                      if (element) {
                        // –ù–∞—Ö–æ–¥–∏–º –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ offset
                        const menuElement = e.currentTarget.closest('.bg-white.rounded-2xl.border') as HTMLElement;
                        let offset = 100; // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π offset
                        
                        if (menuElement) {
                          const menuHeight = menuElement.offsetHeight;
                          // –í—ã—Å–æ—Ç–∞ –º–µ–Ω—é + 10% –æ—Ç –µ–≥–æ –≤—ã—Å–æ—Ç—ã
                          offset = menuHeight + (menuHeight * 0.1);
                        }
                        
                        const elementPosition = element.getBoundingClientRect().top;
                        if (typeof window !== 'undefined') {
                          const offsetPosition = elementPosition + window.pageYOffset - offset;
                          window.scrollTo({
                            top: offsetPosition,
                            behavior: 'smooth'
                          });
                        }
                      }
                    }}
                    className="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors cursor-pointer"
                  >
                    {item.icon && <span>{item.icon}</span>}
                    <span>{item.label}</span>
                  </button>
        ))}
      </div>
            </div>
          </div>
        );
      })()}

      {/* –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è */}
      {!polling && !profile && (
        <div className="card bg-red-50 border-red-200">
          <div className="flex items-center gap-3 text-red-800">
            <svg className="h-5 w-5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
            <div>
              <div className="font-semibold">–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞</div>
              <div className="text-sm mt-1">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.</div>
              <a href="/login" className="text-sm underline mt-2 inline-block">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞</a>
            </div>
          </div>
        </div>
      )}

      {(() => {
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º HTML
        const html = (profile as any)?.html || (profile as any)?.raw_html || (profile as any)?.content || (profile as any)?.html_content;
        if (html && String(html).trim().length > 0) {
          return (
            <AccordionSection title="–ì–æ—Ç–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç (HTML)">
              <div className="card" dangerouslySetInnerHTML={{ __html: String(html) }} />
            </AccordionSection>
          );
        }
        
        // –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º raw_json
        if (renderedFromJson) {
          return renderedFromJson;
        }
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å raw_json, –Ω–æ renderedFromJson –≤–µ—Ä–Ω—É–ª null, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        if (profile?.raw_json && !polling) {
          if (process.env.NODE_ENV === 'development') {
            console.warn("[DEBUG] raw_json exists but renderedFromJson is null:", {
              rawJsonType: typeof profile.raw_json,
              rawJsonKeys: typeof profile.raw_json === 'object' && profile.raw_json !== null ? Object.keys(profile.raw_json) : [],
              rawJsonPreview: typeof profile.raw_json === 'string'
                ? profile.raw_json.substring(0, 200)
                : JSON.stringify(profile.raw_json).substring(0, 200)
            });
          }
          
          // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å raw_json –≤ —Å—ã—Ä–æ–º –≤–∏–¥–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          return (
            <div className="card">
              <div className="text-sm font-semibold mb-2">–î–∞–Ω–Ω—ã–µ –∏–∑ raw_json (–æ—Ç–ª–∞–¥–∫–∞):</div>
              <pre className="text-xs bg-gray-100 p-3 rounded overflow-auto max-h-96">
                {typeof profile.raw_json === 'string' 
                  ? profile.raw_json 
                  : JSON.stringify(profile.raw_json, null, 2)}
              </pre>
            </div>
          );
        }
        
        return !polling ? (
          <div className="card text-sm text-gray-600">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</div>
        ) : null;
      })()}

      {!polling && renderedFromJson && consultationType && (
        <div className="card space-y-4 print:hidden">
          <div className="font-semibold text-lg">üí¨ –ß–∞—Ç —Å –ò–ò –ø–æ –ø—Ä–æ—Ñ–∏–ª—é</div>
        <div className="space-y-3">
            <div ref={chatBoxRef} className="rounded-xl border-2 border-gray-200 p-4 bg-white min-h-[300px] max-h-[500px] md:max-h-[600px] overflow-y-auto break-words">
            {chat.length === 0 && <div className="text-sm text-gray-500">–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥ ‚Äî –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∏–∂–µ</div>}
            {chat.map((m, i) => (
              <div key={i} className={`mb-3 ${m.role === 'user' ? 'text-right' : 'text-left'}`}>
                <div className={`inline-block rounded-2xl px-4 py-3 max-w-[85%] ${m.role === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'}`}>
                  {m.role === 'assistant' ? (
                    <div className="prose prose-sm max-w-none dark:prose-invert">
                      <ReactMarkdown
                        remarkPlugins={[remarkGfm]}
                        components={{
                          // –ó–∞–≥–æ–ª–æ–≤–∫–∏
                            h1: ({ node, ...props }) => <h1 className="text-lg font-bold mb-2 mt-3 first:mt-0" {...props} />,
                            h2: ({ node, ...props }) => <h2 className="text-base font-bold mb-2 mt-3 first:mt-0" {...props} />,
                            h3: ({ node, ...props }) => <h3 className="text-sm font-semibold mb-1 mt-2 first:mt-0" {...props} />,
                          // –ü–∞—Ä–∞–≥—Ä–∞—Ñ—ã
                            p: ({ node, ...props }) => <p className="mb-2 last:mb-0 leading-relaxed" {...props} />,
                          // –°–ø–∏—Å–∫–∏
                            ul: ({ node, ...props }) => <ul className="list-disc list-inside mb-2 space-y-1 ml-2" {...props} />,
                            ol: ({ node, ...props }) => <ol className="list-decimal list-inside mb-2 space-y-1 ml-2" {...props} />,
                            li: ({ node, ...props }) => <li className="leading-relaxed" {...props} />,
                          // –°—Å—ã–ª–∫–∏
                            a: ({ node, ...props }) => <a className="text-blue-600 underline hover:text-blue-800" target="_blank" rel="noopener noreferrer" {...props} />,
                          // –ö–æ–¥
                            code: ({ node, inline, ...props }: any) =>
                            inline ? (
                              <code className="bg-gray-200 text-gray-800 px-1.5 py-0.5 rounded text-xs font-mono" {...props} />
                            ) : (
                              <code className="block bg-gray-200 text-gray-800 p-2 rounded text-xs font-mono overflow-x-auto mb-2" {...props} />
                            ),
                            pre: ({ node, ...props }) => <pre className="bg-gray-200 p-2 rounded overflow-x-auto mb-2" {...props} />,
                          // –¢–∞–±–ª–∏—Ü—ã
                            table: ({ node, ...props }) => (
                            <div className="overflow-x-auto my-2">
                              <table className="min-w-full border-collapse border border-gray-300" {...props} />
                            </div>
                          ),
                            thead: ({ node, ...props }) => <thead className="bg-gray-200" {...props} />,
                            tbody: ({ node, ...props }) => <tbody {...props} />,
                            tr: ({ node, ...props }) => <tr className="border-b border-gray-300" {...props} />,
                            th: ({ node, ...props }) => <th className="border border-gray-300 px-2 py-1 text-left font-semibold" {...props} />,
                            td: ({ node, ...props }) => <td className="border border-gray-300 px-2 py-1" {...props} />,
                          // –í—ã–¥–µ–ª–µ–Ω–∏–µ
                            strong: ({ node, ...props }) => <strong className="font-semibold" {...props} />,
                            em: ({ node, ...props }) => <em className="italic" {...props} />,
                          // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
                            hr: ({ node, ...props }) => <hr className="my-3 border-gray-300" {...props} />,
                          // –ë–ª–æ–∫–∏ —Ü–∏—Ç–∞—Ç
                            blockquote: ({ node, ...props }) => (
                            <blockquote className="border-l-4 border-gray-400 pl-3 italic my-2 text-gray-700" {...props} />
                          ),
                        }}
                      >
                        {m.content}
                      </ReactMarkdown>
                    </div>
                  ) : (
                    <div className="whitespace-pre-wrap break-words">{m.content}</div>
                  )}
                  {loading && i === chat.length - 1 && m.role === 'assistant' && (
                    <span className="inline-block w-2 h-4 ml-1 bg-gray-400 animate-pulse">‚ñã</span>
                  )}
                </div>
              </div>
            ))}
          </div>
          <form onSubmit={ask} className="flex items-start gap-3">
            <textarea
                className="flex-1 rounded-xl border-2 border-gray-200 p-4 h-28 md:h-32 resize-none overflow-y-auto text-base focus:border-brand-500 focus:ring-2 focus:ring-brand-200 transition"
              value={question}
              onChange={(e) => setQuestion(e.target.value)}
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–∞–∫ –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–º 2‚Üî7?"
              required
            />
            <button
              disabled={loading}
                className="rounded-2xl bg-brand-600 text-white px-6 py-4 h-28 md:h-32 hover:bg-brand-700 disabled:opacity-60 transition-colors font-medium text-base"
            >
              {loading ? "–î—É–º–∞—é..." : "–°–ø—Ä–æ—Å–∏—Ç—å"}
            </button>
          </form>
        </div>
      </div>
      )}

      {/* –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ ¬´–ó–∞–º–µ—Ç–∫–∏¬ª */}
      <button
        onClick={() => setNotesOpen(true)}
        className="fixed right-4 bottom-6 md:right-6 md:bottom-6 rounded-full shadow-lg bg-brand-600 text-white px-4 py-2 md:px-5 md:py-3 hover:bg-brand-700 z-30 text-sm md:text-base print:hidden"
      >
        üìù –ó–∞–º–µ—Ç–∫–∏
      </button>

      {notesOpen && (
        <div className="fixed inset-0 bg-black/40 z-50 grid place-items-center p-4" onClick={() => setNotesOpen(false)}>
          <div className="bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col" onClick={(e) => e.stopPropagation()}>
            <div className="flex items-center justify-between p-6 border-b">
            <div className="font-semibold">–ó–∞–º–µ—Ç–∫–∏ –ø–æ —Ä–∞—Å—á—ë—Ç—É</div>
              <button className="text-gray-500 hover:text-gray-800" onClick={() => setNotesOpen(false)}>‚úï</button>
            </div>
            <div className="p-6 overflow-y-auto flex-grow">
              <div className="mb-4">
                <NotesTemplates onSelect={(content) => {
                  // –ï—Å–ª–∏ –≤ –∑–∞–º–µ—Ç–∫–µ —É–∂–µ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç, –¥–æ–±–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω –≤ –∫–æ–Ω–µ—Ü
                  // –ï—Å–ª–∏ –∑–∞–º–µ—Ç–∫–∞ –ø—É—Å—Ç–∞—è, –ø—Ä–æ—Å—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∞–±–ª–æ–Ω
                  const currentText = notesDraft.trim();
                  if (currentText) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏ —à–∞–±–ª–æ–Ω –≤ –∫–æ–Ω–µ—Ü
                    setNotesDraft(currentText + '<br/><br/>' + content);
                  } else {
                    setNotesDraft(content);
                  }
                  notesTouchedRef.current = true;
                }} />
              </div>
              <RichEditor
              value={notesDraft}
                onChange={(html) => {
                  setNotesDraft(html);
                  notesTouchedRef.current = true;
                }}
              />
            <div className="flex gap-2 justify-end mt-4">
                <button className="rounded-xl border px-4 py-2" onClick={() => setNotesOpen(false)}>–û—Ç–º–µ–Ω–∞</button>
              <button
                className="rounded-xl bg-brand-600 text-white px-4 py-2 hover:bg-brand-700 disabled:opacity-60"
                disabled={savingNotes}
                  onClick={async () => {
                  setSavingNotes(true);
                  try {
                    const res = await fetch(`/api/profiles/${id}`, { method: 'PATCH', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ notes: notesDraft }) });
                    if (!res.ok) throw new Error('Failed to save notes');
                    setProfile(p => (p ? { ...p, notes: notesDraft } : p));
                    setNotesOpen(false);
                  } finally { setSavingNotes(false); }
                }}
              >
                {savingNotes ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...' : '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'}
              </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function mapPracticeKey(key: string): string {
  const dict: Record<string, string> = {
    personality: "–õ–∏—á–Ω–æ—Å—Ç—å",
    connector: "–°–≤—è–∑–∏/–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è",
    realization: "–†–µ–∞–ª–∏–∑–∞—Ü–∏—è",
    generator: "–ò—Å—Ç–æ—á–Ω–∏–∫/–ü–æ–¥–ø–∏—Ç–∫–∞",
    mission: "–ú–∏—Å—Å–∏—è",
  };
  return dict[key] || key;
}
