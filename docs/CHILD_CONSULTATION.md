# Детский расчет САЛ

## Описание

Детский расчет предназначен для родителей, которые хотят лучше понять своего ребенка и получить рекомендации по воспитанию, обучению и развитию на основе кодов САЛ ребенка.

## Особенности

- **Два режима работы:**
  - Общий расчет (без запроса) - полный анализ потенциала, рекомендаций по воспитанию и развитию
  - Расчет с запросом - учитывает конкретный вопрос или проблему родителей

- **Структура результата:**
  - opener - вводная фраза для родителей
  - childPotential - потенциал ребенка (3-5 абзацев)
  - developmentFeatures - особенности развития (5-7 пунктов)
  - upbringingRecommendations - рекомендации по воспитанию (7-10 пунктов)
  - educationalApproach - подход к обучению (5-7 рекомендаций)
  - communicationStyle - стиль общения (3-5 рекомендаций)
  - challengesAndSolutions - вызовы и решения (5-7 пунктов)
  - activitiesAndHobbies - активности и хобби (5-7 рекомендаций)
  - parentChildInteraction - взаимодействие родитель-ребенок (3-5 абзацев)
  - futureProspects - перспективы будущего (2-3 абзаца)

## Использование

### Через API

```typescript
// Общий детский расчет
POST /api/calc
{
  "name": "Анна",
  "birthday": "2015-03-20",
  "type": "child",
  "clientId": 123,
  "gender": "female"
}

// Детский расчет с запросом
POST /api/calc
{
  "name": "Анна",
  "birthday": "2015-03-20",
  "type": "child",
  "request": "Ребенок очень активный, не может усидеть на месте, как помочь ему сконцентрироваться?",
  "clientId": 123,
  "gender": "female"
}
```

### Параметры

- **name** (обязательно) - имя ребенка
- **birthday** (обязательно) - дата рождения ребенка (формат: YYYY-MM-DD или DD.MM.YYYY)
- **type** (обязательно) - должно быть "child"
- **request** (опционально) - запрос родителей, конкретный вопрос или проблема
- **clientId** (опционально) - ID клиента в системе
- **gender** (опционально) - пол ребенка

## Структура ответа

```json
{
  "opener": "Ваш ребенок обладает уникальным сочетанием...",
  "childPotential": [
    "Абзац 1 о потенциале...",
    "Абзац 2 о потенциале...",
    "Абзац 3 о потенциале..."
  ],
  "developmentFeatures": [
    "Особенность развития 1",
    "Особенность развития 2",
    "..."
  ],
  "upbringingRecommendations": [
    "Рекомендация 1",
    "Рекомендация 2",
    "..."
  ],
  "educationalApproach": [
    "Подход к обучению 1",
    "Подход к обучению 2",
    "..."
  ],
  "communicationStyle": [
    "Стиль общения 1",
    "Стиль общения 2",
    "..."
  ],
  "challengesAndSolutions": [
    "Вызов и решение 1",
    "Вызов и решение 2",
    "..."
  ],
  "activitiesAndHobbies": [
    "Активность 1",
    "Активность 2",
    "..."
  ],
  "parentChildInteraction": [
    "Абзац о взаимодействии 1",
    "Абзац о взаимодействии 2",
    "..."
  ],
  "futureProspects": [
    "Абзац о перспективах 1",
    "Абзац о перспективах 2"
  ]
}
```

## Валидация

Система автоматически валидирует результат генерации:

- ✅ Проверка обязательных полей
- ✅ Проверка длин массивов (соответствие min/max)
- ✅ Проверка типов данных
- ✅ Проверка структуры вложенных объектов

## Примеры запросов родителей

### Пример 1: Проблема с концентрацией
```
"Ребенок очень активный, не может усидеть на месте, как помочь ему сконцентрироваться?"
```

### Пример 2: Проблема с общением
```
"Ребенок стеснительный, не хочет общаться со сверстниками, как помочь?"
```

### Пример 3: Выбор кружков
```
"Какие кружки и занятия подойдут нашему ребенку? Он любит рисовать и музыку."
```

### Пример 4: Проблема с обучением
```
"Ребенок не хочет делать домашнее задание, как мотивировать его к учебе?"
```

## Особенности генерации

1. **Учет запроса:** Если указан запрос родителей, он учитывается при формировании всех разделов, особенно в рекомендациях по воспитанию и решении вызовов.

2. **Фокус на практику:** Все рекомендации носят практический характер и применимы в повседневной жизни.

3. **Учет возраста:** Система учитывает, что это ребенок, и формулирует рекомендации соответственно.

4. **Указание ресурсов:** Во всех разделах указываются ресурсы САЛ с цифрами (например, "Личность (1)", "Коннектор (2)").

## Интеграция

Детский расчет полностью интегрирован в систему серверной генерации:

- ✅ Использует те же механизмы генерации
- ✅ Поддерживает валидацию
- ✅ Сохраняется в Directus в том же формате
- ✅ Поддерживает retry логику
- ✅ Имеет детальное логирование

## Отличия от базового расчета

1. **Фокус на родителях:** Текст адресован родителям, а не самому ребенку
2. **Практические рекомендации:** Больше внимания к конкретным советам по воспитанию
3. **Учет запроса:** Опциональный запрос родителей учитывается при генерации
4. **Структура:** Специальная структура, адаптированная для детского профиля

