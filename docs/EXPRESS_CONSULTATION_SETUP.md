# Настройка экспресс-консультаций в Directus

## Необходимые изменения в Directus

### 1. Расширение коллекции `consultations`

Добавьте следующие поля в коллекцию `consultations`:

- **`sold_product`** (String, nullable)
  - Тип: String
  - Интерфейс: Dropdown
  - Варианты: `"full"`, `"partner"`, `null`
  - Описание: Что было продано в результате экспресс-консультации

- **`importance_rating`** (Integer, nullable)
  - Тип: Integer
  - Интерфейс: Input
  - Описание: Оценка важности для клиента (1-10)

- **`completed_at`** (Timestamp, nullable)
  - Тип: Timestamp
  - Интерфейс: Datetime
  - Описание: Дата и время завершения консультации

### 2. Обновление типа консультации

Убедитесь, что в поле `type` коллекции `consultations` есть значение `"express"`:

- В настройках поля `type` добавьте `"express"` в список вариантов Dropdown

### 3. Коллекция `consultation_details`

Эта коллекция уже должна существовать (согласно `opis.md`). Убедитесь, что она имеет следующие поля:

- `id` (Integer, PK)
- `consultation_id` (M2O → `consultations`, required)
- `section` (String)
- `content` (Text)

**Важно:** Мы используем `consultation_details` для хранения шагов консультации. Поле `section` содержит тип шага (например, `"point_a_1"`), а `content` содержит JSON с данными шага.

## Использование

### Запуск экспресс-консультации

1. Откройте страницу клиента
2. Нажмите кнопку "Экспресс-консультация"
3. Система автоматически создаст запись консультации с типом `"express"`

### Проведение консультации

1. **Точка А (Текущая ситуация)**
   - Выберите проблемы из готовых вариантов (кнопки)
   - Можете добавить свой текст
   - Нажмите "Сохранить и перейти дальше"

2. **Точка Б (Хотелки и видение)**
   - Выберите желания из готовых вариантов
   - Можете добавить свой текст
   - Нажмите "Сохранить и перейти дальше"

3. **Ресурсы**
   - Выберите доступные ресурсы клиента
   - Система покажет, что может дать полная консультация
   - Нажмите "Сохранить и перейти к продаже"

4. **Закрытие и продажа**
   - Просмотрите резюме консультации
   - Оцените важность для клиента (1-10)
   - Выберите, что было продано (полная консультация, парная, или ничего)
   - Нажмите "Завершить консультацию"

### Просмотр результатов

После завершения консультации вы будете перенаправлены на страницу консультации, где можно увидеть все сохраненные шаги и результат продажи.

## API Endpoints

- `POST /api/consultations/express/start` - Создать новую экспресс-консультацию
- `POST /api/consultations/express/:id/steps` - Сохранить шаг консультации
- `GET /api/consultations/express/:id` - Получить данные консультации со всеми шагами
- `PATCH /api/consultations/express/:id` - Завершить консультацию и сохранить результат продажи

## Особенности реализации

- **Аккордеон-схема:** Один шаг открыт, остальные свернуты
- **Кнопки выбора:** Максимум кнопок, минимум текстового ввода (для медленно печатающих консультантов)
- **Автосохранение:** Каждый шаг сохраняется автоматически
- **Визуальная индикация:** Завершенные шаги отмечены зеленой галочкой

