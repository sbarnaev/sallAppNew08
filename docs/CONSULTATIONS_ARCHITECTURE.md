# Архитектура функционала проведения консультаций

## Обзор
Система для проведения экспресс-консультаций с целью продажи полной консультации или парной консультации.

## Цель экспресс-консультации
- Провести клиента через 3 этапа: Точка А → Точка Б → Ресурсы
- Вдохновить клиента и показать ценность полной консультации
- Продать полную консультацию или парную консультацию

## Структура данных

### 1. Коллекция `express_consultations`
Расширяет существующую коллекцию `consultations` с типом `"express"`.

**Поля:**
- `id` - Integer (PK)
- `client_id` - M2O → `clients` (обязательно)
- `owner_user` - M2O → `directus_users` (консультант)
- `type` - String: `"express"` (новый тип)
- `status` - String: `"in_progress"`, `"completed"`, `"cancelled"`
- `created_at` - Timestamp
- `completed_at` - Timestamp (nullable)
- `sold_product` - String: `"full"`, `"partner"`, `null` (что продали)

### 2. Коллекция `consultation_steps`
Шаги консультации с ответами клиента.

**Поля:**
- `id` - Integer (PK)
- `consultation_id` - M2O → `consultations` (обязательно)
- `step_type` - String: `"point_a"`, `"point_b"`, `"resources"`, `"closing"`
- `step_order` - Integer (порядок шага)
- `question` - Text (вопрос консультанта)
- `response` - Text (ответ клиента)
- `response_type` - String: `"button"`, `"text"`, `"rating"` (тип ответа)
- `selected_options` - JSON (выбранные варианты из кнопок)
- `created_at` - Timestamp

### 3. Коллекция `consultation_templates`
Шаблоны вопросов и вариантов ответов для быстрого использования.

**Поля:**
- `id` - Integer (PK)
- `step_type` - String: `"point_a"`, `"point_b"`, `"resources"`
- `question_template` - Text (шаблон вопроса)
- `response_options` - JSON (массив вариантов ответов)
- `order` - Integer (порядок в списке)
- `is_active` - Boolean

## UI/UX Архитектура

### Компонент `ExpressConsultationFlow`
Основной компонент для проведения экспресс-консультации.

**Особенности:**
- Аккордеон-схема: один шаг открыт, остальные свернуты
- Кнопки выбора вместо текстового ввода (для медленно печатающих консультантов)
- Возможность добавить свой текст (опционально)
- Автосохранение прогресса
- Визуальная индикация завершенных шагов

### Структура шагов:

#### 1. Точка А (Текущая ситуация)
- Вопросы о проблемах и сложностях
- Варианты ответов: "Не получается найти клиентов", "Низкий доход", "Нет мотивации", и т.д.
- Возможность добавить свой ответ

#### 2. Точка Б (Хотелки и видение)
- Вопросы о желаемых результатах
- Варианты: "Зарабатывать X рублей", "Жить в теплой стране", "Признание", и т.д.
- Углубляющие вопросы для вдохновения

#### 3. Ресурсы
- Вопросы о доступных ресурсах
- Варианты: "Время", "Деньги", "Навыки", "Соцсети", и т.д.
- Перечисление того, что может дать полная консультация

#### 4. Закрытие и продажа
- Резюме: Точка А → Точка Б
- Вопрос о важности (1-10)
- Предложение: полная консультация или парная
- Обработка возражений

## API Endpoints

### `POST /api/consultations/express/start`
Создает новую экспресс-консультацию.

**Request:**
```json
{
  "client_id": 123
}
```

**Response:**
```json
{
  "data": {
    "id": 456,
    "client_id": 123,
    "status": "in_progress"
  }
}
```

### `POST /api/consultations/express/:id/steps`
Сохраняет шаг консультации.

**Request:**
```json
{
  "step_type": "point_a",
  "step_order": 1,
  "question": "Что не получается?",
  "response": "Не получается найти клиентов",
  "response_type": "button",
  "selected_options": ["clients", "income"]
}
```

### `GET /api/consultations/express/:id`
Получает данные консультации со всеми шагами.

### `POST /api/consultations/express/:id/complete`
Завершает консультацию и сохраняет результат продажи.

**Request:**
```json
{
  "sold_product": "full" | "partner" | null,
  "importance_rating": 8
}
```

### `GET /api/consultations/templates`
Получает шаблоны вопросов и вариантов ответов.

## Поток работы

1. Консультант выбирает клиента
2. Нажимает "Начать экспресс-консультацию"
3. Система создает запись `express_consultation`
4. Консультант проходит по шагам:
   - Выбирает готовые варианты ответов (кнопки)
   - Может добавить свой текст
   - Переходит к следующему шагу
5. На этапе "Ресурсы" система показывает, что может дать полная консультация
6. На этапе "Закрытие" консультант продает продукт
7. Система сохраняет результат продажи

## Технические детали

### Компоненты React:
- `ExpressConsultationFlow` - основной компонент
- `ConsultationStep` - компонент одного шага
- `ResponseButtons` - кнопки выбора ответов
- `ConsultationSummary` - резюме для продажи
- `ProductOffer` - предложение продукта

### State Management:
- Используем React state для текущего шага
- Автосохранение в Directus после каждого шага
- Оптимистичные обновления UI

### Оптимизация для медленно печатающих:
- Максимум кнопок, минимум текстового ввода
- Готовые фразы для копирования
- Быстрые действия одним кликом

