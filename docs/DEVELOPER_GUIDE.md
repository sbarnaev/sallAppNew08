# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –°–ê–õ –ü–†–û–§–ò

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ AI-–∞–≥–µ–Ω—Ç–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å –ø—Ä–æ–µ–∫—Ç–æ–º –°–ê–õ –ü–†–û–§–ò.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
5. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–∫–ª—é—á–µ–≤—ã–µ-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
6. [API –º–∞—Ä—à—Ä—É—Ç—ã](#api-–º–∞—Ä—à—Ä—É—Ç—ã)
7. [–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏](#—Ä–∞–±–æ—Ç–∞-—Å-–¥–∞–Ω–Ω—ã–º–∏)
8. [–î–µ–ø–ª–æ–π](#–¥–µ–ø–ª–æ–π)
9. [–û—Ç–ª–∞–¥–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#–æ—Ç–ª–∞–¥–∫–∞-–∏-—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)
10. [–í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–≤–∞–∂–Ω—ã–µ-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)

---

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**–°–ê–õ –ü–†–û–§–ò** ‚Äî –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ –ø–æ —Å–∏—Å—Ç–µ–º–µ –°–ê–õ (–°–∏—Å—Ç–µ–º–∞ –ê–Ω–∞–ª–∏–∑ –õ–∏—á–Ω–æ—Å—Ç–∏). –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –£–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–º–∏
- –°–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç—ã (–±–∞–∑–æ–≤—ã–µ, —Ü–µ–ª–µ–≤—ã–µ, –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏)
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ–≥–Ω–æ—Å—Ç–∏–∫—É (–∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ 90 –¥–Ω–µ–π)
- –í–µ–¥–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫ –∏ —á–∞—Ç —Å AI –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –∫–ª–∏–µ–Ω—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

- **–ö–ª–∏–µ–Ω—Ç—ã (clients)** ‚Äî –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö (–∏–º—è, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- **–ü—Ä–æ—Ñ–∏–ª–∏ (profiles)** ‚Äî —Ä–∞—Å—á–µ—Ç—ã/–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –∫–ª–∏–µ–Ω—Ç–∞–º
- **–ü—Ä–æ–≥–Ω–æ—Å—Ç–∏–∫–∞ (forecast)** ‚Äî –∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ 90 –¥–Ω–µ–π —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –ø–æ –æ—Å—è–º –õ/–ö/–†

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Frontend
- **Next.js 14.2.5** (App Router)
- **TypeScript 5.6.2**
- **React 18.3.1**
- **Tailwind CSS 3.4.7**
- **React Markdown** (–¥–ª—è —á–∞—Ç–∞)

### Backend
- **Next.js API Routes** (–ø—Ä–æ–∫—Å–∏ –∫ Directus –∏ n8n)
- **Directus** (CMS, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ë–î)
- **n8n** (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ AI-—á–∞—Ç–∞)
- **PostgreSQL** (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Docker** (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è)
- **Dokploy** (–¥–µ–ø–ª–æ–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
- **S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** (Beget S3 –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/                   # –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ login/                # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ (protected)/              # –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/            # –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients/              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [id]/             # –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ new/              # –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profiles/             # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [id]/             # –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å—á–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ new/              # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ forecast/             # –ü—Ä–æ–≥–Ω–æ—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [clientId]/       # –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–≥–Ω–æ–∑–∞
‚îÇ   ‚îú‚îÄ‚îÄ api/                      # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/                # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logout/               # –í—ã—Ö–æ–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ refresh/              # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients/               # CRUD –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profiles/             # CRUD —Ä–∞—Å—á–µ—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calc/                 # –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ (n8n)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ qa/                   # AI-—á–∞—Ç (n8n)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forecast/             # –ü—Ä–æ–≥–Ω–æ—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ files/                # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ n8n.prompting/            # –ü—Ä–æ–º–ø—Ç—ã –∏ –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è n8n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1.json, 1.js          # –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2.json, 2.js          # –¶–µ–ª–µ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 3.json, 3.js          # –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx                 # –ö–æ—Ä–Ω–µ–≤–æ–π layout
‚îÇ   ‚îî‚îÄ‚îÄ globals.css                # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îú‚îÄ‚îÄ components/                    # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ MobileMenu.tsx             # –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
‚îÇ   ‚îî‚îÄ‚îÄ RichEditor.tsx             # WYSIWYG —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–º–µ—Ç–æ–∫
‚îú‚îÄ‚îÄ lib/                           # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ env.ts                     # –†–∞–±–æ—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ scripts/                       # –°–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ setup-directus.mjs         # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Directus
‚îú‚îÄ‚îÄ docs/                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                     # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ nixpacks.toml                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nixpacks
‚îú‚îÄ‚îÄ next.config.mjs               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Next.js
‚îú‚îÄ‚îÄ tsconfig.json                  # TypeScript –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ package.json                   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ Git):

```env
# Directus
DIRECTUS_URL=https://directus.example.com
NEXT_PUBLIC_DIRECTUS_URL=https://directus.example.com
DIRECTUS_STATIC_TOKEN=your_static_token_here  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

# Next.js
NEXT_PUBLIC_BASE_URL=https://your-app.com
NODE_ENV=production

# n8n Webhooks
N8N_CALC_URL=https://n8n.example.com/webhook/calc-profile
N8N_QA_URL=https://n8n.example.com/webhook/qa

# OpenAI (–¥–ª—è AI-—á–∞—Ç–∞)
OPENAI_API_KEY=sk-...

# S3 Storage (–¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
S3_ENDPOINT=https://s3.ru1.storage.beget.cloud
S3_BUCKET=your-bucket-name
S3_IMAGES_PATH=sall_app/photo
S3_URL_FORMAT=path-style  # –∏–ª–∏ "virtual-hosted"
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
# –∏–ª–∏
pnpm install
```

### –ó–∞–ø—É—Å–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

```bash
npm run dev
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ http://localhost:3000
```

### –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```bash
npm run build
npm start
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

1. **–õ–æ–≥–∏–Ω**: `POST /api/login` ‚Üí –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∫ Directus, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ httpOnly cookies
2. **–¢–æ–∫–µ–Ω—ã**: 
   - `directus_access_token` ‚Äî –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏–π (15 –º–∏–Ω—É—Ç)
   - `directus_refresh_token` ‚Äî –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π (7 –¥–Ω–µ–π)
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `/api/refresh` –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ access_token
4. **–ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤**: –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ `(protected)/` –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞

### –†–∞–±–æ—Ç–∞ —Å Directus

- **–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ API —Ä–æ—É—Ç—ã** (`/api/*`), —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Directus –Ω–∞–ø—Ä—è–º—É—é
- **–¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è** –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**: –í Directus –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã permissions —Å —Ñ–∏–ª—å—Ç—Ä–æ–º `user_created = $CURRENT_USER`

### –†–∞–±–æ—Ç–∞ —Å n8n

1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞**: `POST /api/calc` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ n8n webhook
2. **AI-—á–∞—Ç**: `POST /api/qa` ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –≤ n8n webhook —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ—Ñ–∏–ª—è
3. **–ü—Ä–æ–º–ø—Ç—ã**: –•—Ä–∞–Ω—è—Ç—Å—è –≤ `app/n8n.prompting/` (–∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ Next.js)

### –¢–∏–ø—ã –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

1. **–ë–∞–∑–æ–≤–∞—è (type: 1)**: –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ª–∏—á–Ω–æ—Å—Ç–∏ —Å —Å–∏–ª—å–Ω—ã–º–∏/—Å–ª–∞–±—ã–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏
2. **–¶–µ–ª–µ–≤–∞—è (type: 2)**: –§–æ–∫—É—Å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞
3. **–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è (type: 3)**: –ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –¥–≤—É—Ö –ª—é–¥–µ–π

---

## API –º–∞—Ä—à—Ä—É—Ç—ã

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### `POST /api/login`
–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
```typescript
Body: { email: string, password: string }
Response: { access_token, refresh_token } ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ cookies
```

#### `POST /api/logout`
–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
```typescript
Response: –æ—á–∏—â–∞–µ—Ç cookies
```

#### `GET /api/refresh`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access_token
```typescript
Response: { access_token } ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç cookie
```

### –ö–ª–∏–µ–Ω—Ç—ã

#### `GET /api/clients`
–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º
```typescript
Query: ?page=1&limit=20&search=...
Response: { data: Client[], total: number }
```

#### `GET /api/clients/[id]`
–î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞
```typescript
Response: { data: Client }
```

#### `POST /api/clients`
–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
```typescript
Body: { name, surname, birth_date, ... }
Response: { data: Client }
```

#### `PATCH /api/clients/[id]`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
```typescript
Body: { name?, surname?, ... }
Response: { data: Client }
```

#### `DELETE /api/clients/[id]`
–£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
```typescript
Response: 204 No Content
```

### –ü—Ä–æ—Ñ–∏–ª–∏ (–†–∞—Å—á–µ—Ç—ã)

#### `GET /api/profiles`
–°–ø–∏—Å–æ–∫ —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º
```typescript
Query: ?page=1&limit=20&search=...&filter[client_id][_eq]=...
Response: { data: Profile[], total: number }
```

#### `GET /api/profiles/[id]`
–î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á–µ—Ç–∞
```typescript
Response: { 
  data: {
    id, client_id, created_at, html, raw_json, 
    ui_state, notes, chat_history, digits, images
  }
}
```

#### `POST /api/calc`
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ (—á–µ—Ä–µ–∑ n8n)
```typescript
Body: {
  clientId: number,
  type: 1 | 2 | 3,
  // –î–ª—è –±–∞–∑–æ–≤–æ–π: { name, surname, birth_date }
  // –î–ª—è —Ü–µ–ª–µ–≤–æ–π: { targetCurrent, targetWant, targetAdditional }
  // –î–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π: { partnerName, partnerBirthDate, goal }
}
Response: { profileId: number }
```

#### `PATCH /api/profiles/[id]`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ (notes, ui_state, chat_history)
```typescript
Body: { notes?, ui_state?, chat_history? }
Response: { data: Profile }
```

### AI-—á–∞—Ç

#### `POST /api/qa`
–í–æ–ø—Ä–æ—Å –∫ AI –ø–æ –ø—Ä–æ—Ñ–∏–ª—é
```typescript
Body: { profileId: number, question: string }
Response: { answer: string } (streaming —á–µ—Ä–µ–∑ SSE)
```

### –ü—Ä–æ–≥–Ω–æ—Å—Ç–∏–∫–∞

#### `GET /api/forecast/[clientId]`
–†–∞—Å—á–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞ –Ω–∞ 90 –¥–Ω–µ–π
```typescript
Response: {
  client: { id, name, birth_date },
  codes: { personality, connector, realization },
  forecasts: Forecast[],
  generated_at: string
}
```

---

## –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Profile

```typescript
interface Profile {
  id: number;
  client_id: number;
  created_at: string;
  html: string | null;              // HTML –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π
  raw_json: object | null;          // JSON –¥–ª—è —Ü–µ–ª–µ–≤—ã—Ö/–ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏—Ö
  ui_state: object | null;          // –°–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–æ–≤
  notes: string | null;              // HTML –∑–∞–º–µ—Ç–∫–∏
  chat_history: Message[] | null;   // –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
  digits: string | null;             // –ö–æ–¥—ã (–¥–ª—è –±–∞–∑–æ–≤—ã—Ö)
  images: object | null;             // Images ID (JSON: {"1": 10, ...})
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ raw_json –¥–ª—è —Ü–µ–ª–µ–≤–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

```typescript
{
  warnings: string[];
  goalDecomposition: object;
  resourcesForStages: object[];
  currentDiagnostics: object;
  plan123: object[];
  progressMetrics: object;
  whatIf: object;
  objectionHandling: object;
  finalStrategy: object;
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ raw_json –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏

```typescript
{
  warnings: string[];
  resourceCompatibility: object;
  conflictZones: object;
  diagnostics: object;
  participantDiagnostics: object[];
  clarifyingQuestions: object;
  actionPlan: object[];
  resourcesForStages: object[];
  progressMetrics: object;
  whatIf: object;
  objectionHandling: object;
  finalStrategy: object;
}
```

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

- –•—Ä–∞–Ω—è—Ç—Å—è –≤ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- –ü—É—Ç—å: `{S3_IMAGES_PATH}/{imageId}.jpeg`
- –§–æ—Ä–º–∞—Ç URL –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `S3_URL_FORMAT`:
  - `path-style`: `{endpoint}/{bucket}/{path}/{id}.jpeg`
  - `virtual-hosted`: `https://{bucket}.{hostname}/{path}/{id}.jpeg`

---

## –î–µ–ø–ª–æ–π

### –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Dokploy

1. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** –≤ Dokploy
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (—Å–º. —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è")
3. **–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ —Å–±–æ—Ä–∫–∏**:
   - **Nixpacks** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç Next.js
   - **Dockerfile** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω—É—é —Å–±–æ—Ä–∫—É
4. **–ü–æ—Ä—Ç**: `3000`
5. **Healthcheck**: –ù–∞—Å—Ç—Ä–æ–µ–Ω –≤ Dockerfile

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞

```bash
docker build -t sal-profi .
docker run --rm -p 3000:3000 --env-file .env.local sal-profi
```

### –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

#### "No space left on device"
- –£–≤–µ–ª–∏—á—å—Ç–µ –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –û—á–∏—Å—Ç–∏—Ç–µ Docker –∫—ç—à: `docker system prune -a`

#### "Parsing error: 'return' outside of function"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `app/n8n.prompting/` –∏—Å–∫–ª—é—á–µ–Ω–∞ –∏–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:
  - `tsconfig.json`: `"exclude": ["app/n8n.prompting"]`
  - `next.config.mjs`: webpack rule —Å `ignore-loader`
  - `.eslintignore`: `app/n8n.prompting/`

#### ESLint –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ ESLint –≤ `next.config.mjs`

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏

#### "Token expired"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `/api/refresh` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ refresh_token –Ω–µ –∏—Å—Ç–µ–∫ (7 –¥–Ω–µ–π)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Directus –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ç–æ–∫–µ–Ω–∞–º–∏

#### "ERR_SSL_PACKET_LENGTH_TOO_LONG"
- –ü—Ä–æ–±–ª–µ–º–∞ —Å SSL/TLS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –∫ Directus
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DIRECTUS_URL` (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `https://`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç Directus

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

#### "403 Forbidden" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ S3 bucket (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è S3
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç URL (`S3_URL_FORMAT`)

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞—Å—á–µ—Ç–∞–º–∏

#### "–î–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è... –µ—â—ë –Ω–µ–º–Ω–æ–≥–æ" (–±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ n8n workflow –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ Directus (`raw_json` –∏–ª–∏ `html`)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n –Ω–∞ –æ—à–∏–±–∫–∏

#### –î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `raw_json` –≤ Directus
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ `app/(protected)/profiles/[id]/page.tsx`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å AI-—á–∞—Ç–æ–º

#### "OpenAI API error"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `OPENAI_API_KEY` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å OpenAI –∞–∫–∫–∞—É–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n workflow –¥–ª—è —á–∞—Ç–∞

#### –ü–ª–æ—Ö–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–º–ø—Ç –≤ n8n workflow
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ReactMarkdown` –≤ –∫–æ–¥–µ

---

## –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ò—Å–∫–ª—é—á–µ–Ω–∏–µ n8n.prompting –∏–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

–ü–∞–ø–∫–∞ `app/n8n.prompting/` —Å–æ–¥–µ—Ä–∂–∏—Ç JavaScript –∏ JSON —Ñ–∞–π–ª—ã –¥–ª—è n8n, –∫–æ—Ç–æ—Ä—ã–µ **–Ω–µ –¥–æ–ª–∂–Ω—ã –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è** Next.js:

1. **tsconfig.json**: `"exclude": ["app/n8n.prompting"]`
2. **next.config.mjs**: webpack rule —Å `ignore-loader`
3. **.eslintignore**: `app/n8n.prompting/`

### –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `MobileMenu` –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –î–µ—Å–∫—Ç–æ–ø–Ω–æ–µ –º–µ–Ω—é —Å–∫—Ä—ã—Ç–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (`hidden md:flex`)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã Tailwind: `md:`, `sm:`, `lg:`

### –ü—Ä–æ–≥–Ω–æ—Å—Ç–∏–∫–∞

- –†–∞—Å—á–µ—Ç –Ω–∞ 90 –¥–Ω–µ–π: 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ + 83 –¥–Ω—è –≤–ø–µ—Ä–µ–¥
- –ò–Ω–¥–µ–∫—Å—ã: -2 –¥–æ +2 (–°–∏–ª—å–Ω—ã–π –º–∏–Ω—É—Å ‚Üí –°–∏–ª—å–Ω—ã–π –ø–ª—é—Å)
- –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ —è—á–µ–µ–∫ –ø–æ –æ–±—â–µ–º—É –∏–Ω–¥–µ–∫—Å—É
- –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö: –æ–±—â–∏–π –∏–Ω–¥–µ–∫—Å –∫—Ä—É–ø–Ω–æ, –¥–µ—Ç–∞–ª–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ

### –ó–∞–º–µ—Ç–∫–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WYSIWYG —Ä–µ–¥–∞–∫—Ç–æ—Ä (`RichEditor`) –≤–º–µ—Å—Ç–æ Markdown
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è HTML –≤ –ø–æ–ª–µ `notes`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç —Ä–∞–∑–º–µ—Ç–∫—É, —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

### –ü–æ–∏—Å–∫

- –ü–æ–∏—Å–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º: –∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
- –ü–æ–∏—Å–∫ –ø–æ —Ä–∞—Å—á–µ—Ç–∞–º: —á–µ—Ä–µ–∑ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–¥–≤—É—Ö—à–∞–≥–æ–≤—ã–π –ø–æ–∏—Å–∫)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç—ã: `DD.MM.YYYY`, `DD-MM-YYYY`, `YYYY-MM-DD`, `YYYY`

### PDF —ç–∫—Å–ø–æ—Ä—Ç

- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `html2pdf.js`
- –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
npm run dev

# –°–±–æ—Ä–∫–∞
npm run build
npm start

# –õ–∏–Ω—Ç–∏–Ω–≥
npm run lint

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Directus
npm run setup:directus

# Docker
docker build -t sal-profi .
docker run --rm -p 3000:3000 --env-file .env.local sal-profi
```

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ (Dokploy/Docker)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Directus –∏ n8n
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-01-XX
**–í–µ—Ä—Å–∏—è**: 0.1.0

