# –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —ç–∫—Å–ø—Ä–µ—Å—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ —É–ª—É—á—à–µ–Ω–æ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `scheduled_at`
- –ü–æ–ª–µ —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π/–≤—Ä–µ–º–µ–Ω–µ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É, –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è n8n

### 2. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ—Ñ–∏–ª–µ–º

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
1. **–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è** (–±—ã—Å—Ç—Ä–æ, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
2. **–ó–∞—Ç–µ–º –≤ —Ñ–æ–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `/api/calc`** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
3. **–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è** –∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `profile_id`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
- –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –∏ –Ω–∞ –µ–≥–æ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ —ç–∫—Å–ø—Ä–µ—Å—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
- –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å—Ä–∞–∑—É
- –ï—Å–ª–∏ —Ä–∞—Å—á–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è
- –ü—Ä–æ—Ñ–∏–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í development —Ä–µ–∂–∏–º–µ –≤–∏–¥–Ω—ã –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è ID (—á–∏—Å–ª–æ, > 0)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞

### 4. –£–ª—É—á—à–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —à–∞–≥–æ–≤

**–õ–æ–≥–∏–∫–∞ update vs create:**
- –ï—Å–ª–∏ —à–∞–≥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (PATCH)
- –ï—Å–ª–∏ —à–∞–≥–∞ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π (POST)
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è `created_at` –∏ `updated_at`

### 5. –£–ª—É—á—à–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI-–∏–Ω—Å–∞–π—Ç–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–æ–≤ –°–ê–õ:**
- –°–Ω–∞—á–∞–ª–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ `profile_id` –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
- –ó–∞—Ç–µ–º –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- –ï—Å–ª–∏ –Ω–µ—Ç - —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º n8n

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ n8n:**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–æ 90 —Å–µ–∫—É–Ω–¥
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### 6. –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞

- –í—Å–µ grid –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ `grid-cols-1 sm:grid-cols-2`
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –∏ —Ä–∞–∑–º–µ—Ä—ã
- –ö–Ω–æ–ø–∫–∏ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç

### 7. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –æ–ø—Ü–∏–π
- –ü–∞—Ä—Å–∏–Ω–≥ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞

## üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–≠–∫—Å–ø—Ä–µ—Å—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è"
2. –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (–±—ã—Å—Ç—Ä–æ)
4. –í —Ñ–æ–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è /api/calc –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
5. –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
6. –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ profile_id –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
7. –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –º–æ–∂–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
```

### –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:
```
1. –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç —ç—Ç–∞–ø—ã (–¢–æ—á–∫–∞ –ê, –ë, –†–µ—Å—É—Ä—Å—ã)
2. –ö–∞–∂–¥—ã–π —à–∞–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —à–∞–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
4. –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
```

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:
```
1. –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–¥–∞–∂–∏
2. –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ completed
3. –ï—Å–ª–∏ –ø—Ä–æ–¥–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç - –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI-–∏–Ω—Å–∞–π—Ç–æ–≤
4. –ò–Ω—Å–∞–π—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ consultation_details
5. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
```

## üìã API Endpoints

### `POST /api/consultations/express/start`
–°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ñ–æ–Ω–µ.

**Request:**
```json
{
  "client_id": 123
}
```

**Response:**
```json
{
  "data": {
    "id": 456,
    "client_id": 123,
    "type": "express",
    "status": "in_progress",
    "scheduled_at": "2024-01-01T12:00:00Z"
  },
  "profileId": null  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ
}
```

### `POST /api/consultations/express/:id/steps`
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —à–∞–≥ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.

**Request:**
```json
{
  "step_type": "point_a",
  "step_order": 1,
  "question": "–ß—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è?",
  "response": "–ù–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤",
  "response_type": "button",
  "selected_options": ["clients", "income"]
}
```

**Response:**
```json
{
  "data": {
    "id": 789,
    "consultation_id": 456,
    "section": "point_a_1",
    "content": "{...}"
  }
}
```

### `GET /api/consultations/express/:id`
–ü–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–æ –≤—Å–µ–º–∏ —à–∞–≥–∞–º–∏.

**Response:**
```json
{
  "consultation": {
    "id": 456,
    "client_id": 123,
    "profile_id": 999,
    ...
  },
  "steps": [
    {
      "id": 789,
      "step_type": "point_a",
      "step_order": 1,
      "question": "...",
      "response": "...",
      ...
    }
  ]
}
```

### `PATCH /api/consultations/express/:id`
–ó–∞–≤–µ—Ä—à–∞–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é.

**Request:**
```json
{
  "status": "completed",
  "sold_product": "full",
  "importance_rating": 8
}
```

### `POST /api/consultations/express/:id/generate-insights`
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI-–∏–Ω—Å–∞–π—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞.

**Response:**
```json
{
  "success": true,
  "insights": {
    "opener": "...",
    "personalitySummary": [...],
    "strengths": [...],
    ...
  }
}
```

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

1. ‚úÖ –û—à–∏–±–∫–∞ `scheduled_at` - —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞
2. ‚úÖ –û—à–∏–±–∫–∞ "Consultation created but no ID returned" - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ Directus
3. ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤ - —Ç–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É–±–ª–µ–π
4. ‚úÖ –ü–æ—Ç–µ—Ä—è —Å–æ—Å—Ç–æ—è–Ω–∏—è - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ n8n - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `/api/calc` endpoint
6. ‚úÖ –ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –Ω–µ –±—ã–ª –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º - —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `/api/calc` –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
7. ‚úÖ –ù–µ—Ç –∫–æ–¥–æ–≤ –°–ê–õ –¥–ª—è AI - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ fallback
8. ‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞ - –≤—Å–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ
9. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

