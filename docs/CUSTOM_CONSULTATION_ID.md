# Кастомный ID для консультаций

## Проблема
Directus автоматически генерирует ID для консультаций (автоинкремент), что затрудняет отслеживание и может вызывать проблемы с получением ID после создания.

## Решение
Используем отдельное поле `consultation_number` для хранения кастомного номера консультации в формате: `CONS-{client_id}-{timestamp}`

## Настройка в Directus

### Шаг 1: Добавить поле `consultation_number`
1. Откройте коллекцию `consultations` в Directus
2. Перейдите в **Fields**
3. Нажмите **+** для добавления нового поля
4. Настройки поля:
   - **Key**: `consultation_number`
   - **Type**: `String`
   - **Interface**: `Input` или `Text Input`
   - **Required**: ❌ (необязательное, на случай если поле еще не создано)
   - **Unique**: ✅ (рекомендуется для уникальности)
   - **Default Value**: оставить пустым

### Шаг 2: Настроить Permissions
1. Settings → Roles & Permissions
2. Ваша роль → `consultations`
3. Для действия **Create**:
   - Убедитесь, что поле `consultation_number` доступно для записи

### Шаг 3: Настроить Item Duplication Fields
1. Откройте коллекцию `consultations`
2. Перейдите в настройки коллекции
3. Найдите **Item Duplication Fields**
4. Убедитесь, что там **НЕТ** поля `id` (ID никогда не должен копироваться)
5. Добавьте поля, которые нужно копировать при дублировании:
   - `client_id`
   - `type`
   - `scheduled_at`
   - `duration`
   - `base_cost`
   - и т.д.
   - **НЕ добавляйте**: `id`, `created_at`, `owner_user`, `consultation_number`

## Формат номера консультации

Формат: `CONS-{client_id}-{timestamp}`

Примеры:
- `CONS-5-123456` - консультация для клиента #5
- `CONS-12-789012` - консультация для клиента #12

Где:
- `CONS` - префикс "консультация"
- `{client_id}` - ID клиента
- `{timestamp}` - последние 6 цифр текущего timestamp (гарантирует уникальность)

## Использование в коде

Номер консультации автоматически генерируется при создании и сохраняется в поле `consultation_number`.

Если нужно найти консультацию по номеру:
```typescript
const res = await fetch(`${baseUrl}/items/consultations?filter[consultation_number][_eq]=CONS-5-123456`);
```

## Альтернативные варианты

### Вариант 1: Использовать ID клиента как часть ID консультации
Если изменить тип ID на String, можно использовать формат: `{client_id}-{timestamp}`
⚠️ **Внимание**: Изменение типа ID существующей коллекции может привести к потере данных!

### Вариант 2: UUID с префиксом
Использовать UUID, но добавить префикс в отдельное поле.

## Рекомендация

Использовать отдельное поле `consultation_number` - это безопаснее и не требует изменения структуры существующих данных.
