# Настройка S3 хранилища для изображений

Приложение поддерживает загрузку изображений из S3-совместимого хранилища.

## Переменные окружения

Добавьте следующие переменные в `.env` или в настройки вашего деплоймента:

```env
# S3 хранилище для изображений
S3_ENDPOINT=https://s3.ru1.storage.beget.cloud
S3_BUCKET=da0eaeb06b35-sal-app
S3_IMAGES_PATH=sall_app/photo
# Формат URL (опционально): "path-style" или "virtual-hosted"
# S3_URL_FORMAT=path-style
```

### Описание переменных

- `S3_ENDPOINT` - URL endpoint S3 хранилища (по умолчанию: `https://s3.ru1.storage.beget.cloud`)
- `S3_BUCKET` - Название bucket в S3 (по умолчанию: `da0eaeb06b35-sal-app`)
- `S3_IMAGES_PATH` - Путь к папке с изображениями в bucket (по умолчанию: `sall_app/photo`)

## Формат файлов

Изображения должны быть загружены в S3 в следующем формате:
- Путь: `{S3_BUCKET}/{S3_IMAGES_PATH}/{ID}.jpeg`
- Пример: `da0eaeb06b35-sal-app/sall_app/photo/30.jpeg`

## Структура данных в Directus

В коллекции `profiles` поле `Images ID` (или `images_id`, `images`) должно содержать JSON в формате:

```json
{
  "1": 30,
  "2": 80,
  "3": 80,
  "4": 60,
  "5": 20
}
```

Где:
- Ключ (`"1"`, `"2"`, ...) - позиция изображения (1-5 для базовых расчетов)
- Значение (`30`, `80`, ...) - ID файла, который соответствует имени файла в S3 (`30.jpeg`, `80.jpeg`, ...)

## Формирование URL

Приложение автоматически формирует прямые ссылки на изображения:
- `https://s3.ru1.storage.beget.cloud/da0eaeb06b35-sal-app/sall_app/photo/30.jpeg`
- `https://s3.ru1.storage.beget.cloud/da0eaeb06b35-sal-app/sall_app/photo/80.jpeg`

## Настройка публичного доступа

**ВАЖНО:** Для работы изображений bucket должен быть настроен как **публичный**.

### В S3 Beget:

1. Откройте настройки bucket `da0eaeb06b35-sal-app`
2. Найдите раздел "Публичный доступ" или "Public Access"
3. Включите публичный доступ для чтения (Read)
4. Или настройте CORS для разрешения доступа с вашего домена

### Проверка доступа:

Попробуйте открыть URL напрямую в браузере:
```
https://s3.ru1.storage.beget.cloud/da0eaeb06b35-sal-app/sall_app/photo/30.jpeg
```

Если получаете 403 - bucket не публичный или файл не загружен.

## Альтернативный формат URL

Если стандартный формат не работает, попробуйте виртуальный хостинг:

```env
S3_URL_FORMAT=virtual-hosted
```

Это изменит формат URL на:
```
https://da0eaeb06b35-sal-app.s3.ru1.storage.beget.cloud/sall_app/photo/30.jpeg
```

## Преимущества

- ✅ Нет проблем с правами доступа в Directus
- ✅ Быстрая загрузка статических файлов
- ✅ Можно использовать CDN для ускорения
- ✅ Проще управлять файлами

