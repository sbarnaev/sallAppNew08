АУДИТ И ЧЕК-ЛИСТ ПО ИСПРАВЛЕНИЯМ (первая итерация)

Критичные баги (исправить сразу)
1) N8N calc: generatePublicCode не генерирует строку (нет out += char) → код пустой.
2) RichEditor: contentEditable не инициализируется текущим значением notes → визуально пусто, onChange не отрабатывает корректно.
3) DIRECTUS_URL: возможен лишний слэш в конце → даёт двойные // и нестабильные запросы. Нормализовать.

Высокий приоритет (после критичных)
4) /api/qa: при отсутствии OPENAI_API_KEY и N8N_QA_URL вернуть явную ошибку и подсказку, сейчас может быть тихий фейл. Проверить stream fallback в клиенте.
5) /api/calc: обработка сетевых ошибок и статусов n8n → улучшить сообщения и логи.
6) Мобильный UI: 
   - Кнопки и поля на страницах /clients/new, /profiles/new сделать крупнее (touch-friendly), увеличить отступы.
   - Фиксировать нижнюю панель действий в профиле; улучшить скролл чата.
7) PDF: добавить title/метаданные и печать только контента, без лишнего (print CSS), проверить юникод/шрифты.

Средний приоритет
8) /api/clients список: защита от невалидных параметров query (page/limit), пограничные значения.
9) /api/* токен-рефреш: унифицировать логику "Token expired" (вынести в helper).
10) Улучшить ошибки UI: показывать тосты/сообщения пользователю вместо молчаливых падений.

Низкий приоритет
11) CORS и HTTPS подсказки в /login при фейле (что именно сломано).
12) Микрооптимизация fetch (cache headers) и lazy загрузка больших блоков/html профиля.

Тест-план (сценарии)
- Логин/логаут: по HTTPS, куки установлены, /api/me возвращает данные.
- Клиенты: создание, листинг (с пагинацией), фильтр по владельцу, просмотр, редактирование.
- Профили: создание (через /api/calc с n8n), просмотр, сохранение notes/ui_state/chat_history.
- Q&A: вопрос со стримингом и без, сохранение в Directus (qa), показ в UI.
- PDF: генерация и печать, корректность кириллицы.
- Ошибки: симулировать падение Directus/n8n → дружелюбные сообщения пользователю.

Статус выполнения
[ ] 1) Починить generatePublicCode
[ ] 2) Инициализировать RichEditor значением
[ ] 3) Нормализовать DIRECTUS_URL
[ ] 4) Явная ошибка для пустого N8N_QA_URL
[ ] 5) Улучшить обработку ошибок /api/calc
[ ] 6) Мобильные правки UI (первый проход)
[ ] 7) PDF print CSS/метаданные
[ ] 8) Валидация query params
[ ] 9) Унификация рефреша токена
[ ] 10) UI‑ошибки/тосты


